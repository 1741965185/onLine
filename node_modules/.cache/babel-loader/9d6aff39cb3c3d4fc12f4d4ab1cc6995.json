{"remainingRequest":"/Users/apple/IdeaProjects/onLinePayMerchant/node_modules/babel-loader/lib/index.js!/Users/apple/IdeaProjects/onLinePayMerchant/node_modules/babel-loader/lib/index.js??ref--17!/Users/apple/IdeaProjects/onLinePayMerchant/node_modules/@okxweb3/coin-bitcoin/dist/psbtSign.js","dependencies":[{"path":"/Users/apple/IdeaProjects/onLinePayMerchant/node_modules/@okxweb3/coin-bitcoin/dist/psbtSign.js","mtime":499162500000},{"path":"/Users/apple/IdeaProjects/onLinePayMerchant/babel.config.js","mtime":1730111979206},{"path":"/Users/apple/IdeaProjects/onLinePayMerchant/babel.config.js","mtime":1730111979206},{"path":"/Users/apple/IdeaProjects/onLinePayMerchant/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/apple/IdeaProjects/onLinePayMerchant/node_modules/babel-loader/lib/index.js","mtime":456789000000},{"path":"/Users/apple/IdeaProjects/onLinePayMerchant/node_modules/babel-loader/lib/index.js","mtime":456789000000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnB1c2guanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmVycm9yLmNhdXNlLmpzIik7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5yZWR1Y2UuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnB1c2guanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmVycm9yLmNhdXNlLmpzIik7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5yZWR1Y2UuanMiKTsKdmFyIF9fY3JlYXRlQmluZGluZyA9IHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcgfHwgKE9iamVjdC5jcmVhdGUgPyBmdW5jdGlvbiAobywgbSwgaywgazIpIHsKICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrOwogIHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihtLCBrKTsKICBpZiAoIWRlc2MgfHwgKCJnZXQiIGluIGRlc2MgPyAhbS5fX2VzTW9kdWxlIDogZGVzYy53cml0YWJsZSB8fCBkZXNjLmNvbmZpZ3VyYWJsZSkpIHsKICAgIGRlc2MgPSB7CiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGdldDogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBtW2tdOwogICAgICB9CiAgICB9OwogIH0KICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIGRlc2MpOwp9IDogZnVuY3Rpb24gKG8sIG0sIGssIGsyKSB7CiAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gazsKICBvW2syXSA9IG1ba107Cn0pOwp2YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gdGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCB8fCAoT2JqZWN0LmNyZWF0ZSA/IGZ1bmN0aW9uIChvLCB2KSB7CiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sICJkZWZhdWx0IiwgewogICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgIHZhbHVlOiB2CiAgfSk7Cn0gOiBmdW5jdGlvbiAobywgdikgewogIG9bImRlZmF1bHQiXSA9IHY7Cn0pOwp2YXIgX19pbXBvcnRTdGFyID0gdGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhciB8fCBmdW5jdGlvbiAobW9kKSB7CiAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDsKICB2YXIgcmVzdWx0ID0ge307CiAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09ICJkZWZhdWx0IiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTsKICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpOwogIHJldHVybiByZXN1bHQ7Cn07Ck9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKZXhwb3J0cy5nZW5lcmF0ZU1QQ1NpZ25lZFBTQlQgPSBleHBvcnRzLmdlbmVyYXRlTVBDVW5zaWduZWRQU0JUID0gZXhwb3J0cy5nZW5lcmF0ZU1QQ1NpZ25lZEJ1eWluZ1R4ID0gZXhwb3J0cy5nZW5lcmF0ZU1QQ1Vuc2lnbmVkQnV5aW5nUFNCVCA9IGV4cG9ydHMuZ2VuZXJhdGVNUENTaWduZWRMaXN0aW5nUFNCVCA9IGV4cG9ydHMuZ2VuZXJhdGVNUENVbnNpZ25lZExpc3RpbmdQU0JUID0gZXhwb3J0cy5nZW5lcmF0ZVNpZ25lZEJ1eWluZ1R4ID0gZXhwb3J0cy5tZXJnZVNpZ25lZEJ1eWluZ1BzYnQgPSBleHBvcnRzLmdlbmVyYXRlVW5zaWduZWRCdXlpbmdQc2J0ID0gZXhwb3J0cy5nZW5lcmF0ZVNpZ25lZExpc3RpbmdQc2J0ID0gZXhwb3J0cy5nZW5lcmF0ZVVuc2lnbmVkTGlzdGluZ1BzYnQgPSBleHBvcnRzLmV4dHJhY3RQc2J0VHJhbnNhY3Rpb24gPSBleHBvcnRzLnBzYnRTaWduSW1wbCA9IGV4cG9ydHMuc2lnblBzYnRXaXRoS2V5UGF0aEFuZFNjcmlwdFBhdGhJbXBsID0gZXhwb3J0cy5zaWduUHNidFdpdGhLZXlQYXRoQW5kU2NyaXB0UGF0aCA9IGV4cG9ydHMuc2lnblBzYnRXaXRoS2V5UGF0aEFuZFNjcmlwdFBhdGhCYXRjaCA9IGV4cG9ydHMucHNidERlY29kZSA9IGV4cG9ydHMucHNidFNpZ24gPSBleHBvcnRzLmNsYXNzaWNUb1BzYnQgPSBleHBvcnRzLmJ1aWxkUHNidCA9IHZvaWQgMDsKY29uc3QgcHNidF8xID0gcmVxdWlyZSgiLi9iaXRjb2luanMtbGliL3BzYnQiKTsKY29uc3QgY3J5cHRvX2xpYl8xID0gcmVxdWlyZSgiQG9reHdlYjMvY3J5cHRvLWxpYiIpOwpjb25zdCB0eEJ1aWxkXzEgPSByZXF1aXJlKCIuL3R4QnVpbGQiKTsKY29uc3QgYml0Y29pbmpzX2xpYl8xID0gcmVxdWlyZSgiLi9iaXRjb2luanMtbGliIik7CmNvbnN0IHRhcHJvb3QgPSBfX2ltcG9ydFN0YXIocmVxdWlyZSgiLi90YXByb290IikpOwpjb25zdCBiaXAzNzFfMSA9IHJlcXVpcmUoIi4vYml0Y29pbmpzLWxpYi9wc2J0L2JpcDM3MSIpOwpjb25zdCBhZGRyZXNzXzEgPSByZXF1aXJlKCIuL2JpdGNvaW5qcy1saWIvYWRkcmVzcyIpOwpjb25zdCBidWZmZXJ1dGlsc18xID0gcmVxdWlyZSgiLi9iaXRjb2luanMtbGliL2J1ZmZlcnV0aWxzIik7CmNvbnN0IHBzYnR1dGlsc18xID0gcmVxdWlyZSgiLi9iaXRjb2luanMtbGliL3BzYnQvcHNidHV0aWxzIik7CmNvbnN0IGJzY3JpcHQgPSBfX2ltcG9ydFN0YXIocmVxdWlyZSgiLi9iaXRjb2luanMtbGliL3NjcmlwdCIpKTsKY29uc3QgY3J5cHRvXzEgPSByZXF1aXJlKCIuL2JpdGNvaW5qcy1saWIvY3J5cHRvIik7CmNvbnN0IGNyeXB0b18yID0gcmVxdWlyZSgiY3J5cHRvIik7CmNvbnN0IHNjaG5vcnIgPSBjcnlwdG9fbGliXzEuc2lnblV0aWwuc2Nobm9yci5zZWNwMjU2azEuc2Nobm9ycjsKY29uc3QgZGVmYXVsdE1heGltdW1GZWVSYXRlID0gNTAwMDsKZnVuY3Rpb24gYnVpbGRQc2J0KHR4LCBuZXR3b3JrLCBtYXhpbXVtRmVlUmF0ZSkgewogIGNvbnN0IHBzYnQgPSBjbGFzc2ljVG9Qc2J0KHR4LCBuZXR3b3JrLCBtYXhpbXVtRmVlUmF0ZSk7CiAgcmV0dXJuIHBzYnQudG9IZXgoKTsKfQpleHBvcnRzLmJ1aWxkUHNidCA9IGJ1aWxkUHNidDsKZnVuY3Rpb24gY2xhc3NpY1RvUHNidCh0eCwgbmV0d29yaywgbWF4aW11bUZlZVJhdGUpIHsKICBjb25zdCBwc2J0ID0gbmV3IHBzYnRfMS5Qc2J0KHsKICAgIG5ldHdvcmssCiAgICBtYXhpbXVtRmVlUmF0ZTogbWF4aW11bUZlZVJhdGUgPyBtYXhpbXVtRmVlUmF0ZSA6IGRlZmF1bHRNYXhpbXVtRmVlUmF0ZQogIH0pOwogIHR4LmlucHV0cy5mb3JFYWNoKGlucHV0ID0+IHsKICAgIGNvbnN0IG91dHB1dFNjcmlwdCA9ICgwLCBhZGRyZXNzXzEudG9PdXRwdXRTY3JpcHQpKGlucHV0LmFkZHJlc3MsIG5ldHdvcmspOwogICAgbGV0IGlucHV0RGF0YSA9IHsKICAgICAgaGFzaDogaW5wdXQudHhJZCwKICAgICAgaW5kZXg6IGlucHV0LnZPdXQsCiAgICAgIHdpdG5lc3NVdHhvOiB7CiAgICAgICAgc2NyaXB0OiBvdXRwdXRTY3JpcHQsCiAgICAgICAgdmFsdWU6IGlucHV0LmFtb3VudAogICAgICB9CiAgICB9OwogICAgY29uc3QgYWRkcmVzc1R5cGUgPSAoMCwgdHhCdWlsZF8xLmdldEFkZHJlc3NUeXBlKShpbnB1dC5hZGRyZXNzLCBuZXR3b3JrIHx8IGJpdGNvaW5qc19saWJfMS5uZXR3b3Jrcy5iaXRjb2luKTsKICAgIGlmIChpbnB1dC5iaXAzMkRlcml2YXRpb24pIHsKICAgICAgaWYgKGFkZHJlc3NUeXBlID09PSAnc2Vnd2l0X3RhcHJvb3QnKSB7CiAgICAgICAgaW5wdXREYXRhLnRhcEJpcDMyRGVyaXZhdGlvbiA9IGlucHV0LmJpcDMyRGVyaXZhdGlvbi5tYXAoZGVyaXZhdGlvbiA9PiB7CiAgICAgICAgICBsZXQgcHViQnVmID0gY3J5cHRvX2xpYl8xLmJhc2UuZnJvbUhleChkZXJpdmF0aW9uLnB1YmtleSk7CiAgICAgICAgICBpZiAocHViQnVmLmxlbmd0aCAhPSAzMikgewogICAgICAgICAgICBwdWJCdWYgPSBwdWJCdWYuc2xpY2UoMSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBtYXN0ZXJGaW5nZXJwcmludDogY3J5cHRvX2xpYl8xLmJhc2UuZnJvbUhleChkZXJpdmF0aW9uLm1hc3RlckZpbmdlcnByaW50KSwKICAgICAgICAgICAgcHVia2V5OiBwdWJCdWYsCiAgICAgICAgICAgIHBhdGg6IGRlcml2YXRpb24ucGF0aCwKICAgICAgICAgICAgbGVhZkhhc2hlczogZGVyaXZhdGlvbi5sZWFmSGFzaGVzLm1hcChsZWFmID0+IHsKICAgICAgICAgICAgICByZXR1cm4gQnVmZmVyLmZyb20obGVhZiwgJ2hleCcpOwogICAgICAgICAgICB9KQogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpbnB1dERhdGEuYmlwMzJEZXJpdmF0aW9uID0gaW5wdXQuYmlwMzJEZXJpdmF0aW9uLm1hcChkZXJpdmF0aW9uID0+IHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIG1hc3RlckZpbmdlcnByaW50OiBjcnlwdG9fbGliXzEuYmFzZS5mcm9tSGV4KGRlcml2YXRpb24ubWFzdGVyRmluZ2VycHJpbnQpLAogICAgICAgICAgICBwdWJrZXk6IGNyeXB0b19saWJfMS5iYXNlLmZyb21IZXgoZGVyaXZhdGlvbi5wdWJrZXkpLAogICAgICAgICAgICBwYXRoOiBkZXJpdmF0aW9uLnBhdGgKICAgICAgICAgIH07CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIGlmIChhZGRyZXNzVHlwZSA9PT0gJ2xlZ2FjeScpIHsKICAgICAgaW5wdXREYXRhLm5vbldpdG5lc3NVdHhvID0gY3J5cHRvX2xpYl8xLmJhc2UuZnJvbUhleChpbnB1dC5ub25XaXRuZXNzVXR4byk7CiAgICB9IGVsc2UgaWYgKGFkZHJlc3NUeXBlID09PSAnc2Vnd2l0X3RhcHJvb3QnKSB7CiAgICAgIGlmIChpbnB1dC5wdWJsaWNLZXkpIHsKICAgICAgICBpbnB1dERhdGEudGFwSW50ZXJuYWxLZXkgPSAoMCwgYmlwMzcxXzEudG9YT25seSkoY3J5cHRvX2xpYl8xLmJhc2UuZnJvbUhleChpbnB1dC5wdWJsaWNLZXkpKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChhZGRyZXNzVHlwZSA9PT0gJ3NlZ3dpdF9uZXN0ZWQnKSB7CiAgICAgIGlucHV0RGF0YS5yZWRlZW1TY3JpcHQgPSBiaXRjb2luanNfbGliXzEucGF5bWVudHMucDJ3cGtoKHsKICAgICAgICBwdWJrZXk6IEJ1ZmZlci5mcm9tKGlucHV0LnB1YmxpY0tleSwgJ2hleCcpLAogICAgICAgIG5ldHdvcmsKICAgICAgfSkub3V0cHV0OwogICAgfQogICAgaWYgKGlucHV0LnNpZ2hhc2hUeXBlKSB7CiAgICAgIGlucHV0RGF0YS5zaWdoYXNoVHlwZSA9IGlucHV0LnNpZ2hhc2hUeXBlOwogICAgfQogICAgcHNidC5hZGRJbnB1dChpbnB1dERhdGEpOwogIH0pOwogIHR4Lm91dHB1dHMuZm9yRWFjaChvdXRwdXQgPT4gewogICAgaWYgKG91dHB1dC5vbW5pU2NyaXB0KSB7CiAgICAgIHBzYnQuYWRkT3V0cHV0KHsKICAgICAgICBzY3JpcHQ6IGNyeXB0b19saWJfMS5iYXNlLmZyb21IZXgob3V0cHV0Lm9tbmlTY3JpcHQpLAogICAgICAgIHZhbHVlOiAwCiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgbGV0IG91dHB1dERhdGEgPSB7CiAgICAgICAgYWRkcmVzczogb3V0cHV0LmFkZHJlc3MsCiAgICAgICAgdmFsdWU6IG91dHB1dC5hbW91bnQKICAgICAgfTsKICAgICAgaWYgKG91dHB1dC5iaXAzMkRlcml2YXRpb24pIHsKICAgICAgICBvdXRwdXREYXRhLmJpcDMyRGVyaXZhdGlvbiA9IG91dHB1dC5iaXAzMkRlcml2YXRpb24ubWFwKGRlcml2YXRpb24gPT4gewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbWFzdGVyRmluZ2VycHJpbnQ6IGNyeXB0b19saWJfMS5iYXNlLmZyb21IZXgoZGVyaXZhdGlvbi5tYXN0ZXJGaW5nZXJwcmludCksCiAgICAgICAgICAgIHB1YmtleTogY3J5cHRvX2xpYl8xLmJhc2UuZnJvbUhleChkZXJpdmF0aW9uLnB1YmtleSksCiAgICAgICAgICAgIHBhdGg6IGRlcml2YXRpb24ucGF0aAogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBwc2J0LmFkZE91dHB1dChvdXRwdXREYXRhKTsKICAgIH0KICB9KTsKICByZXR1cm4gcHNidDsKfQpleHBvcnRzLmNsYXNzaWNUb1BzYnQgPSBjbGFzc2ljVG9Qc2J0OwpmdW5jdGlvbiBwc2J0U2lnbihwc2J0QmFzZTY0LCBwcml2YXRlS2V5LCBuZXR3b3JrLCBtYXhpbXVtRmVlUmF0ZSkgewogIGNvbnN0IHBzYnQgPSBwc2J0XzEuUHNidC5mcm9tQmFzZTY0KHBzYnRCYXNlNjQsIHsKICAgIG5ldHdvcmssCiAgICBtYXhpbXVtRmVlUmF0ZTogbWF4aW11bUZlZVJhdGUgPyBtYXhpbXVtRmVlUmF0ZSA6IGRlZmF1bHRNYXhpbXVtRmVlUmF0ZQogIH0pOwogIHBzYnRTaWduSW1wbChwc2J0LCBwcml2YXRlS2V5LCBuZXR3b3JrKTsKICByZXR1cm4gcHNidC50b0Jhc2U2NCgpOwp9CmV4cG9ydHMucHNidFNpZ24gPSBwc2J0U2lnbjsKZnVuY3Rpb24gcHNidERlY29kZShwc2J0QmFzZTY0LCBuZXR3b3JrLCBtYXhpbXVtRmVlUmF0ZSkgewogIHRyeSB7CiAgICBjb25zdCBwc2J0ID0gcHNidF8xLlBzYnQuZnJvbUhleChwc2J0QmFzZTY0LCB7CiAgICAgIG5ldHdvcmssCiAgICAgIG1heGltdW1GZWVSYXRlOiBtYXhpbXVtRmVlUmF0ZSA/IG1heGltdW1GZWVSYXRlIDogZGVmYXVsdE1heGltdW1GZWVSYXRlCiAgICB9KTsKICAgIHJldHVybiBwc2J0LnR4SW5wdXRzID8gcHNidC50eElucHV0cy5maWx0ZXIoYSA9PiAhYS5oYXNoLmVxdWFscyhCdWZmZXIuYWxsb2MoMzIpKSkubWFwKGEgPT4gewogICAgICByZXR1cm4gewogICAgICAgIHR4SWQ6IGNyeXB0b19saWJfMS5iYXNlLnRvSGV4KGNyeXB0b19saWJfMS5iYXNlLnJldmVyc2VCdWZmZXIoYS5oYXNoKSksCiAgICAgICAgdk91dDogYS5pbmRleAogICAgICB9OwogICAgfSkgOiBbXTsKICB9IGNhdGNoIChlKSB7CiAgICBjb25zdCBwc2J0ID0gcHNidF8xLlBzYnQuZnJvbUJhc2U2NChwc2J0QmFzZTY0LCB7CiAgICAgIG5ldHdvcmssCiAgICAgIG1heGltdW1GZWVSYXRlOiBtYXhpbXVtRmVlUmF0ZSA/IG1heGltdW1GZWVSYXRlIDogZGVmYXVsdE1heGltdW1GZWVSYXRlCiAgICB9KTsKICAgIHJldHVybiBwc2J0LnR4SW5wdXRzID8gcHNidC50eElucHV0cy5maWx0ZXIoYSA9PiAhYS5oYXNoLmVxdWFscyhCdWZmZXIuYWxsb2MoMzIpKSkubWFwKGEgPT4gewogICAgICByZXR1cm4gewogICAgICAgIHR4SWQ6IGNyeXB0b19saWJfMS5iYXNlLnRvSGV4KGNyeXB0b19saWJfMS5iYXNlLnJldmVyc2VCdWZmZXIoYS5oYXNoKSksCiAgICAgICAgdk91dDogYS5pbmRleAogICAgICB9OwogICAgfSkgOiBbXTsKICB9Cn0KZXhwb3J0cy5wc2J0RGVjb2RlID0gcHNidERlY29kZTsKZnVuY3Rpb24gc2lnblBzYnRXaXRoS2V5UGF0aEFuZFNjcmlwdFBhdGhCYXRjaChwc2J0SGV4cywgcHJpdmF0ZUtleSwgbmV0d29yaywgb3B0cykgewogIGlmIChwc2J0SGV4cyA9PSB1bmRlZmluZWQgfHwgcHNidEhleHMubGVuZ3RoID09IDApIHsKICAgIHJldHVybiBbXTsKICB9CiAgbGV0IHJlcyA9IFtdOwogIGNvbnN0IG9wdHNTaXplID0gb3B0cyA9PSB1bmRlZmluZWQgPyAwIDogb3B0cy5sZW5ndGg7CiAgbGV0IGkgPSAwOwogIGZvciAoaSA9IDA7IGkgPCBwc2J0SGV4cy5sZW5ndGg7IGkrKykgewogICAgbGV0IG9wdCA9IHt9OwogICAgaWYgKGkgPCBvcHRzU2l6ZSAmJiBvcHRzKSB7CiAgICAgIG9wdCA9IG9wdHNbaV07CiAgICB9CiAgICBjb25zdCBzaWduZWRQc2J0ID0gc2lnblBzYnRXaXRoS2V5UGF0aEFuZFNjcmlwdFBhdGgocHNidEhleHNbaV0sIHByaXZhdGVLZXksIG5ldHdvcmssIHsKICAgICAgYXV0b0ZpbmFsaXplZDogb3B0LmF1dG9GaW5hbGl6ZWQsCiAgICAgIHRvU2lnbklucHV0czogb3B0LnRvU2lnbklucHV0cwogICAgfSk7CiAgICByZXMucHVzaChzaWduZWRQc2J0KTsKICB9CiAgcmV0dXJuIHJlczsKfQpleHBvcnRzLnNpZ25Qc2J0V2l0aEtleVBhdGhBbmRTY3JpcHRQYXRoQmF0Y2ggPSBzaWduUHNidFdpdGhLZXlQYXRoQW5kU2NyaXB0UGF0aEJhdGNoOwpmdW5jdGlvbiBzaWduUHNidFdpdGhLZXlQYXRoQW5kU2NyaXB0UGF0aChwc2J0U3RyLCBwcml2YXRlS2V5LCBuZXR3b3JrKSB7CiAgbGV0IG9wdHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1szXSA6IHt9OwogIGNvbnN0IHBzYnQgPSBnZXRQc2J0RnJvbVN0cmluZyhwc2J0U3RyLCBuZXR3b3JrKTsKICBzaWduUHNidFdpdGhLZXlQYXRoQW5kU2NyaXB0UGF0aEltcGwocHNidCwgcHJpdmF0ZUtleSwgbmV0d29yaywgb3B0cy5hdXRvRmluYWxpemVkLCBvcHRzLnRvU2lnbklucHV0cyk7CiAgcmV0dXJuIHBzYnQudG9IZXgoKTsKfQpleHBvcnRzLnNpZ25Qc2J0V2l0aEtleVBhdGhBbmRTY3JpcHRQYXRoID0gc2lnblBzYnRXaXRoS2V5UGF0aEFuZFNjcmlwdFBhdGg7CmZ1bmN0aW9uIHNpZ25Qc2J0V2l0aEtleVBhdGhBbmRTY3JpcHRQYXRoSW1wbChwc2J0LCBwcml2YXRlS2V5LCBuZXR3b3JrLCBhdXRvRmluYWxpemVkLCBzaWduSW5wdXRzKSB7CiAgbmV0d29yayA9IG5ldHdvcmsgfHwgYml0Y29pbmpzX2xpYl8xLm5ldHdvcmtzLmJpdGNvaW47CiAgY29uc3QgcHJpdktleUhleCA9ICgwLCB0eEJ1aWxkXzEucHJpdmF0ZUtleUZyb21XSUYpKHByaXZhdGVLZXksIG5ldHdvcmspOwogIGNvbnN0IHNpZ25JbnB1dE1hcCA9IG5ldyBNYXAoKTsKICBpZiAoc2lnbklucHV0cyAhPSB1bmRlZmluZWQpIHsKICAgIHNpZ25JbnB1dHMubWFwKGUgPT4gewogICAgICBzaWduSW5wdXRNYXAuc2V0KGUuaW5kZXgsIGUpOwogICAgfSk7CiAgfQogIGNvbnN0IHNpZ25lciA9IHsKICAgIHBzYnRJbmRleDogMCwKICAgIG5lZWRUd2VhazogdHJ1ZSwKICAgIHR3ZWFrSGFzaDogQnVmZmVyLmFsbG9jKDApLAogICAgdG9TaWduSW5wdXRzTWFwOiBzaWduSW5wdXRNYXAsCiAgICBwdWJsaWNLZXk6IEJ1ZmZlci5hbGxvYygwKSwKICAgIHNpZ24oaGFzaCkgewogICAgICByZXR1cm4gKDAsIHR4QnVpbGRfMS5zaWduKShoYXNoLCBwcml2S2V5SGV4KTsKICAgIH0sCiAgICBzaWduU2Nobm9ycihoYXNoKSB7CiAgICAgIHZhciBfdGhpcyR0b1NpZ25JbnB1dHNNYXA7CiAgICAgIGxldCB0d2Vha2VkUHJpdktleSA9IHRhcHJvb3QudGFwcm9vdFR3ZWFrUHJpdktleShjcnlwdG9fbGliXzEuYmFzZS5mcm9tSGV4KHByaXZLZXlIZXgpKTsKICAgICAgaWYgKChfdGhpcyR0b1NpZ25JbnB1dHNNYXAgPSB0aGlzLnRvU2lnbklucHV0c01hcCkgIT09IG51bGwgJiYgX3RoaXMkdG9TaWduSW5wdXRzTWFwICE9PSB2b2lkIDAgJiYgX3RoaXMkdG9TaWduSW5wdXRzTWFwLmhhcyh0aGlzLnBzYnRJbmRleCkpIHsKICAgICAgICB2YXIgX3RoaXMkdG9TaWduSW5wdXRzTWFwMjsKICAgICAgICBpZiAoKF90aGlzJHRvU2lnbklucHV0c01hcDIgPSB0aGlzLnRvU2lnbklucHV0c01hcC5nZXQodGhpcy5wc2J0SW5kZXgpKSAhPT0gbnVsbCAmJiBfdGhpcyR0b1NpZ25JbnB1dHNNYXAyICE9PSB2b2lkIDAgJiYgX3RoaXMkdG9TaWduSW5wdXRzTWFwMi5kaXNhYmxlVHdlYWtTaWduZXIpIHsKICAgICAgICAgIHJldHVybiBCdWZmZXIuZnJvbShzY2hub3JyLnNpZ24oaGFzaCwgcHJpdktleUhleCwgY3J5cHRvX2xpYl8xLmJhc2UucmFuZG9tQnl0ZXMoMzIpKSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICghdGhpcy5uZWVkVHdlYWspIHsKICAgICAgICByZXR1cm4gQnVmZmVyLmZyb20oc2Nobm9yci5zaWduKGhhc2gsIHByaXZLZXlIZXgsIGNyeXB0b19saWJfMS5iYXNlLnJhbmRvbUJ5dGVzKDMyKSkpOwogICAgICB9CiAgICAgIGlmICh0aGlzLm5lZWRUd2VhayAmJiB0aGlzLnR3ZWFrSGFzaC5sZW5ndGggPiAwKSB7CiAgICAgICAgdHdlYWtlZFByaXZLZXkgPSB0YXByb290LnRhcHJvb3RUd2Vha1ByaXZLZXkoY3J5cHRvX2xpYl8xLmJhc2UuZnJvbUhleChwcml2S2V5SGV4KSwgdGhpcy50d2Vha0hhc2gpOwogICAgICB9CiAgICAgIHJldHVybiBCdWZmZXIuZnJvbShzY2hub3JyLnNpZ24oaGFzaCwgdHdlYWtlZFByaXZLZXksIGNyeXB0b19saWJfMS5iYXNlLnJhbmRvbUJ5dGVzKDMyKSkpOwogICAgfQogIH07CiAgbGV0IGFsbG93ZWRTaWdoYXNoVHlwZXMgPSBbYml0Y29pbmpzX2xpYl8xLlRyYW5zYWN0aW9uLlNJR0hBU0hfU0lOR0xFIHwgYml0Y29pbmpzX2xpYl8xLlRyYW5zYWN0aW9uLlNJR0hBU0hfQU5ZT05FQ0FOUEFZLCBiaXRjb2luanNfbGliXzEuVHJhbnNhY3Rpb24uU0lHSEFTSF9BTEwsIGJpdGNvaW5qc19saWJfMS5UcmFuc2FjdGlvbi5TSUdIQVNIX0RFRkFVTFRdOwogIGZvciAobGV0IGkgPSAwOyBpIDwgcHNidC5pbnB1dENvdW50OyBpKyspIHsKICAgIGlmICgoc2lnbklucHV0TWFwID09PSBudWxsIHx8IHNpZ25JbnB1dE1hcCA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2lnbklucHV0TWFwLnNpemUpID4gMCAmJiAhKHNpZ25JbnB1dE1hcCAhPT0gbnVsbCAmJiBzaWduSW5wdXRNYXAgIT09IHZvaWQgMCAmJiBzaWduSW5wdXRNYXAuaGFzKGkpKSkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIHNpZ25lci5wc2J0SW5kZXggPSBpOwogICAgY29uc3QgaW5wdXQgPSBwc2J0LmRhdGEuaW5wdXRzW2ldOwogICAgaWYgKCgwLCBiaXAzNzFfMS5pc1RhcHJvb3RJbnB1dCkoaW5wdXQpKSB7CiAgICAgIHZhciBfaW5wdXQkdGFwTGVhZlNjcmlwdDsKICAgICAgaWYgKCFpbnB1dC50YXBJbnRlcm5hbEtleSkgewogICAgICAgIGlucHV0LnRhcEludGVybmFsS2V5ID0gKDAsIGJpcDM3MV8xLnRvWE9ubHkpKCgwLCB0eEJ1aWxkXzEud2lmMlB1YmxpYykocHJpdmF0ZUtleSwgbmV0d29yaykpOwogICAgICB9CiAgICAgIHNpZ25lci5uZWVkVHdlYWsgPSB0cnVlOwogICAgICBzaWduZXIucHVibGljS2V5ID0gQnVmZmVyLmZyb20odGFwcm9vdC50YXByb290VHdlYWtQdWJrZXkoKDAsIGJpcDM3MV8xLnRvWE9ubHkpKCgwLCB0eEJ1aWxkXzEud2lmMlB1YmxpYykocHJpdmF0ZUtleSwgbmV0d29yaykpKVswXSk7CiAgICAgIGlmIChzaWduSW5wdXRNYXAgIT09IG51bGwgJiYgc2lnbklucHV0TWFwICE9PSB2b2lkIDAgJiYgc2lnbklucHV0TWFwLmhhcyhpKSkgewogICAgICAgIHZhciBfc2lnbklucHV0TWFwJGdldDsKICAgICAgICBpZiAoc2lnbklucHV0TWFwICE9PSBudWxsICYmIHNpZ25JbnB1dE1hcCAhPT0gdm9pZCAwICYmIChfc2lnbklucHV0TWFwJGdldCA9IHNpZ25JbnB1dE1hcC5nZXQoaSkpICE9PSBudWxsICYmIF9zaWduSW5wdXRNYXAkZ2V0ICE9PSB2b2lkIDAgJiYgX3NpZ25JbnB1dE1hcCRnZXQuZGlzYWJsZVR3ZWFrU2lnbmVyKSB7CiAgICAgICAgICBzaWduZXIucHVibGljS2V5ID0gKDAsIHR4QnVpbGRfMS53aWYyUHVibGljKShwcml2YXRlS2V5LCBuZXR3b3JrKTsKICAgICAgICAgIHNpZ25lci5uZWVkVHdlYWsgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGlucHV0LnRhcExlYWZTY3JpcHQgJiYgKChfaW5wdXQkdGFwTGVhZlNjcmlwdCA9IGlucHV0LnRhcExlYWZTY3JpcHQpID09PSBudWxsIHx8IF9pbnB1dCR0YXBMZWFmU2NyaXB0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfaW5wdXQkdGFwTGVhZlNjcmlwdC5sZW5ndGgpID4gMCAmJiAhaW5wdXQudGFwTWVya2xlUm9vdCkgewogICAgICAgIGlucHV0LnRhcExlYWZTY3JpcHQubWFwKGUgPT4gewogICAgICAgICAgaWYgKGUuY29udHJvbEJsb2NrICYmIGUuc2NyaXB0KSB7CiAgICAgICAgICAgIHNpZ25lci5wdWJsaWNLZXkgPSAoMCwgdHhCdWlsZF8xLndpZjJQdWJsaWMpKHByaXZhdGVLZXksIG5ldHdvcmspOwogICAgICAgICAgICBzaWduZXIubmVlZFR3ZWFrID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAoaW5wdXQudGFwTWVya2xlUm9vdCkgewogICAgICAgIHNpZ25lci5uZWVkVHdlYWsgPSB0cnVlOwogICAgICAgIHNpZ25lci50d2Vha0hhc2ggPSBpbnB1dC50YXBNZXJrbGVSb290OwogICAgICAgIHNpZ25lci5wdWJsaWNLZXkgPSBCdWZmZXIuZnJvbSh0YXByb290LnRhcHJvb3RUd2Vha1B1YmtleSgoMCwgYmlwMzcxXzEudG9YT25seSkoKDAsIHR4QnVpbGRfMS53aWYyUHVibGljKShwcml2YXRlS2V5LCBuZXR3b3JrKSksIGlucHV0LnRhcE1lcmtsZVJvb3QpWzBdKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgc2lnbmVyLm5lZWRUd2VhayA9IGZhbHNlOwogICAgICBzaWduZXIudHdlYWtIYXNoID0gQnVmZmVyLmFsbG9jKDApOwogICAgICBzaWduZXIucHVibGljS2V5ID0gKDAsIHR4QnVpbGRfMS53aWYyUHVibGljKShwcml2YXRlS2V5LCBuZXR3b3JrKTsKICAgIH0KICAgIHRyeSB7CiAgICAgIGlmIChzaWduSW5wdXRNYXAgIT09IG51bGwgJiYgc2lnbklucHV0TWFwICE9PSB2b2lkIDAgJiYgc2lnbklucHV0TWFwLmhhcyhpKSkgewogICAgICAgIHZhciBfc2lnbklucHV0TWFwJGdldDI7CiAgICAgICAgY29uc3Qgc2lnaGFzaFR5cGVzID0gc2lnbklucHV0TWFwID09PSBudWxsIHx8IHNpZ25JbnB1dE1hcCA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9zaWduSW5wdXRNYXAkZ2V0MiA9IHNpZ25JbnB1dE1hcC5nZXQoaSkpID09PSBudWxsIHx8IF9zaWduSW5wdXRNYXAkZ2V0MiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3NpZ25JbnB1dE1hcCRnZXQyLnNpZ2hhc2hUeXBlczsKICAgICAgICBpZiAoc2lnaGFzaFR5cGVzICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgYWxsb3dlZFNpZ2hhc2hUeXBlcyA9IHNpZ2hhc2hUeXBlczsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHNidC5zaWduSW5wdXQoaSwgc2lnbmVyLCBhbGxvd2VkU2lnaGFzaFR5cGVzKTsKICAgICAgaWYgKGF1dG9GaW5hbGl6ZWQgIT0gdW5kZWZpbmVkICYmICFhdXRvRmluYWxpemVkKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgcHNidC5maW5hbGl6ZUlucHV0KGkpOwogICAgfSBjYXRjaCAoZSkgewogICAgICBpZiAoKHNpZ25JbnB1dE1hcCA9PT0gbnVsbCB8fCBzaWduSW5wdXRNYXAgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNpZ25JbnB1dE1hcC5zaXplKSA+IDAgJiYgc2lnbklucHV0TWFwICE9PSBudWxsICYmIHNpZ25JbnB1dE1hcCAhPT0gdm9pZCAwICYmIHNpZ25JbnB1dE1hcC5oYXMoaSkpIHsKICAgICAgICB0aHJvdyBlOwogICAgICB9CiAgICB9CiAgfQp9CmV4cG9ydHMuc2lnblBzYnRXaXRoS2V5UGF0aEFuZFNjcmlwdFBhdGhJbXBsID0gc2lnblBzYnRXaXRoS2V5UGF0aEFuZFNjcmlwdFBhdGhJbXBsOwpmdW5jdGlvbiBwc2J0U2lnbkltcGwocHNidCwgcHJpdmF0ZUtleSwgbmV0d29yaykgewogIG5ldHdvcmsgPSBuZXR3b3JrIHx8IGJpdGNvaW5qc19saWJfMS5uZXR3b3Jrcy5iaXRjb2luOwogIGNvbnN0IHByaXZLZXlIZXggPSAoMCwgdHhCdWlsZF8xLnByaXZhdGVLZXlGcm9tV0lGKShwcml2YXRlS2V5LCBuZXR3b3JrKTsKICBjb25zdCBzaWduZXIgPSB7CiAgICBwdWJsaWNLZXk6IEJ1ZmZlci5hbGxvYygwKSwKICAgIHNpZ24oaGFzaCkgewogICAgICByZXR1cm4gKDAsIHR4QnVpbGRfMS5zaWduKShoYXNoLCBwcml2S2V5SGV4KTsKICAgIH0sCiAgICBzaWduU2Nobm9ycihoYXNoKSB7CiAgICAgIGNvbnN0IHR3ZWFrZWRQcml2S2V5ID0gdGFwcm9vdC50YXByb290VHdlYWtQcml2S2V5KGNyeXB0b19saWJfMS5iYXNlLmZyb21IZXgocHJpdktleUhleCkpOwogICAgICByZXR1cm4gQnVmZmVyLmZyb20oc2Nobm9yci5zaWduKGhhc2gsIHR3ZWFrZWRQcml2S2V5LCBjcnlwdG9fbGliXzEuYmFzZS5yYW5kb21CeXRlcygzMikpKTsKICAgIH0KICB9OwogIGNvbnN0IGFsbG93ZWRTaWdoYXNoVHlwZXMgPSBbYml0Y29pbmpzX2xpYl8xLlRyYW5zYWN0aW9uLlNJR0hBU0hfU0lOR0xFIHwgYml0Y29pbmpzX2xpYl8xLlRyYW5zYWN0aW9uLlNJR0hBU0hfQU5ZT05FQ0FOUEFZLCBiaXRjb2luanNfbGliXzEuVHJhbnNhY3Rpb24uU0lHSEFTSF9BTEwgfCBiaXRjb2luanNfbGliXzEuVHJhbnNhY3Rpb24uU0lHSEFTSF9BTllPTkVDQU5QQVksIGJpdGNvaW5qc19saWJfMS5UcmFuc2FjdGlvbi5TSUdIQVNIX0FMTCwgYml0Y29pbmpzX2xpYl8xLlRyYW5zYWN0aW9uLlNJR0hBU0hfREVGQVVMVF07CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBwc2J0LmlucHV0Q291bnQ7IGkrKykgewogICAgaWYgKCgwLCBiaXAzNzFfMS5pc1RhcHJvb3RJbnB1dCkocHNidC5kYXRhLmlucHV0c1tpXSkpIHsKICAgICAgY29uc3QgaW5wdXQgPSBwc2J0LmRhdGEuaW5wdXRzW2ldOwogICAgICBpZiAoIWlucHV0LnRhcEludGVybmFsS2V5KSB7CiAgICAgICAgaW5wdXQudGFwSW50ZXJuYWxLZXkgPSAoMCwgYmlwMzcxXzEudG9YT25seSkoKDAsIHR4QnVpbGRfMS53aWYyUHVibGljKShwcml2YXRlS2V5LCBuZXR3b3JrKSk7CiAgICAgIH0KICAgICAgc2lnbmVyLnB1YmxpY0tleSA9IEJ1ZmZlci5mcm9tKHRhcHJvb3QudGFwcm9vdFR3ZWFrUHVia2V5KCgwLCBiaXAzNzFfMS50b1hPbmx5KSgoMCwgdHhCdWlsZF8xLndpZjJQdWJsaWMpKHByaXZhdGVLZXksIG5ldHdvcmspKSlbMF0pOwogICAgfSBlbHNlIHsKICAgICAgc2lnbmVyLnB1YmxpY0tleSA9ICgwLCB0eEJ1aWxkXzEud2lmMlB1YmxpYykocHJpdmF0ZUtleSwgbmV0d29yayk7CiAgICB9CiAgICB0cnkgewogICAgICBwc2J0LnNpZ25JbnB1dChpLCBzaWduZXIsIGFsbG93ZWRTaWdoYXNoVHlwZXMpOwogICAgfSBjYXRjaCAoZSkge30KICB9Cn0KZXhwb3J0cy5wc2J0U2lnbkltcGwgPSBwc2J0U2lnbkltcGw7CmZ1bmN0aW9uIGV4dHJhY3RQc2J0VHJhbnNhY3Rpb24odHhIZXgsIG5ldHdvcmssIG1heGltdW1GZWVSYXRlKSB7CiAgY29uc3QgcHNidCA9IHBzYnRfMS5Qc2J0LmZyb21IZXgodHhIZXgsIHsKICAgIG5ldHdvcmssCiAgICBtYXhpbXVtRmVlUmF0ZTogbWF4aW11bUZlZVJhdGUgPyBtYXhpbXVtRmVlUmF0ZSA6IGRlZmF1bHRNYXhpbXVtRmVlUmF0ZQogIH0pOwogIGxldCBleHRyYWN0ZWRUcmFuc2FjdGlvbjsKICB0cnkgewogICAgZXh0cmFjdGVkVHJhbnNhY3Rpb24gPSBwc2J0LmZpbmFsaXplQWxsSW5wdXRzKCkuZXh0cmFjdFRyYW5zYWN0aW9uKCk7CiAgfSBjYXRjaCAoZSkgewogICAgZXh0cmFjdGVkVHJhbnNhY3Rpb24gPSBwc2J0LmV4dHJhY3RUcmFuc2FjdGlvbigpOwogICAgY29uc29sZS5sb2coZSk7CiAgfQogIHJldHVybiBleHRyYWN0ZWRUcmFuc2FjdGlvbi50b0hleCgpOwp9CmV4cG9ydHMuZXh0cmFjdFBzYnRUcmFuc2FjdGlvbiA9IGV4dHJhY3RQc2J0VHJhbnNhY3Rpb247CmZ1bmN0aW9uIGdlbmVyYXRlVW5zaWduZWRMaXN0aW5nUHNidChsaXN0aW5nRGF0YSwgbmV0d29yaywgcHVibGljS2V5KSB7CiAgY29uc3Qgc2NyaXB0ID0gYml0Y29pbmpzX2xpYl8xLmFkZHJlc3MudG9PdXRwdXRTY3JpcHQobGlzdGluZ0RhdGEubmZ0QWRkcmVzcywgbmV0d29yayk7CiAgaWYgKCgoMCwgcHNidHV0aWxzXzEuaXNQMlNIU2NyaXB0KShzY3JpcHQpIHx8ICgwLCBwc2J0dXRpbHNfMS5pc1AyVFIpKHNjcmlwdCkpICYmICFwdWJsaWNLZXkpIHsKICAgIHRocm93IG5ldyBFcnJvcigiTWlzc2luZyBwdWJsaWNLZXkiKTsKICB9CiAgY29uc3QgdHggPSB7CiAgICBpbnB1dHM6IFtdLAogICAgb3V0cHV0czogW10KICB9OwogIGxldCBwbGFjZWhvbGRlckFkZHJlc3MgPSAiYmMxcGN5ajVtdDJxNHQ0cHk4am51cjh2cHh2eHhjaGtlNHB6eTd0ZHI5eXZqM3Uza2RmZ3JqNnN3M3J6bXIiOwogIGlmIChuZXR3b3JrID09PSBiaXRjb2luanNfbGliXzEubmV0d29ya3MudGVzdG5ldCkgewogICAgcGxhY2Vob2xkZXJBZGRyZXNzID0gInRiMXBjeWo1bXQycTR0NHB5OGpudXI4dnB4dnh4Y2hrZTRwenk3dGRyOXl2ajN1M2tkZmdyajZzZWU0ZHB2IjsKICB9CiAgdHguaW5wdXRzLnB1c2goewogICAgdHhJZDogIjAiLnJlcGVhdCg2NCksCiAgICB2T3V0OiAwLAogICAgYW1vdW50OiAwLAogICAgYWRkcmVzczogcGxhY2Vob2xkZXJBZGRyZXNzCiAgfSwgewogICAgdHhJZDogIjAiLnJlcGVhdCg2NCksCiAgICB2T3V0OiAxLAogICAgYW1vdW50OiAwLAogICAgYWRkcmVzczogcGxhY2Vob2xkZXJBZGRyZXNzCiAgfSk7CiAgdHgub3V0cHV0cy5wdXNoKHsKICAgIGFkZHJlc3M6IHBsYWNlaG9sZGVyQWRkcmVzcywKICAgIGFtb3VudDogMAogIH0sIHsKICAgIGFkZHJlc3M6IHBsYWNlaG9sZGVyQWRkcmVzcywKICAgIGFtb3VudDogMAogIH0pOwogIHR4LmlucHV0cy5wdXNoKHsKICAgIHR4SWQ6IGxpc3RpbmdEYXRhLm5mdFV0eG8udHhIYXNoLAogICAgdk91dDogbGlzdGluZ0RhdGEubmZ0VXR4by52b3V0LAogICAgYWRkcmVzczogbGlzdGluZ0RhdGEubmZ0QWRkcmVzcywKICAgIGFtb3VudDogbGlzdGluZ0RhdGEubmZ0VXR4by5jb2luQW1vdW50LAogICAgcHVibGljS2V5OiBwdWJsaWNLZXksCiAgICBub25XaXRuZXNzVXR4bzogbGlzdGluZ0RhdGEubmZ0VXR4by5yYXdUcmFuc2F0aW9uLAogICAgc2lnaGFzaFR5cGU6IGJpdGNvaW5qc19saWJfMS5UcmFuc2FjdGlvbi5TSUdIQVNIX1NJTkdMRSB8IGJpdGNvaW5qc19saWJfMS5UcmFuc2FjdGlvbi5TSUdIQVNIX0FOWU9ORUNBTlBBWQogIH0pOwogIHR4Lm91dHB1dHMucHVzaCh7CiAgICBhZGRyZXNzOiBsaXN0aW5nRGF0YS5yZWNlaXZlQnRjQWRkcmVzcywKICAgIGFtb3VudDogbGlzdGluZ0RhdGEucHJpY2UKICB9KTsKICBjb25zdCBwc2J0SGV4ID0gYnVpbGRQc2J0KHR4LCBuZXR3b3JrKTsKICByZXR1cm4gY3J5cHRvX2xpYl8xLmJhc2UudG9CYXNlNjQoY3J5cHRvX2xpYl8xLmJhc2UuZnJvbUhleChwc2J0SGV4KSk7Cn0KZXhwb3J0cy5nZW5lcmF0ZVVuc2lnbmVkTGlzdGluZ1BzYnQgPSBnZW5lcmF0ZVVuc2lnbmVkTGlzdGluZ1BzYnQ7CmZ1bmN0aW9uIGdlbmVyYXRlU2lnbmVkTGlzdGluZ1BzYnQobGlzdGluZ0RhdGEsIHByaXZhdGVLZXksIG5ldHdvcmspIHsKICBjb25zdCBwdWJsaWNLZXkgPSBjcnlwdG9fbGliXzEuYmFzZS50b0hleCgoMCwgdHhCdWlsZF8xLndpZjJQdWJsaWMpKHByaXZhdGVLZXksIG5ldHdvcmspKTsKICByZXR1cm4gcHNidFNpZ24oZ2VuZXJhdGVVbnNpZ25lZExpc3RpbmdQc2J0KGxpc3RpbmdEYXRhLCBuZXR3b3JrLCBwdWJsaWNLZXkpLCBwcml2YXRlS2V5LCBuZXR3b3JrKTsKfQpleHBvcnRzLmdlbmVyYXRlU2lnbmVkTGlzdGluZ1BzYnQgPSBnZW5lcmF0ZVNpZ25lZExpc3RpbmdQc2J0Owpjb25zdCBTRUxMRVJfSU5ERVggPSAyOwpjb25zdCBEVU1NWV9BTU9VTlQgPSA2MDA7CmNvbnN0IERVU1RfT1VUUFVUX0xJTUlUID0gNTQ2OwpmdW5jdGlvbiBnZW5lcmF0ZVVuc2lnbmVkQnV5aW5nUHNidChidXlpbmdEYXRhLCBuZXR3b3JrLCBwdWJsaWNLZXkpIHsKICBjb25zdCB0eCA9IHsKICAgIGlucHV0czogW10sCiAgICBvdXRwdXRzOiBbXSwKICAgIGFkZHJlc3M6IGJ1eWluZ0RhdGEucGF5bWVudEFuZENoYW5nZUFkZHJlc3MsCiAgICBmZWVQZXJCOiBidXlpbmdEYXRhLmZlZVJhdGUKICB9OwogIGJ1eWluZ0RhdGEuZHVtbXlVdHhvcy5mb3JFYWNoKGR1bW15VXR4byA9PiB7CiAgICB0eC5pbnB1dHMucHVzaCh7CiAgICAgIHR4SWQ6IGR1bW15VXR4by50eEhhc2gsCiAgICAgIHZPdXQ6IGR1bW15VXR4by52b3V0LAogICAgICBhZGRyZXNzOiBidXlpbmdEYXRhLnBheW1lbnRBbmRDaGFuZ2VBZGRyZXNzLAogICAgICBhbW91bnQ6IGR1bW15VXR4by5jb2luQW1vdW50LAogICAgICBwdWJsaWNLZXk6IHB1YmxpY0tleSwKICAgICAgbm9uV2l0bmVzc1V0eG86IGR1bW15VXR4by5yYXdUcmFuc2F0aW9uCiAgICB9KTsKICB9KTsKICB0eC5vdXRwdXRzLnB1c2goewogICAgYWRkcmVzczogYnV5aW5nRGF0YS5wYXltZW50QW5kQ2hhbmdlQWRkcmVzcywKICAgIGFtb3VudDogYnV5aW5nRGF0YS5kdW1teVV0eG9zLnJlZHVjZSgoc3VtLCBkdW1teVV0eG8pID0+IHN1bSArIGR1bW15VXR4by5jb2luQW1vdW50LCAwKQogIH0pOwogIGNvbnN0IG5mdE91dHB1dHMgPSBbXTsKICBidXlpbmdEYXRhLnNlbGxlclBzYnRzLmZvckVhY2goc2VsbGVyUHNidCA9PiB7CiAgICBjb25zdCBwc2J0ID0gcHNidF8xLlBzYnQuZnJvbUJhc2U2NChzZWxsZXJQc2J0LCB7CiAgICAgIG5ldHdvcmsKICAgIH0pOwogICAgY29uc3QgbmZ0SW5wdXQgPSBwc2J0LmRhdGEuZ2xvYmFsTWFwLnVuc2lnbmVkVHgudHguaW5zW1NFTExFUl9JTkRFWF07CiAgICBuZnRPdXRwdXRzLnB1c2gocHNidC5kYXRhLmdsb2JhbE1hcC51bnNpZ25lZFR4LnR4Lm91dHNbU0VMTEVSX0lOREVYXSk7CiAgICBsZXQgbmZ0VXR4byA9IHBzYnQuZGF0YS5pbnB1dHNbU0VMTEVSX0lOREVYXS53aXRuZXNzVXR4bzsKICAgIGlmICghbmZ0VXR4bykgewogICAgICBuZnRVdHhvID0gYml0Y29pbmpzX2xpYl8xLlRyYW5zYWN0aW9uLmZyb21CdWZmZXIocHNidC5kYXRhLmlucHV0c1tTRUxMRVJfSU5ERVhdLm5vbldpdG5lc3NVdHhvKS5vdXRzW25mdElucHV0LmluZGV4XTsKICAgIH0KICAgIHR4LmlucHV0cy5wdXNoKHsKICAgICAgdHhJZDogY3J5cHRvX2xpYl8xLmJhc2UudG9IZXgoKDAsIGJ1ZmZlcnV0aWxzXzEucmV2ZXJzZUJ1ZmZlcikobmZ0SW5wdXQuaGFzaCkpLAogICAgICB2T3V0OiBuZnRJbnB1dC5pbmRleCwKICAgICAgYWRkcmVzczogYml0Y29pbmpzX2xpYl8xLmFkZHJlc3MuZnJvbU91dHB1dFNjcmlwdChuZnRVdHhvLnNjcmlwdCwgbmV0d29yayksCiAgICAgIGFtb3VudDogbmZ0VXR4by52YWx1ZSwKICAgICAgc2lnaGFzaFR5cGU6IGJpdGNvaW5qc19saWJfMS5UcmFuc2FjdGlvbi5TSUdIQVNIX1NJTkdMRSB8IGJpdGNvaW5qc19saWJfMS5UcmFuc2FjdGlvbi5TSUdIQVNIX0FOWU9ORUNBTlBBWQogICAgfSk7CiAgICB0eC5vdXRwdXRzLnB1c2goewogICAgICBhZGRyZXNzOiBidXlpbmdEYXRhLnJlY2VpdmVOZnRBZGRyZXNzLAogICAgICBhbW91bnQ6IG5mdFV0eG8udmFsdWUKICAgIH0pOwogIH0pOwogIG5mdE91dHB1dHMuZm9yRWFjaChuZnRPdXRwdXQgPT4gewogICAgdHgub3V0cHV0cy5wdXNoKHsKICAgICAgYWRkcmVzczogYml0Y29pbmpzX2xpYl8xLmFkZHJlc3MuZnJvbU91dHB1dFNjcmlwdChuZnRPdXRwdXQuc2NyaXB0LCBuZXR3b3JrKSwKICAgICAgYW1vdW50OiBuZnRPdXRwdXQudmFsdWUKICAgIH0pOwogIH0pOwogIGJ1eWluZ0RhdGEucGF5bWVudFV0eG9zLmZvckVhY2gocGF5bWVudFV0eG8gPT4gewogICAgdHguaW5wdXRzLnB1c2goewogICAgICB0eElkOiBwYXltZW50VXR4by50eEhhc2gsCiAgICAgIHZPdXQ6IHBheW1lbnRVdHhvLnZvdXQsCiAgICAgIGFkZHJlc3M6IGJ1eWluZ0RhdGEucGF5bWVudEFuZENoYW5nZUFkZHJlc3MsCiAgICAgIGFtb3VudDogcGF5bWVudFV0eG8uY29pbkFtb3VudCwKICAgICAgcHVibGljS2V5OiBwdWJsaWNLZXksCiAgICAgIG5vbldpdG5lc3NVdHhvOiBwYXltZW50VXR4by5yYXdUcmFuc2F0aW9uCiAgICB9KTsKICB9KTsKICBidXlpbmdEYXRhLmR1bW15VXR4b3MuZm9yRWFjaCgoKSA9PiB7CiAgICB0eC5vdXRwdXRzLnB1c2goewogICAgICBhZGRyZXNzOiBidXlpbmdEYXRhLnBheW1lbnRBbmRDaGFuZ2VBZGRyZXNzLAogICAgICBhbW91bnQ6IERVTU1ZX0FNT1VOVAogICAgfSk7CiAgfSk7CiAgY29uc3QgY2hhbmdlQW1vdW50ID0gcGFyc2VJbnQoKDAsIHR4QnVpbGRfMS5zaWduQnRjKSh0eCwgIiIsIG5ldHdvcmssIHVuZGVmaW5lZCwgZmFsc2UsIHRydWUpKTsKICBpZiAoY2hhbmdlQW1vdW50ID49IERVU1RfT1VUUFVUX0xJTUlUKSB7CiAgICB0eC5vdXRwdXRzLnB1c2goewogICAgICBhZGRyZXNzOiBidXlpbmdEYXRhLnBheW1lbnRBbmRDaGFuZ2VBZGRyZXNzLAogICAgICBhbW91bnQ6IGNoYW5nZUFtb3VudAogICAgfSk7CiAgfQogIHJldHVybiBjcnlwdG9fbGliXzEuYmFzZS50b0Jhc2U2NChjcnlwdG9fbGliXzEuYmFzZS5mcm9tSGV4KGJ1aWxkUHNidCh0eCwgbmV0d29yaykpKTsKfQpleHBvcnRzLmdlbmVyYXRlVW5zaWduZWRCdXlpbmdQc2J0ID0gZ2VuZXJhdGVVbnNpZ25lZEJ1eWluZ1BzYnQ7CmZ1bmN0aW9uIG1lcmdlU2lnbmVkQnV5aW5nUHNidChzaWduZWRCdXlpbmdQc2J0LCBzaWduZWRMaXN0aW5nUHNidHMpIHsKICBjb25zdCBidXllclNpZ25lZFBzYnQgPSBwc2J0XzEuUHNidC5mcm9tQmFzZTY0KHNpZ25lZEJ1eWluZ1BzYnQpOwogIGNvbnN0IG5mdEluZGV4ID0gc2lnbmVkTGlzdGluZ1BzYnRzLmxlbmd0aCArIDE7CiAgc2lnbmVkTGlzdGluZ1BzYnRzLmZvckVhY2goKHNpZ25lZExpc3RpbmdQc2J0LCBpKSA9PiB7CiAgICBjb25zdCBzZWxsZXJTaWduZWRQc2J0ID0gcHNidF8xLlBzYnQuZnJvbUJhc2U2NChzaWduZWRMaXN0aW5nUHNidCk7CiAgICBidXllclNpZ25lZFBzYnQuZGF0YS5nbG9iYWxNYXAudW5zaWduZWRUeC50eC5pbnNbbmZ0SW5kZXggKyBpXSA9IHNlbGxlclNpZ25lZFBzYnQuZGF0YS5nbG9iYWxNYXAudW5zaWduZWRUeC50eC5pbnNbU0VMTEVSX0lOREVYXTsKICAgIGJ1eWVyU2lnbmVkUHNidC5kYXRhLmlucHV0c1tuZnRJbmRleCArIGldID0gc2VsbGVyU2lnbmVkUHNidC5kYXRhLmlucHV0c1tTRUxMRVJfSU5ERVhdOwogIH0pOwogIHJldHVybiBidXllclNpZ25lZFBzYnQ7Cn0KZXhwb3J0cy5tZXJnZVNpZ25lZEJ1eWluZ1BzYnQgPSBtZXJnZVNpZ25lZEJ1eWluZ1BzYnQ7CmZ1bmN0aW9uIGdlbmVyYXRlU2lnbmVkQnV5aW5nVHgoYnV5aW5nRGF0YSwgcHJpdmF0ZUtleSwgbmV0d29yaykgewogIGNvbnN0IHB1YmxpY0tleSA9IGNyeXB0b19saWJfMS5iYXNlLnRvSGV4KCgwLCB0eEJ1aWxkXzEud2lmMlB1YmxpYykocHJpdmF0ZUtleSwgbmV0d29yaykpOwogIGNvbnN0IHNpZ25lZEJ1eWluZ1BzYnQgPSBwc2J0U2lnbihnZW5lcmF0ZVVuc2lnbmVkQnV5aW5nUHNidChidXlpbmdEYXRhLCBuZXR3b3JrLCBwdWJsaWNLZXkpLCBwcml2YXRlS2V5LCBuZXR3b3JrKTsKICByZXR1cm4gZXh0cmFjdFBzYnRUcmFuc2FjdGlvbihtZXJnZVNpZ25lZEJ1eWluZ1BzYnQoc2lnbmVkQnV5aW5nUHNidCwgYnV5aW5nRGF0YS5zZWxsZXJQc2J0cykudG9IZXgoKSwgbmV0d29yayk7Cn0KZXhwb3J0cy5nZW5lcmF0ZVNpZ25lZEJ1eWluZ1R4ID0gZ2VuZXJhdGVTaWduZWRCdXlpbmdUeDsKZnVuY3Rpb24gZ2VuZXJhdGVNUENVbnNpZ25lZExpc3RpbmdQU0JUKHBzYnRCYXNlNjQsIHB1YktleUhleCwgbmV0d29yaykgewogIGNvbnN0IHBzYnQgPSBwc2J0XzEuUHNidC5mcm9tQmFzZTY0KHBzYnRCYXNlNjQsIHsKICAgIG5ldHdvcmsKICB9KTsKICBjb25zdCBwdWJsaWNLZXkgPSBjcnlwdG9fbGliXzEuYmFzZS5mcm9tSGV4KHB1YktleUhleCk7CiAgY29uc3Qgc2lnaGFzaFR5cGVzID0gW2JpdGNvaW5qc19saWJfMS5UcmFuc2FjdGlvbi5TSUdIQVNIX1NJTkdMRSB8IGJpdGNvaW5qc19saWJfMS5UcmFuc2FjdGlvbi5TSUdIQVNIX0FOWU9ORUNBTlBBWV07CiAgbGV0IHNpZ25IYXNoTGlzdCA9IFtdOwogIGZvciAobGV0IGkgPSAwOyBpIDwgcHNidC5pbnB1dENvdW50OyBpKyspIHsKICAgIGlmIChpICE9IFNFTExFUl9JTkRFWCkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgaGFzaCwKICAgICAgc2lnaGFzaFR5cGUKICAgIH0gPSBwc2J0LmdldEhhc2hBbmRTaWdoYXNoVHlwZShpLCBwdWJsaWNLZXksIHNpZ2hhc2hUeXBlcyk7CiAgICBzaWduSGFzaExpc3QucHVzaChjcnlwdG9fbGliXzEuYmFzZS50b0hleChoYXNoKSk7CiAgfQogIHJldHVybiB7CiAgICBwc2J0QmFzZTY0OiBwc2J0QmFzZTY0LAogICAgc2lnbkhhc2hMaXN0OiBzaWduSGFzaExpc3QKICB9Owp9CmV4cG9ydHMuZ2VuZXJhdGVNUENVbnNpZ25lZExpc3RpbmdQU0JUID0gZ2VuZXJhdGVNUENVbnNpZ25lZExpc3RpbmdQU0JUOwpmdW5jdGlvbiBnZW5lcmF0ZU1QQ1NpZ25lZExpc3RpbmdQU0JUKHBzYnRCYXNlNjQsIHB1YktleUhleCwgc2lnbmF0dXJlLCBuZXR3b3JrKSB7CiAgY29uc3QgcHNidCA9IHBzYnRfMS5Qc2J0LmZyb21CYXNlNjQocHNidEJhc2U2NCwgewogICAgbmV0d29yawogIH0pOwogIGNvbnN0IHB1YmxpY0tleSA9IGNyeXB0b19saWJfMS5iYXNlLmZyb21IZXgocHViS2V5SGV4KTsKICBjb25zdCBwYXJ0aWFsU2lnID0gW3sKICAgIHB1YmtleTogcHVibGljS2V5LAogICAgc2lnbmF0dXJlOiBic2NyaXB0LnNpZ25hdHVyZS5lbmNvZGUoY3J5cHRvX2xpYl8xLmJhc2UuZnJvbUhleChzaWduYXR1cmUpLCBiaXRjb2luanNfbGliXzEuVHJhbnNhY3Rpb24uU0lHSEFTSF9TSU5HTEUgfCBiaXRjb2luanNfbGliXzEuVHJhbnNhY3Rpb24uU0lHSEFTSF9BTllPTkVDQU5QQVkpCiAgfV07CiAgcHNidC5kYXRhLnVwZGF0ZUlucHV0KFNFTExFUl9JTkRFWCwgewogICAgcGFydGlhbFNpZwogIH0pOwogIHJldHVybiBwc2J0LnRvQmFzZTY0KCk7Cn0KZXhwb3J0cy5nZW5lcmF0ZU1QQ1NpZ25lZExpc3RpbmdQU0JUID0gZ2VuZXJhdGVNUENTaWduZWRMaXN0aW5nUFNCVDsKZnVuY3Rpb24gZ2VuZXJhdGVNUENVbnNpZ25lZEJ1eWluZ1BTQlQocHNidEJhc2U2NCwgcHViS2V5SGV4LCBuZXR3b3JrKSB7CiAgbGV0IGJhdGNoU2l6ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogMTsKICBjb25zdCBwc2J0ID0gcHNidF8xLlBzYnQuZnJvbUJhc2U2NChwc2J0QmFzZTY0LCB7CiAgICBuZXR3b3JrCiAgfSk7CiAgY29uc3QgcHVibGljS2V5ID0gY3J5cHRvX2xpYl8xLmJhc2UuZnJvbUhleChwdWJLZXlIZXgpOwogIGNvbnN0IHNpZ2hhc2hUeXBlcyA9IFtiaXRjb2luanNfbGliXzEuVHJhbnNhY3Rpb24uU0lHSEFTSF9BTExdOwogIGxldCBzaWduSGFzaExpc3QgPSBbXTsKICBjb25zdCBzZWxsZXJJbmRleCA9IGJhdGNoU2l6ZSArIDE7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBwc2J0LmlucHV0Q291bnQ7IGkrKykgewogICAgaWYgKGkgPj0gc2VsbGVySW5kZXggJiYgaSA8IHNlbGxlckluZGV4ICsgYmF0Y2hTaXplKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgY29uc3QgewogICAgICBoYXNoLAogICAgICBzaWdoYXNoVHlwZQogICAgfSA9IHBzYnQuZ2V0SGFzaEFuZFNpZ2hhc2hUeXBlKGksIHB1YmxpY0tleSwgc2lnaGFzaFR5cGVzKTsKICAgIHNpZ25IYXNoTGlzdC5wdXNoKGNyeXB0b19saWJfMS5iYXNlLnRvSGV4KGhhc2gpKTsKICB9CiAgcmV0dXJuIHsKICAgIHBzYnRCYXNlNjQ6IHBzYnRCYXNlNjQsCiAgICBzaWduSGFzaExpc3Q6IHNpZ25IYXNoTGlzdAogIH07Cn0KZXhwb3J0cy5nZW5lcmF0ZU1QQ1Vuc2lnbmVkQnV5aW5nUFNCVCA9IGdlbmVyYXRlTVBDVW5zaWduZWRCdXlpbmdQU0JUOwpmdW5jdGlvbiBnZW5lcmF0ZU1QQ1NpZ25lZEJ1eWluZ1R4KHBzYnRCYXNlNjQsIHB1YktleUhleCwgc2lnbmF0dXJlTGlzdCwgbmV0d29yaykgewogIGxldCBiYXRjaFNpemUgPSBhcmd1bWVudHMubGVuZ3RoID4gNCAmJiBhcmd1bWVudHNbNF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1s0XSA6IDE7CiAgY29uc3QgcHNidCA9IHBzYnRfMS5Qc2J0LmZyb21CYXNlNjQocHNidEJhc2U2NCwgewogICAgbmV0d29yawogIH0pOwogIGNvbnN0IHB1YmxpY0tleSA9IGNyeXB0b19saWJfMS5iYXNlLmZyb21IZXgocHViS2V5SGV4KTsKICBjb25zdCBzZWxsZXJJbmRleCA9IGJhdGNoU2l6ZSArIDE7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBwc2J0LmlucHV0Q291bnQ7IGkrKykgewogICAgaWYgKGkgPj0gc2VsbGVySW5kZXggJiYgaSA8IHNlbGxlckluZGV4ICsgYmF0Y2hTaXplKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgY29uc3QgcGFydGlhbFNpZyA9IFt7CiAgICAgIHB1YmtleTogcHVibGljS2V5LAogICAgICBzaWduYXR1cmU6IGJzY3JpcHQuc2lnbmF0dXJlLmVuY29kZShjcnlwdG9fbGliXzEuYmFzZS5mcm9tSGV4KHNpZ25hdHVyZUxpc3RbaV0pLCBiaXRjb2luanNfbGliXzEuVHJhbnNhY3Rpb24uU0lHSEFTSF9BTEwpCiAgICB9XTsKICAgIHBzYnQuZGF0YS51cGRhdGVJbnB1dChpLCB7CiAgICAgIHBhcnRpYWxTaWcKICAgIH0pOwogIH0KICByZXR1cm4gZXh0cmFjdFBzYnRUcmFuc2FjdGlvbihwc2J0LnRvSGV4KCksIG5ldHdvcmspOwp9CmV4cG9ydHMuZ2VuZXJhdGVNUENTaWduZWRCdXlpbmdUeCA9IGdlbmVyYXRlTVBDU2lnbmVkQnV5aW5nVHg7CmZ1bmN0aW9uIGdlbmVyYXRlTVBDVW5zaWduZWRQU0JUKHBzYnRTdHIsIHB1YktleUhleCwgbmV0d29yaykgewogIGNvbnN0IHBzYnQgPSBnZXRQc2J0RnJvbVN0cmluZyhwc2J0U3RyLCBuZXR3b3JrKTsKICBjb25zdCBwdWJsaWNLZXkgPSBjcnlwdG9fbGliXzEuYmFzZS5mcm9tSGV4KHB1YktleUhleCk7CiAgY29uc3QgYWxsb3dlZFNpZ2hhc2hUeXBlcyA9IFtiaXRjb2luanNfbGliXzEuVHJhbnNhY3Rpb24uU0lHSEFTSF9TSU5HTEUgfCBiaXRjb2luanNfbGliXzEuVHJhbnNhY3Rpb24uU0lHSEFTSF9BTllPTkVDQU5QQVksIGJpdGNvaW5qc19saWJfMS5UcmFuc2FjdGlvbi5TSUdIQVNIX1NJTkdMRSB8IGJpdGNvaW5qc19saWJfMS5UcmFuc2FjdGlvbi5TSUdIQVNIX0FOWU9ORUNBTlBBWSwgYml0Y29pbmpzX2xpYl8xLlRyYW5zYWN0aW9uLlNJR0hBU0hfQUxMIHwgYml0Y29pbmpzX2xpYl8xLlRyYW5zYWN0aW9uLlNJR0hBU0hfQU5ZT05FQ0FOUEFZLCBiaXRjb2luanNfbGliXzEuVHJhbnNhY3Rpb24uU0lHSEFTSF9BTEwsIGJpdGNvaW5qc19saWJfMS5UcmFuc2FjdGlvbi5TSUdIQVNIX0RFRkFVTFRdOwogIDsKICBsZXQgc2lnbkhhc2hMaXN0ID0gW107CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBwc2J0LmlucHV0Q291bnQ7IGkrKykgewogICAgdHJ5IHsKICAgICAgY29uc3QgewogICAgICAgIGhhc2gsCiAgICAgICAgc2lnaGFzaFR5cGUKICAgICAgfSA9IHBzYnQuZ2V0SGFzaEFuZFNpZ2hhc2hUeXBlKGksIHB1YmxpY0tleSwgYWxsb3dlZFNpZ2hhc2hUeXBlcyk7CiAgICAgIHNpZ25IYXNoTGlzdC5wdXNoKGNyeXB0b19saWJfMS5iYXNlLnRvSGV4KGhhc2gpKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgY29uc3QgcyA9IGdldFJhbmRvbUhhc2goKTsKICAgICAgc2lnbkhhc2hMaXN0LnB1c2gocyk7CiAgICB9CiAgfQogIGNvbnN0IG0gPSBuZXcgTWFwKCk7CiAgc2lnbkhhc2hMaXN0Lm1hcCgoZSwgaSkgPT4gewogICAgbGV0IGNvdW50ID0gbS5nZXQoZSk7CiAgICBjb3VudCA9IGNvdW50ID09IHVuZGVmaW5lZCA/IDAgOiBjb3VudDsKICAgIGlmIChjb3VudCAhPSB1bmRlZmluZWQgJiYgY291bnQgPj0gMSkgewogICAgICBzaWduSGFzaExpc3RbaV0gPSBnZXRSYW5kb21IYXNoKCk7CiAgICB9CiAgICBtLnNldChlLCBjb3VudCArIDEpOwogIH0pOwogIHJldHVybiB7CiAgICBwc2J0U3RyOiBwc2J0U3RyLAogICAgc2lnbkhhc2hMaXN0OiBzaWduSGFzaExpc3QKICB9Owp9CmV4cG9ydHMuZ2VuZXJhdGVNUENVbnNpZ25lZFBTQlQgPSBnZW5lcmF0ZU1QQ1Vuc2lnbmVkUFNCVDsKZnVuY3Rpb24gZ2V0UmFuZG9tSGFzaCgpIHsKICBjb25zdCBoID0gKDAsIGNyeXB0b18xLnNoYTI1NikoKDAsIGNyeXB0b18yLnJhbmRvbUJ5dGVzKSgzMikpOwogIGNvbnN0IHMgPSBjcnlwdG9fbGliXzEuYmFzZS50b0hleChoLnNsaWNlKDAsIDI4KSk7CiAgcmV0dXJuICJmZmZmZmZmZiIgKyBzOwp9CmZ1bmN0aW9uIGdlbmVyYXRlTVBDU2lnbmVkUFNCVChwc2J0U3RyLCBwdWJLZXlIZXgsIHNpZ25hdHVyZUxpc3QsIG5ldHdvcmspIHsKICBjb25zdCBwc2J0ID0gZ2V0UHNidEZyb21TdHJpbmcocHNidFN0ciwgbmV0d29yayk7CiAgY29uc3QgcHVibGljS2V5ID0gY3J5cHRvX2xpYl8xLmJhc2UuZnJvbUhleChwdWJLZXlIZXgpOwogIGxldCBzaWdoYXNoVHlwZSA9IGJpdGNvaW5qc19saWJfMS5UcmFuc2FjdGlvbi5TSUdIQVNIX0FMTDsKICBjb25zdCByZXMgPSBnZW5lcmF0ZU1QQ1Vuc2lnbmVkUFNCVChwc2J0U3RyLCBwdWJLZXlIZXgsIG5ldHdvcmspOwogIGNvbnN0IHNpZ25IYXNoTGlzdCA9IHJlcy5zaWduSGFzaExpc3Q7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBwc2J0LmlucHV0Q291bnQ7IGkrKykgewogICAgaWYgKHNpZ25IYXNoTGlzdFtpXS5zbGljZSgwLCA4KSA9PSAiZmZmZmZmZmYiKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgaWYgKHBzYnQuZGF0YS5pbnB1dHNbaV0uc2lnaGFzaFR5cGUgIT0gdW5kZWZpbmVkKSB7CiAgICAgIHNpZ2hhc2hUeXBlID0gcHNidC5kYXRhLmlucHV0c1tpXS5zaWdoYXNoVHlwZTsKICAgIH0KICAgIGNvbnN0IHBhcnRpYWxTaWcgPSBbewogICAgICBwdWJrZXk6IHB1YmxpY0tleSwKICAgICAgc2lnbmF0dXJlOiBic2NyaXB0LnNpZ25hdHVyZS5lbmNvZGUoY3J5cHRvX2xpYl8xLmJhc2UuZnJvbUhleChzaWduYXR1cmVMaXN0W2ldKSwgc2lnaGFzaFR5cGUpCiAgICB9XTsKICAgIHRyeSB7CiAgICAgIHBzYnQuZGF0YS51cGRhdGVJbnB1dChpLCB7CiAgICAgICAgcGFydGlhbFNpZwogICAgICB9KTsKICAgIH0gY2F0Y2ggKGUpIHt9CiAgfQogIHJldHVybiBwc2J0LnRvSGV4KCk7Cn0KZXhwb3J0cy5nZW5lcmF0ZU1QQ1NpZ25lZFBTQlQgPSBnZW5lcmF0ZU1QQ1NpZ25lZFBTQlQ7CmZ1bmN0aW9uIGdldFBzYnRGcm9tU3RyaW5nKHBzYnRTdHIsIG5ldHdvcmspIHsKICBsZXQgcHNidDsKICBpZiAoY3J5cHRvX2xpYl8xLmJhc2UuaXNIZXhTdHJpbmcoIjB4IiArIHBzYnRTdHIpKSB7CiAgICBwc2J0ID0gcHNidF8xLlBzYnQuZnJvbUhleChwc2J0U3RyLCB7CiAgICAgIG5ldHdvcmsKICAgIH0pOwogIH0gZWxzZSB7CiAgICBwc2J0ID0gcHNidF8xLlBzYnQuZnJvbUJhc2U2NChwc2J0U3RyLCB7CiAgICAgIG5ldHdvcmsKICAgIH0pOwogIH0KICByZXR1cm4gcHNidDsKfQ=="},{"version":3,"names":["psbt_1","require","crypto_lib_1","txBuild_1","bitcoinjs_lib_1","taproot","__importStar","bip371_1","address_1","bufferutils_1","psbtutils_1","bscript","crypto_1","crypto_2","schnorr","signUtil","secp256k1","defaultMaximumFeeRate","buildPsbt","tx","network","maximumFeeRate","psbt","classicToPsbt","toHex","exports","Psbt","inputs","forEach","input","outputScript","toOutputScript","address","inputData","hash","txId","index","vOut","witnessUtxo","script","value","amount","addressType","getAddressType","networks","bitcoin","bip32Derivation","tapBip32Derivation","map","derivation","pubBuf","base","fromHex","pubkey","length","slice","masterFingerprint","path","leafHashes","leaf","Buffer","from","nonWitnessUtxo","publicKey","tapInternalKey","toXOnly","redeemScript","payments","p2wpkh","output","sighashType","addInput","outputs","omniScript","addOutput","outputData","psbtSign","psbtBase64","privateKey","fromBase64","psbtSignImpl","toBase64","psbtDecode","txInputs","filter","a","equals","alloc","reverseBuffer","e","signPsbtWithKeyPathAndScriptPathBatch","psbtHexs","opts","undefined","res","optsSize","i","opt","signedPsbt","signPsbtWithKeyPathAndScriptPath","autoFinalized","toSignInputs","push","psbtStr","arguments","getPsbtFromString","signPsbtWithKeyPathAndScriptPathImpl","signInputs","privKeyHex","privateKeyFromWIF","signInputMap","Map","set","signer","psbtIndex","needTweak","tweakHash","toSignInputsMap","sign","signSchnorr","_this$toSignInputsMap","tweakedPrivKey","taprootTweakPrivKey","has","_this$toSignInputsMap2","get","disableTweakSigner","randomBytes","allowedSighashTypes","Transaction","SIGHASH_SINGLE","SIGHASH_ANYONECANPAY","SIGHASH_ALL","SIGHASH_DEFAULT","inputCount","size","data","isTaprootInput","_input$tapLeafScript","wif2Public","taprootTweakPubkey","_signInputMap$get","tapLeafScript","tapMerkleRoot","controlBlock","_signInputMap$get2","sighashTypes","signInput","finalizeInput","extractPsbtTransaction","txHex","extractedTransaction","finalizeAllInputs","extractTransaction","console","log","generateUnsignedListingPsbt","listingData","nftAddress","isP2SHScript","isP2TR","Error","placeholderAddress","testnet","repeat","nftUtxo","txHash","vout","coinAmount","rawTransation","receiveBtcAddress","price","psbtHex","generateSignedListingPsbt","SELLER_INDEX","DUMMY_AMOUNT","DUST_OUTPUT_LIMIT","generateUnsignedBuyingPsbt","buyingData","paymentAndChangeAddress","feePerB","feeRate","dummyUtxos","dummyUtxo","reduce","sum","nftOutputs","sellerPsbts","sellerPsbt","nftInput","globalMap","unsignedTx","ins","outs","fromBuffer","fromOutputScript","receiveNftAddress","nftOutput","paymentUtxos","paymentUtxo","changeAmount","parseInt","signBtc","mergeSignedBuyingPsbt","signedBuyingPsbt","signedListingPsbts","buyerSignedPsbt","nftIndex","signedListingPsbt","sellerSignedPsbt","generateSignedBuyingTx","generateMPCUnsignedListingPSBT","pubKeyHex","signHashList","getHashAndSighashType","generateMPCSignedListingPSBT","signature","partialSig","encode","updateInput","generateMPCUnsignedBuyingPSBT","batchSize","sellerIndex","generateMPCSignedBuyingTx","signatureList","generateMPCUnsignedPSBT","s","getRandomHash","m","count","h","sha256","generateMPCSignedPSBT","isHexString"],"sources":["../src/psbtSign.ts"],"sourcesContent":[null],"mappings":"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"}]}