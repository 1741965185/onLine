{"remainingRequest":"/Users/apple/IdeaProjects/onLinePayMerchant/node_modules/babel-loader/lib/index.js!/Users/apple/IdeaProjects/onLinePayMerchant/node_modules/babel-loader/lib/index.js??ref--17!/Users/apple/IdeaProjects/onLinePayMerchant/node_modules/@okxweb3/coin-bitcoin/dist/bitcoinjs-lib/psbt.js","dependencies":[{"path":"/Users/apple/IdeaProjects/onLinePayMerchant/node_modules/@okxweb3/coin-bitcoin/dist/bitcoinjs-lib/psbt.js","mtime":499162500000},{"path":"/Users/apple/IdeaProjects/onLinePayMerchant/babel.config.js","mtime":1730111979206},{"path":"/Users/apple/IdeaProjects/onLinePayMerchant/babel.config.js","mtime":1730111979206},{"path":"/Users/apple/IdeaProjects/onLinePayMerchant/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/apple/IdeaProjects/onLinePayMerchant/node_modules/babel-loader/lib/index.js","mtime":456789000000},{"path":"/Users/apple/IdeaProjects/onLinePayMerchant/node_modules/babel-loader/lib/index.js","mtime":456789000000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmVycm9yLmNhdXNlLmpzIik7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5yZWR1Y2UuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnB1c2guanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmVycm9yLmNhdXNlLmpzIik7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5yZWR1Y2UuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnB1c2guanMiKTsKdmFyIF9fY3JlYXRlQmluZGluZyA9IHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcgfHwgKE9iamVjdC5jcmVhdGUgPyBmdW5jdGlvbiAobywgbSwgaywgazIpIHsKICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrOwogIHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihtLCBrKTsKICBpZiAoIWRlc2MgfHwgKCJnZXQiIGluIGRlc2MgPyAhbS5fX2VzTW9kdWxlIDogZGVzYy53cml0YWJsZSB8fCBkZXNjLmNvbmZpZ3VyYWJsZSkpIHsKICAgIGRlc2MgPSB7CiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGdldDogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBtW2tdOwogICAgICB9CiAgICB9OwogIH0KICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIGRlc2MpOwp9IDogZnVuY3Rpb24gKG8sIG0sIGssIGsyKSB7CiAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gazsKICBvW2syXSA9IG1ba107Cn0pOwp2YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gdGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCB8fCAoT2JqZWN0LmNyZWF0ZSA/IGZ1bmN0aW9uIChvLCB2KSB7CiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sICJkZWZhdWx0IiwgewogICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgIHZhbHVlOiB2CiAgfSk7Cn0gOiBmdW5jdGlvbiAobywgdikgewogIG9bImRlZmF1bHQiXSA9IHY7Cn0pOwp2YXIgX19pbXBvcnRTdGFyID0gdGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhciB8fCBmdW5jdGlvbiAobW9kKSB7CiAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDsKICB2YXIgcmVzdWx0ID0ge307CiAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09ICJkZWZhdWx0IiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTsKICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpOwogIHJldHVybiByZXN1bHQ7Cn07Ck9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKZXhwb3J0cy5nZXRIYXNoQW5kU2lnaGFzaFR5cGUgPSBleHBvcnRzLlBzYnQgPSB2b2lkIDA7CmNvbnN0IHBzYnRfMSA9IHJlcXVpcmUoIi4vYmlwMTc0L3BzYnQiKTsKY29uc3QgdmFydWludCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKCIuL2JpcDE3NC9jb252ZXJ0ZXIvdmFyaW50IikpOwpjb25zdCB1dGlsc18xID0gcmVxdWlyZSgiLi9iaXAxNzQvdXRpbHMiKTsKY29uc3QgYWRkcmVzc18xID0gcmVxdWlyZSgiLi9hZGRyZXNzIik7CmNvbnN0IGJ1ZmZlcnV0aWxzXzEgPSByZXF1aXJlKCIuL2J1ZmZlcnV0aWxzIik7CmNvbnN0IG5ldHdvcmtzXzEgPSByZXF1aXJlKCIuL25ldHdvcmtzIik7CmNvbnN0IHBheW1lbnRzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoIi4vcGF5bWVudHMiKSk7CmNvbnN0IGJpcDM0MV8xID0gcmVxdWlyZSgiLi9wYXltZW50cy9iaXAzNDEiKTsKY29uc3QgYnNjcmlwdCA9IF9faW1wb3J0U3RhcihyZXF1aXJlKCIuL3NjcmlwdCIpKTsKY29uc3QgdHJhbnNhY3Rpb25fMSA9IHJlcXVpcmUoIi4vdHJhbnNhY3Rpb24iKTsKY29uc3QgYmlwMzcxXzEgPSByZXF1aXJlKCIuL3BzYnQvYmlwMzcxIik7CmNvbnN0IHBzYnR1dGlsc18xID0gcmVxdWlyZSgiLi9wc2J0L3BzYnR1dGlscyIpOwpjb25zdCBjcnlwdG9fbGliXzEgPSByZXF1aXJlKCJAb2t4d2ViMy9jcnlwdG8tbGliIik7CmNvbnN0IHNjcmlwdF8xID0gcmVxdWlyZSgiLi9zY3JpcHQiKTsKY29uc3QgdGFwcm9vdF8xID0gcmVxdWlyZSgiLi4vdGFwcm9vdCIpOwpjb25zdCBzY2hub3JyID0gY3J5cHRvX2xpYl8xLnNpZ25VdGlsLnNjaG5vcnIuc2VjcDI1NmsxLnNjaG5vcnI7CmNvbnN0IERFRkFVTFRfT1BUUyA9IHsKICBuZXR3b3JrOiBuZXR3b3Jrc18xLmJpdGNvaW4sCiAgbWF4aW11bUZlZVJhdGU6IDUwMDAKfTsKY2xhc3MgUHNidCB7CiAgc3RhdGljIGZyb21CYXNlNjQoZGF0YSkgewogICAgbGV0IG9wdHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmZyb20oZGF0YSwgJ2Jhc2U2NCcpOwogICAgcmV0dXJuIHRoaXMuZnJvbUJ1ZmZlcihidWZmZXIsIG9wdHMpOwogIH0KICBzdGF0aWMgZnJvbUhleChkYXRhKSB7CiAgICBsZXQgb3B0cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CiAgICBjb25zdCBidWZmZXIgPSBCdWZmZXIuZnJvbShkYXRhLCAnaGV4Jyk7CiAgICByZXR1cm4gdGhpcy5mcm9tQnVmZmVyKGJ1ZmZlciwgb3B0cyk7CiAgfQogIHN0YXRpYyBmcm9tQnVmZmVyKGJ1ZmZlcikgewogICAgbGV0IG9wdHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgY29uc3QgcHNidEJhc2UgPSBwc2J0XzEuUHNidC5mcm9tQnVmZmVyKGJ1ZmZlciwgdHJhbnNhY3Rpb25Gcm9tQnVmZmVyKTsKICAgIGNvbnN0IHBzYnQgPSBuZXcgUHNidChvcHRzLCBwc2J0QmFzZSk7CiAgICBjaGVja1R4Rm9yRHVwZUlucyhwc2J0Ll9fQ0FDSEUuX19UWCwgcHNidC5fX0NBQ0hFKTsKICAgIHJldHVybiBwc2J0OwogIH0KICBjb25zdHJ1Y3RvcigpIHsKICAgIGxldCBvcHRzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsKICAgIGxldCBkYXRhID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBuZXcgcHNidF8xLlBzYnQobmV3IFBzYnRUcmFuc2FjdGlvbigpKTsKICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICB0aGlzLm9wdHMgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX09QVFMsIG9wdHMpOwogICAgdGhpcy5fX0NBQ0hFID0gewogICAgICBfX05PTl9XSVRORVNTX1VUWE9fVFhfQ0FDSEU6IFtdLAogICAgICBfX05PTl9XSVRORVNTX1VUWE9fQlVGX0NBQ0hFOiBbXSwKICAgICAgX19UWF9JTl9DQUNIRToge30sCiAgICAgIF9fVFg6IHRoaXMuZGF0YS5nbG9iYWxNYXAudW5zaWduZWRUeC50eCwKICAgICAgX19VTlNBRkVfU0lHTl9OT05TRUdXSVQ6IGZhbHNlCiAgICB9OwogICAgaWYgKHRoaXMuZGF0YS5pbnB1dHMubGVuZ3RoID09PSAwKSB0aGlzLnNldFZlcnNpb24oMik7CiAgICBjb25zdCBkcGV3ID0gKG9iaiwgYXR0ciwgZW51bWVyYWJsZSwgd3JpdGFibGUpID0+IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGF0dHIsIHsKICAgICAgZW51bWVyYWJsZSwKICAgICAgd3JpdGFibGUKICAgIH0pOwogICAgZHBldyh0aGlzLCAnX19DQUNIRScsIGZhbHNlLCB0cnVlKTsKICAgIGRwZXcodGhpcywgJ29wdHMnLCBmYWxzZSwgdHJ1ZSk7CiAgfQogIGdldCBpbnB1dENvdW50KCkgewogICAgcmV0dXJuIHRoaXMuZGF0YS5pbnB1dHMubGVuZ3RoOwogIH0KICBnZXQgdmVyc2lvbigpIHsKICAgIHJldHVybiB0aGlzLl9fQ0FDSEUuX19UWC52ZXJzaW9uOwogIH0KICBzZXQgdmVyc2lvbih2ZXJzaW9uKSB7CiAgICB0aGlzLnNldFZlcnNpb24odmVyc2lvbik7CiAgfQogIGdldCBsb2NrdGltZSgpIHsKICAgIHJldHVybiB0aGlzLl9fQ0FDSEUuX19UWC5sb2NrdGltZTsKICB9CiAgc2V0IGxvY2t0aW1lKGxvY2t0aW1lKSB7CiAgICB0aGlzLnNldExvY2t0aW1lKGxvY2t0aW1lKTsKICB9CiAgZ2V0IHR4SW5wdXRzKCkgewogICAgcmV0dXJuIHRoaXMuX19DQUNIRS5fX1RYLmlucy5tYXAoaW5wdXQgPT4gKHsKICAgICAgaGFzaDogKDAsIGJ1ZmZlcnV0aWxzXzEuY2xvbmVCdWZmZXIpKGlucHV0Lmhhc2gpLAogICAgICBpbmRleDogaW5wdXQuaW5kZXgsCiAgICAgIHNlcXVlbmNlOiBpbnB1dC5zZXF1ZW5jZQogICAgfSkpOwogIH0KICBnZXQgdHhPdXRwdXRzKCkgewogICAgcmV0dXJuIHRoaXMuX19DQUNIRS5fX1RYLm91dHMubWFwKG91dHB1dCA9PiB7CiAgICAgIGxldCBhZGRyZXNzOwogICAgICB0cnkgewogICAgICAgIGFkZHJlc3MgPSAoMCwgYWRkcmVzc18xLmZyb21PdXRwdXRTY3JpcHQpKG91dHB1dC5zY3JpcHQsIHRoaXMub3B0cy5uZXR3b3JrKTsKICAgICAgfSBjYXRjaCAoXykge30KICAgICAgcmV0dXJuIHsKICAgICAgICBzY3JpcHQ6ICgwLCBidWZmZXJ1dGlsc18xLmNsb25lQnVmZmVyKShvdXRwdXQuc2NyaXB0KSwKICAgICAgICB2YWx1ZTogb3V0cHV0LnZhbHVlLAogICAgICAgIGFkZHJlc3MKICAgICAgfTsKICAgIH0pOwogIH0KICBjb21iaW5lKCkgewogICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIHRob3NlID0gbmV3IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykgewogICAgICB0aG9zZVtfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTsKICAgIH0KICAgIHRoaXMuZGF0YS5jb21iaW5lKC4uLnRob3NlLm1hcChvID0+IG8uZGF0YSkpOwogICAgcmV0dXJuIHRoaXM7CiAgfQogIGNsb25lKCkgewogICAgY29uc3QgcmVzID0gUHNidC5mcm9tQnVmZmVyKHRoaXMuZGF0YS50b0J1ZmZlcigpKTsKICAgIHJlcy5vcHRzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLm9wdHMpKTsKICAgIHJldHVybiByZXM7CiAgfQogIHNldE1heGltdW1GZWVSYXRlKHNhdG9zaGlQZXJCeXRlKSB7CiAgICBjaGVjazMyQml0KHNhdG9zaGlQZXJCeXRlKTsKICAgIHRoaXMub3B0cy5tYXhpbXVtRmVlUmF0ZSA9IHNhdG9zaGlQZXJCeXRlOwogIH0KICBzZXRWZXJzaW9uKHZlcnNpb24pIHsKICAgIGNoZWNrMzJCaXQodmVyc2lvbik7CiAgICBjaGVja0lucHV0c0ZvclBhcnRpYWxTaWcodGhpcy5kYXRhLmlucHV0cywgJ3NldFZlcnNpb24nKTsKICAgIGNvbnN0IGMgPSB0aGlzLl9fQ0FDSEU7CiAgICBjLl9fVFgudmVyc2lvbiA9IHZlcnNpb247CiAgICBjLl9fRVhUUkFDVEVEX1RYID0gdW5kZWZpbmVkOwogICAgcmV0dXJuIHRoaXM7CiAgfQogIHNldExvY2t0aW1lKGxvY2t0aW1lKSB7CiAgICBjaGVjazMyQml0KGxvY2t0aW1lKTsKICAgIGNoZWNrSW5wdXRzRm9yUGFydGlhbFNpZyh0aGlzLmRhdGEuaW5wdXRzLCAnc2V0TG9ja3RpbWUnKTsKICAgIGNvbnN0IGMgPSB0aGlzLl9fQ0FDSEU7CiAgICBjLl9fVFgubG9ja3RpbWUgPSBsb2NrdGltZTsKICAgIGMuX19FWFRSQUNURURfVFggPSB1bmRlZmluZWQ7CiAgICByZXR1cm4gdGhpczsKICB9CiAgc2V0SW5wdXRTZXF1ZW5jZShpbnB1dEluZGV4LCBzZXF1ZW5jZSkgewogICAgY2hlY2szMkJpdChzZXF1ZW5jZSk7CiAgICBjaGVja0lucHV0c0ZvclBhcnRpYWxTaWcodGhpcy5kYXRhLmlucHV0cywgJ3NldElucHV0U2VxdWVuY2UnKTsKICAgIGNvbnN0IGMgPSB0aGlzLl9fQ0FDSEU7CiAgICBpZiAoYy5fX1RYLmlucy5sZW5ndGggPD0gaW5wdXRJbmRleCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0lucHV0IGluZGV4IHRvbyBoaWdoJyk7CiAgICB9CiAgICBjLl9fVFguaW5zW2lucHV0SW5kZXhdLnNlcXVlbmNlID0gc2VxdWVuY2U7CiAgICBjLl9fRVhUUkFDVEVEX1RYID0gdW5kZWZpbmVkOwogICAgcmV0dXJuIHRoaXM7CiAgfQogIGFkZElucHV0cyhpbnB1dERhdGFzKSB7CiAgICBpbnB1dERhdGFzLmZvckVhY2goaW5wdXREYXRhID0+IHRoaXMuYWRkSW5wdXQoaW5wdXREYXRhKSk7CiAgICByZXR1cm4gdGhpczsKICB9CiAgYWRkSW5wdXQoaW5wdXREYXRhKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEgfHwgIWlucHV0RGF0YSB8fCBpbnB1dERhdGEuaGFzaCA9PT0gdW5kZWZpbmVkIHx8IGlucHV0RGF0YS5pbmRleCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBhcmd1bWVudHMgZm9yIFBzYnQuYWRkSW5wdXQuIGAgKyBgUmVxdWlyZXMgc2luZ2xlIG9iamVjdCB3aXRoIGF0IGxlYXN0IFtoYXNoXSBhbmQgW2luZGV4XWApOwogICAgfQogICAgKDAsIGJpcDM3MV8xLmNoZWNrVGFwcm9vdElucHV0RmllbGRzKShpbnB1dERhdGEsIGlucHV0RGF0YSwgJ2FkZElucHV0Jyk7CiAgICBjaGVja0lucHV0c0ZvclBhcnRpYWxTaWcodGhpcy5kYXRhLmlucHV0cywgJ2FkZElucHV0Jyk7CiAgICBpZiAoaW5wdXREYXRhLndpdG5lc3NTY3JpcHQpIGNoZWNrSW52YWxpZFAyV1NIKGlucHV0RGF0YS53aXRuZXNzU2NyaXB0KTsKICAgIGNvbnN0IGMgPSB0aGlzLl9fQ0FDSEU7CiAgICB0aGlzLmRhdGEuYWRkSW5wdXQoaW5wdXREYXRhKTsKICAgIGNvbnN0IHR4SW4gPSBjLl9fVFguaW5zW2MuX19UWC5pbnMubGVuZ3RoIC0gMV07CiAgICBjaGVja1R4SW5wdXRDYWNoZShjLCB0eEluKTsKICAgIGNvbnN0IGlucHV0SW5kZXggPSB0aGlzLmRhdGEuaW5wdXRzLmxlbmd0aCAtIDE7CiAgICBjb25zdCBpbnB1dCA9IHRoaXMuZGF0YS5pbnB1dHNbaW5wdXRJbmRleF07CiAgICBpZiAoaW5wdXQubm9uV2l0bmVzc1V0eG8pIHsKICAgICAgYWRkTm9uV2l0bmVzc1R4Q2FjaGUodGhpcy5fX0NBQ0hFLCBpbnB1dCwgaW5wdXRJbmRleCk7CiAgICB9CiAgICBjLl9fRkVFID0gdW5kZWZpbmVkOwogICAgYy5fX0ZFRV9SQVRFID0gdW5kZWZpbmVkOwogICAgYy5fX0VYVFJBQ1RFRF9UWCA9IHVuZGVmaW5lZDsKICAgIHJldHVybiB0aGlzOwogIH0KICBhZGRPdXRwdXRzKG91dHB1dERhdGFzKSB7CiAgICBvdXRwdXREYXRhcy5mb3JFYWNoKG91dHB1dERhdGEgPT4gdGhpcy5hZGRPdXRwdXQob3V0cHV0RGF0YSkpOwogICAgcmV0dXJuIHRoaXM7CiAgfQogIGFkZE91dHB1dChvdXRwdXREYXRhKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEgfHwgIW91dHB1dERhdGEgfHwgb3V0cHV0RGF0YS52YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IG91dHB1dERhdGEuYWRkcmVzcyA9PT0gdW5kZWZpbmVkICYmIG91dHB1dERhdGEuc2NyaXB0ID09PSB1bmRlZmluZWQpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGFyZ3VtZW50cyBmb3IgUHNidC5hZGRPdXRwdXQuIGAgKyBgUmVxdWlyZXMgc2luZ2xlIG9iamVjdCB3aXRoIGF0IGxlYXN0IFtzY3JpcHQgb3IgYWRkcmVzc10gYW5kIFt2YWx1ZV1gKTsKICAgIH0KICAgIGNoZWNrSW5wdXRzRm9yUGFydGlhbFNpZyh0aGlzLmRhdGEuaW5wdXRzLCAnYWRkT3V0cHV0Jyk7CiAgICBjb25zdCB7CiAgICAgIGFkZHJlc3MKICAgIH0gPSBvdXRwdXREYXRhOwogICAgaWYgKHR5cGVvZiBhZGRyZXNzID09PSAnc3RyaW5nJykgewogICAgICBjb25zdCB7CiAgICAgICAgbmV0d29yawogICAgICB9ID0gdGhpcy5vcHRzOwogICAgICBjb25zdCBzY3JpcHQgPSAoMCwgYWRkcmVzc18xLnRvT3V0cHV0U2NyaXB0KShhZGRyZXNzLCBuZXR3b3JrKTsKICAgICAgb3V0cHV0RGF0YSA9IE9iamVjdC5hc3NpZ24ob3V0cHV0RGF0YSwgewogICAgICAgIHNjcmlwdAogICAgICB9KTsKICAgIH0KICAgICgwLCBiaXAzNzFfMS5jaGVja1RhcHJvb3RPdXRwdXRGaWVsZHMpKG91dHB1dERhdGEsIG91dHB1dERhdGEsICdhZGRPdXRwdXQnKTsKICAgIGNvbnN0IGMgPSB0aGlzLl9fQ0FDSEU7CiAgICB0aGlzLmRhdGEuYWRkT3V0cHV0KG91dHB1dERhdGEpOwogICAgYy5fX0ZFRSA9IHVuZGVmaW5lZDsKICAgIGMuX19GRUVfUkFURSA9IHVuZGVmaW5lZDsKICAgIGMuX19FWFRSQUNURURfVFggPSB1bmRlZmluZWQ7CiAgICByZXR1cm4gdGhpczsKICB9CiAgZXh0cmFjdFRyYW5zYWN0aW9uKGRpc2FibGVGZWVDaGVjaykgewogICAgaWYgKCF0aGlzLmRhdGEuaW5wdXRzLmV2ZXJ5KGlzRmluYWxpemVkKSkgdGhyb3cgbmV3IEVycm9yKCdOb3QgZmluYWxpemVkJyk7CiAgICBjb25zdCBjID0gdGhpcy5fX0NBQ0hFOwogICAgaWYgKCFkaXNhYmxlRmVlQ2hlY2spIHsKICAgICAgY2hlY2tGZWVzKHRoaXMsIGMsIHRoaXMub3B0cyk7CiAgICB9CiAgICBpZiAoYy5fX0VYVFJBQ1RFRF9UWCkgcmV0dXJuIGMuX19FWFRSQUNURURfVFg7CiAgICBjb25zdCB0eCA9IGMuX19UWC5jbG9uZSgpOwogICAgaW5wdXRGaW5hbGl6ZUdldEFtdHModGhpcy5kYXRhLmlucHV0cywgdHgsIGMsIHRydWUpOwogICAgcmV0dXJuIHR4OwogIH0KICBnZXRGZWVSYXRlKCkgewogICAgcmV0dXJuIGdldFR4Q2FjaGVWYWx1ZSgnX19GRUVfUkFURScsICdmZWUgcmF0ZScsIHRoaXMuZGF0YS5pbnB1dHMsIHRoaXMuX19DQUNIRSk7CiAgfQogIGdldEZlZSgpIHsKICAgIHJldHVybiBnZXRUeENhY2hlVmFsdWUoJ19fRkVFJywgJ2ZlZScsIHRoaXMuZGF0YS5pbnB1dHMsIHRoaXMuX19DQUNIRSk7CiAgfQogIGZpbmFsaXplQWxsSW5wdXRzKCkgewogICAgKDAsIHV0aWxzXzEuY2hlY2tGb3JJbnB1dCkodGhpcy5kYXRhLmlucHV0cywgMCk7CiAgICByYW5nZSh0aGlzLmRhdGEuaW5wdXRzLmxlbmd0aCkuZm9yRWFjaChpZHggPT4gdGhpcy5maW5hbGl6ZUlucHV0KGlkeCkpOwogICAgcmV0dXJuIHRoaXM7CiAgfQogIGZpbmFsaXplSW5wdXQoaW5wdXRJbmRleCwgZmluYWxTY3JpcHRzRnVuYykgewogICAgY29uc3QgaW5wdXQgPSAoMCwgdXRpbHNfMS5jaGVja0ZvcklucHV0KSh0aGlzLmRhdGEuaW5wdXRzLCBpbnB1dEluZGV4KTsKICAgIGlmICgoMCwgYmlwMzcxXzEuaXNUYXByb290SW5wdXQpKGlucHV0KSkgcmV0dXJuIHRoaXMuX2ZpbmFsaXplVGFwcm9vdElucHV0KGlucHV0SW5kZXgsIGlucHV0LCB1bmRlZmluZWQsIGZpbmFsU2NyaXB0c0Z1bmMpOwogICAgcmV0dXJuIHRoaXMuX2ZpbmFsaXplSW5wdXQoaW5wdXRJbmRleCwgaW5wdXQsIGZpbmFsU2NyaXB0c0Z1bmMpOwogIH0KICBmaW5hbGl6ZVRhcHJvb3RJbnB1dChpbnB1dEluZGV4LCB0YXBMZWFmSGFzaFRvRmluYWxpemUpIHsKICAgIGxldCBmaW5hbFNjcmlwdHNGdW5jID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBiaXAzNzFfMS50YXBTY3JpcHRGaW5hbGl6ZXI7CiAgICBjb25zdCBpbnB1dCA9ICgwLCB1dGlsc18xLmNoZWNrRm9ySW5wdXQpKHRoaXMuZGF0YS5pbnB1dHMsIGlucHV0SW5kZXgpOwogICAgaWYgKCgwLCBiaXAzNzFfMS5pc1RhcHJvb3RJbnB1dCkoaW5wdXQpKSByZXR1cm4gdGhpcy5fZmluYWxpemVUYXByb290SW5wdXQoaW5wdXRJbmRleCwgaW5wdXQsIHRhcExlYWZIYXNoVG9GaW5hbGl6ZSwgZmluYWxTY3JpcHRzRnVuYyk7CiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBmaW5hbGl6ZSBpbnB1dCAjJHtpbnB1dEluZGV4fS4gTm90IFRhcHJvb3QuYCk7CiAgfQogIF9maW5hbGl6ZUlucHV0KGlucHV0SW5kZXgsIGlucHV0KSB7CiAgICBsZXQgZmluYWxTY3JpcHRzRnVuYyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogZ2V0RmluYWxTY3JpcHRzOwogICAgY29uc3QgewogICAgICBzY3JpcHQsCiAgICAgIGlzUDJTSCwKICAgICAgaXNQMldTSCwKICAgICAgaXNTZWd3aXQKICAgIH0gPSBnZXRTY3JpcHRGcm9tSW5wdXQoaW5wdXRJbmRleCwgaW5wdXQsIHRoaXMuX19DQUNIRSk7CiAgICBpZiAoIXNjcmlwdCkgdGhyb3cgbmV3IEVycm9yKGBObyBzY3JpcHQgZm91bmQgZm9yIGlucHV0ICMke2lucHV0SW5kZXh9YCk7CiAgICBjaGVja1BhcnRpYWxTaWdTaWdoYXNoZXMoaW5wdXQpOwogICAgY29uc3QgewogICAgICBmaW5hbFNjcmlwdFNpZywKICAgICAgZmluYWxTY3JpcHRXaXRuZXNzCiAgICB9ID0gZmluYWxTY3JpcHRzRnVuYyhpbnB1dEluZGV4LCBpbnB1dCwgc2NyaXB0LCBpc1NlZ3dpdCwgaXNQMlNILCBpc1AyV1NIKTsKICAgIGlmIChmaW5hbFNjcmlwdFNpZykgdGhpcy5kYXRhLnVwZGF0ZUlucHV0KGlucHV0SW5kZXgsIHsKICAgICAgZmluYWxTY3JpcHRTaWcKICAgIH0pOwogICAgaWYgKGZpbmFsU2NyaXB0V2l0bmVzcykgdGhpcy5kYXRhLnVwZGF0ZUlucHV0KGlucHV0SW5kZXgsIHsKICAgICAgZmluYWxTY3JpcHRXaXRuZXNzCiAgICB9KTsKICAgIGlmICghZmluYWxTY3JpcHRTaWcgJiYgIWZpbmFsU2NyaXB0V2l0bmVzcykgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIGVycm9yIGZpbmFsaXppbmcgaW5wdXQgIyR7aW5wdXRJbmRleH1gKTsKICAgIHRoaXMuZGF0YS5jbGVhckZpbmFsaXplZElucHV0KGlucHV0SW5kZXgpOwogICAgcmV0dXJuIHRoaXM7CiAgfQogIF9maW5hbGl6ZVRhcHJvb3RJbnB1dChpbnB1dEluZGV4LCBpbnB1dCwgdGFwTGVhZkhhc2hUb0ZpbmFsaXplKSB7CiAgICBsZXQgZmluYWxTY3JpcHRzRnVuYyA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogYmlwMzcxXzEudGFwU2NyaXB0RmluYWxpemVyOwogICAgaWYgKCFpbnB1dC53aXRuZXNzVXR4bykgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgZmluYWxpemUgaW5wdXQgIyR7aW5wdXRJbmRleH0uIE1pc3Npbmcgd2l0aG5lc3MgdXR4by5gKTsKICAgIGlmIChpbnB1dC50YXBLZXlTaWcpIHsKICAgICAgY29uc3QgcGF5bWVudCA9IHBheW1lbnRzLnAydHIoewogICAgICAgIG91dHB1dDogaW5wdXQud2l0bmVzc1V0eG8uc2NyaXB0LAogICAgICAgIHNpZ25hdHVyZTogaW5wdXQudGFwS2V5U2lnCiAgICAgIH0pOwogICAgICBjb25zdCBmaW5hbFNjcmlwdFdpdG5lc3MgPSAoMCwgcHNidHV0aWxzXzEud2l0bmVzc1N0YWNrVG9TY3JpcHRXaXRuZXNzKShwYXltZW50LndpdG5lc3MpOwogICAgICB0aGlzLmRhdGEudXBkYXRlSW5wdXQoaW5wdXRJbmRleCwgewogICAgICAgIGZpbmFsU2NyaXB0V2l0bmVzcwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBmaW5hbFNjcmlwdFdpdG5lc3MKICAgICAgfSA9IGZpbmFsU2NyaXB0c0Z1bmMoaW5wdXRJbmRleCwgaW5wdXQsIHRhcExlYWZIYXNoVG9GaW5hbGl6ZSk7CiAgICAgIHRoaXMuZGF0YS51cGRhdGVJbnB1dChpbnB1dEluZGV4LCB7CiAgICAgICAgZmluYWxTY3JpcHRXaXRuZXNzCiAgICAgIH0pOwogICAgfQogICAgdGhpcy5kYXRhLmNsZWFyRmluYWxpemVkSW5wdXQoaW5wdXRJbmRleCk7CiAgICByZXR1cm4gdGhpczsKICB9CiAgZ2V0SW5wdXRUeXBlKGlucHV0SW5kZXgpIHsKICAgIGNvbnN0IGlucHV0ID0gKDAsIHV0aWxzXzEuY2hlY2tGb3JJbnB1dCkodGhpcy5kYXRhLmlucHV0cywgaW5wdXRJbmRleCk7CiAgICBjb25zdCBzY3JpcHQgPSBnZXRTY3JpcHRGcm9tVXR4byhpbnB1dEluZGV4LCBpbnB1dCwgdGhpcy5fX0NBQ0hFKTsKICAgIGNvbnN0IHJlc3VsdCA9IGdldE1lYW5pbmdmdWxTY3JpcHQoc2NyaXB0LCBpbnB1dEluZGV4LCAnaW5wdXQnLCBpbnB1dC5yZWRlZW1TY3JpcHQgfHwgcmVkZWVtRnJvbUZpbmFsU2NyaXB0U2lnKGlucHV0LmZpbmFsU2NyaXB0U2lnKSwgaW5wdXQud2l0bmVzc1NjcmlwdCB8fCByZWRlZW1Gcm9tRmluYWxXaXRuZXNzU2NyaXB0KGlucHV0LmZpbmFsU2NyaXB0V2l0bmVzcykpOwogICAgY29uc3QgdHlwZSA9IHJlc3VsdC50eXBlID09PSAncmF3JyA/ICcnIDogcmVzdWx0LnR5cGUgKyAnLSc7CiAgICBjb25zdCBtYWluVHlwZSA9IGNsYXNzaWZ5U2NyaXB0KHJlc3VsdC5tZWFuaW5nZnVsU2NyaXB0KTsKICAgIHJldHVybiB0eXBlICsgbWFpblR5cGU7CiAgfQogIGlucHV0SGFzUHVia2V5KGlucHV0SW5kZXgsIHB1YmtleSkgewogICAgY29uc3QgaW5wdXQgPSAoMCwgdXRpbHNfMS5jaGVja0ZvcklucHV0KSh0aGlzLmRhdGEuaW5wdXRzLCBpbnB1dEluZGV4KTsKICAgIHJldHVybiBwdWJrZXlJbklucHV0KHB1YmtleSwgaW5wdXQsIGlucHV0SW5kZXgsIHRoaXMuX19DQUNIRSk7CiAgfQogIGlucHV0SGFzSERLZXkoaW5wdXRJbmRleCwgcm9vdCkgewogICAgY29uc3QgaW5wdXQgPSAoMCwgdXRpbHNfMS5jaGVja0ZvcklucHV0KSh0aGlzLmRhdGEuaW5wdXRzLCBpbnB1dEluZGV4KTsKICAgIGNvbnN0IGRlcml2YXRpb25Jc01pbmUgPSBiaXAzMkRlcml2YXRpb25Jc01pbmUocm9vdCk7CiAgICByZXR1cm4gISFpbnB1dC5iaXAzMkRlcml2YXRpb24gJiYgaW5wdXQuYmlwMzJEZXJpdmF0aW9uLnNvbWUoZGVyaXZhdGlvbklzTWluZSk7CiAgfQogIG91dHB1dEhhc1B1YmtleShvdXRwdXRJbmRleCwgcHVia2V5KSB7CiAgICBjb25zdCBvdXRwdXQgPSAoMCwgdXRpbHNfMS5jaGVja0Zvck91dHB1dCkodGhpcy5kYXRhLm91dHB1dHMsIG91dHB1dEluZGV4KTsKICAgIHJldHVybiBwdWJrZXlJbk91dHB1dChwdWJrZXksIG91dHB1dCwgb3V0cHV0SW5kZXgsIHRoaXMuX19DQUNIRSk7CiAgfQogIG91dHB1dEhhc0hES2V5KG91dHB1dEluZGV4LCByb290KSB7CiAgICBjb25zdCBvdXRwdXQgPSAoMCwgdXRpbHNfMS5jaGVja0Zvck91dHB1dCkodGhpcy5kYXRhLm91dHB1dHMsIG91dHB1dEluZGV4KTsKICAgIGNvbnN0IGRlcml2YXRpb25Jc01pbmUgPSBiaXAzMkRlcml2YXRpb25Jc01pbmUocm9vdCk7CiAgICByZXR1cm4gISFvdXRwdXQuYmlwMzJEZXJpdmF0aW9uICYmIG91dHB1dC5iaXAzMkRlcml2YXRpb24uc29tZShkZXJpdmF0aW9uSXNNaW5lKTsKICB9CiAgdmFsaWRhdGVTaWduYXR1cmVzT2ZBbGxJbnB1dHModmFsaWRhdG9yKSB7CiAgICAoMCwgdXRpbHNfMS5jaGVja0ZvcklucHV0KSh0aGlzLmRhdGEuaW5wdXRzLCAwKTsKICAgIGNvbnN0IHJlc3VsdHMgPSByYW5nZSh0aGlzLmRhdGEuaW5wdXRzLmxlbmd0aCkubWFwKGlkeCA9PiB0aGlzLnZhbGlkYXRlU2lnbmF0dXJlc09mSW5wdXQoaWR4LCB2YWxpZGF0b3IpKTsKICAgIHJldHVybiByZXN1bHRzLnJlZHVjZSgoZmluYWwsIHJlcykgPT4gcmVzID09PSB0cnVlICYmIGZpbmFsLCB0cnVlKTsKICB9CiAgdmFsaWRhdGVTaWduYXR1cmVzT2ZJbnB1dChpbnB1dEluZGV4LCB2YWxpZGF0b3IsIHB1YmtleSkgewogICAgY29uc3QgaW5wdXQgPSB0aGlzLmRhdGEuaW5wdXRzW2lucHV0SW5kZXhdOwogICAgaWYgKCgwLCBiaXAzNzFfMS5pc1RhcHJvb3RJbnB1dCkoaW5wdXQpKSByZXR1cm4gdGhpcy52YWxpZGF0ZVNpZ25hdHVyZXNPZlRhcHJvb3RJbnB1dChpbnB1dEluZGV4LCB2YWxpZGF0b3IsIHB1YmtleSk7CiAgICByZXR1cm4gdGhpcy5fdmFsaWRhdGVTaWduYXR1cmVzT2ZJbnB1dChpbnB1dEluZGV4LCB2YWxpZGF0b3IsIHB1YmtleSk7CiAgfQogIF92YWxpZGF0ZVNpZ25hdHVyZXNPZklucHV0KGlucHV0SW5kZXgsIHZhbGlkYXRvciwgcHVia2V5KSB7CiAgICBjb25zdCBpbnB1dCA9IHRoaXMuZGF0YS5pbnB1dHNbaW5wdXRJbmRleF07CiAgICBjb25zdCBwYXJ0aWFsU2lnID0gKGlucHV0IHx8IHt9KS5wYXJ0aWFsU2lnOwogICAgaWYgKCFpbnB1dCB8fCAhcGFydGlhbFNpZyB8fCBwYXJ0aWFsU2lnLmxlbmd0aCA8IDEpIHRocm93IG5ldyBFcnJvcignTm8gc2lnbmF0dXJlcyB0byB2YWxpZGF0ZScpOwogICAgaWYgKHR5cGVvZiB2YWxpZGF0b3IgIT09ICdmdW5jdGlvbicpIHRocm93IG5ldyBFcnJvcignTmVlZCB2YWxpZGF0b3IgZnVuY3Rpb24gdG8gdmFsaWRhdGUgc2lnbmF0dXJlcycpOwogICAgY29uc3QgbXlTaWdzID0gcHVia2V5ID8gcGFydGlhbFNpZy5maWx0ZXIoc2lnID0+IHNpZy5wdWJrZXkuZXF1YWxzKHB1YmtleSkpIDogcGFydGlhbFNpZzsKICAgIGlmIChteVNpZ3MubGVuZ3RoIDwgMSkgdGhyb3cgbmV3IEVycm9yKCdObyBzaWduYXR1cmVzIGZvciB0aGlzIHB1YmtleScpOwogICAgY29uc3QgcmVzdWx0cyA9IFtdOwogICAgbGV0IGhhc2hDYWNoZTsKICAgIGxldCBzY3JpcHRDYWNoZTsKICAgIGxldCBzaWdoYXNoQ2FjaGU7CiAgICBmb3IgKGNvbnN0IHBTaWcgb2YgbXlTaWdzKSB7CiAgICAgIGNvbnN0IHNpZyA9IGJzY3JpcHQuc2lnbmF0dXJlLmRlY29kZShwU2lnLnNpZ25hdHVyZSk7CiAgICAgIGNvbnN0IHsKICAgICAgICBoYXNoLAogICAgICAgIHNjcmlwdAogICAgICB9ID0gc2lnaGFzaENhY2hlICE9PSBzaWcuaGFzaFR5cGUgPyBnZXRIYXNoRm9yU2lnKGlucHV0SW5kZXgsIE9iamVjdC5hc3NpZ24oe30sIGlucHV0LCB7CiAgICAgICAgc2lnaGFzaFR5cGU6IHNpZy5oYXNoVHlwZQogICAgICB9KSwgdGhpcy5fX0NBQ0hFLCB0cnVlKSA6IHsKICAgICAgICBoYXNoOiBoYXNoQ2FjaGUsCiAgICAgICAgc2NyaXB0OiBzY3JpcHRDYWNoZQogICAgICB9OwogICAgICBzaWdoYXNoQ2FjaGUgPSBzaWcuaGFzaFR5cGU7CiAgICAgIGhhc2hDYWNoZSA9IGhhc2g7CiAgICAgIHNjcmlwdENhY2hlID0gc2NyaXB0OwogICAgICBjaGVja1NjcmlwdEZvclB1YmtleShwU2lnLnB1YmtleSwgc2NyaXB0LCAndmVyaWZ5Jyk7CiAgICAgIHJlc3VsdHMucHVzaCh2YWxpZGF0b3IocFNpZy5wdWJrZXksIGhhc2gsIHNpZy5zaWduYXR1cmUpKTsKICAgIH0KICAgIHJldHVybiByZXN1bHRzLmV2ZXJ5KHJlcyA9PiByZXMgPT09IHRydWUpOwogIH0KICB2YWxpZGF0ZVNpZ25hdHVyZXNPZlRhcHJvb3RJbnB1dChpbnB1dEluZGV4LCB2YWxpZGF0b3IsIHB1YmtleSkgewogICAgY29uc3QgaW5wdXQgPSB0aGlzLmRhdGEuaW5wdXRzW2lucHV0SW5kZXhdOwogICAgY29uc3QgdGFwS2V5U2lnID0gKGlucHV0IHx8IHt9KS50YXBLZXlTaWc7CiAgICBjb25zdCB0YXBTY3JpcHRTaWcgPSAoaW5wdXQgfHwge30pLnRhcFNjcmlwdFNpZzsKICAgIGlmICghaW5wdXQgJiYgIXRhcEtleVNpZyAmJiAhKHRhcFNjcmlwdFNpZyAmJiAhdGFwU2NyaXB0U2lnLmxlbmd0aCkpIHRocm93IG5ldyBFcnJvcignTm8gc2lnbmF0dXJlcyB0byB2YWxpZGF0ZScpOwogICAgaWYgKHR5cGVvZiB2YWxpZGF0b3IgIT09ICdmdW5jdGlvbicpIHRocm93IG5ldyBFcnJvcignTmVlZCB2YWxpZGF0b3IgZnVuY3Rpb24gdG8gdmFsaWRhdGUgc2lnbmF0dXJlcycpOwogICAgcHVia2V5ID0gcHVia2V5ICYmICgwLCBiaXAzNzFfMS50b1hPbmx5KShwdWJrZXkpOwogICAgY29uc3QgYWxsSGFzaHNlcyA9IHB1YmtleSA/IGdldFRhcHJvb3RIYXNoZXNGb3JTaWcoaW5wdXRJbmRleCwgaW5wdXQsIHRoaXMuZGF0YS5pbnB1dHMsIHB1YmtleSwgdGhpcy5fX0NBQ0hFKSA6IGdldEFsbFRhcHJvb3RIYXNoZXNGb3JTaWcoaW5wdXRJbmRleCwgaW5wdXQsIHRoaXMuZGF0YS5pbnB1dHMsIHRoaXMuX19DQUNIRSk7CiAgICBpZiAoIWFsbEhhc2hzZXMubGVuZ3RoKSB0aHJvdyBuZXcgRXJyb3IoJ05vIHNpZ25hdHVyZXMgZm9yIHRoaXMgcHVia2V5Jyk7CiAgICBjb25zdCB0YXBLZXlIYXNoID0gYWxsSGFzaHNlcy5maW5kKGggPT4gISFoLmxlYWZIYXNoKTsKICAgIGlmICh0YXBLZXlTaWcgJiYgdGFwS2V5SGFzaCkgewogICAgICBjb25zdCBpc1ZhbGlkVGFwa2V5U2lnID0gdmFsaWRhdG9yKHRhcEtleUhhc2gucHVia2V5LCB0YXBLZXlIYXNoLmhhc2gsIHRhcEtleVNpZyk7CiAgICAgIGlmICghaXNWYWxpZFRhcGtleVNpZykgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKHRhcFNjcmlwdFNpZykgewogICAgICBmb3IgKGNvbnN0IHRhcFNpZyBvZiB0YXBTY3JpcHRTaWcpIHsKICAgICAgICBjb25zdCB0YXBTaWdIYXNoID0gYWxsSGFzaHNlcy5maW5kKGggPT4gdGFwU2lnLnB1YmtleS5lcXVhbHMoaC5wdWJrZXkpKTsKICAgICAgICBpZiAodGFwU2lnSGFzaCkgewogICAgICAgICAgY29uc3QgaXNWYWxpZFRhcFNjcmlwdFNpZyA9IHZhbGlkYXRvcih0YXBTaWcucHVia2V5LCB0YXBTaWdIYXNoLmhhc2gsIHRhcFNpZy5zaWduYXR1cmUpOwogICAgICAgICAgaWYgKCFpc1ZhbGlkVGFwU2NyaXB0U2lnKSByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgc2lnbkFsbElucHV0c0hEKGhkS2V5UGFpcikgewogICAgbGV0IHNpZ2hhc2hUeXBlcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogW3RyYW5zYWN0aW9uXzEuVHJhbnNhY3Rpb24uU0lHSEFTSF9BTExdOwogICAgaWYgKCFoZEtleVBhaXIgfHwgIWhkS2V5UGFpci5wdWJsaWNLZXkgfHwgIWhkS2V5UGFpci5maW5nZXJwcmludCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ05lZWQgSERTaWduZXIgdG8gc2lnbiBpbnB1dCcpOwogICAgfQogICAgY29uc3QgcmVzdWx0cyA9IFtdOwogICAgZm9yIChjb25zdCBpIG9mIHJhbmdlKHRoaXMuZGF0YS5pbnB1dHMubGVuZ3RoKSkgewogICAgICB0cnkgewogICAgICAgIHRoaXMuc2lnbklucHV0SEQoaSwgaGRLZXlQYWlyLCBzaWdoYXNoVHlwZXMpOwogICAgICAgIHJlc3VsdHMucHVzaCh0cnVlKTsKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgcmVzdWx0cy5wdXNoKGZhbHNlKTsKICAgICAgfQogICAgfQogICAgaWYgKHJlc3VsdHMuZXZlcnkodiA9PiB2ID09PSBmYWxzZSkpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBpbnB1dHMgd2VyZSBzaWduZWQnKTsKICAgIH0KICAgIHJldHVybiB0aGlzOwogIH0KICBzaWduQWxsSW5wdXRzSERBc3luYyhoZEtleVBhaXIpIHsKICAgIGxldCBzaWdoYXNoVHlwZXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IFt0cmFuc2FjdGlvbl8xLlRyYW5zYWN0aW9uLlNJR0hBU0hfQUxMXTsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIGlmICghaGRLZXlQYWlyIHx8ICFoZEtleVBhaXIucHVibGljS2V5IHx8ICFoZEtleVBhaXIuZmluZ2VycHJpbnQpIHsKICAgICAgICByZXR1cm4gcmVqZWN0KG5ldyBFcnJvcignTmVlZCBIRFNpZ25lciB0byBzaWduIGlucHV0JykpOwogICAgICB9CiAgICAgIGNvbnN0IHJlc3VsdHMgPSBbXTsKICAgICAgY29uc3QgcHJvbWlzZXMgPSBbXTsKICAgICAgZm9yIChjb25zdCBpIG9mIHJhbmdlKHRoaXMuZGF0YS5pbnB1dHMubGVuZ3RoKSkgewogICAgICAgIHByb21pc2VzLnB1c2godGhpcy5zaWduSW5wdXRIREFzeW5jKGksIGhkS2V5UGFpciwgc2lnaGFzaFR5cGVzKS50aGVuKCgpID0+IHsKICAgICAgICAgIHJlc3VsdHMucHVzaCh0cnVlKTsKICAgICAgICB9LCAoKSA9PiB7CiAgICAgICAgICByZXN1bHRzLnB1c2goZmFsc2UpOwogICAgICAgIH0pKTsKICAgICAgfQogICAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oKCkgPT4gewogICAgICAgIGlmIChyZXN1bHRzLmV2ZXJ5KHYgPT4gdiA9PT0gZmFsc2UpKSB7CiAgICAgICAgICByZXR1cm4gcmVqZWN0KG5ldyBFcnJvcignTm8gaW5wdXRzIHdlcmUgc2lnbmVkJykpOwogICAgICAgIH0KICAgICAgICByZXNvbHZlKCk7CiAgICAgIH0pOwogICAgfSk7CiAgfQogIHNpZ25JbnB1dEhEKGlucHV0SW5kZXgsIGhkS2V5UGFpcikgewogICAgbGV0IHNpZ2hhc2hUeXBlcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogW3RyYW5zYWN0aW9uXzEuVHJhbnNhY3Rpb24uU0lHSEFTSF9BTExdOwogICAgaWYgKCFoZEtleVBhaXIgfHwgIWhkS2V5UGFpci5wdWJsaWNLZXkgfHwgIWhkS2V5UGFpci5maW5nZXJwcmludCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ05lZWQgSERTaWduZXIgdG8gc2lnbiBpbnB1dCcpOwogICAgfQogICAgY29uc3Qgc2lnbmVycyA9IGdldFNpZ25lcnNGcm9tSEQoaW5wdXRJbmRleCwgdGhpcy5kYXRhLmlucHV0cywgaGRLZXlQYWlyKTsKICAgIHNpZ25lcnMuZm9yRWFjaChzaWduZXIgPT4gdGhpcy5zaWduSW5wdXQoaW5wdXRJbmRleCwgc2lnbmVyLCBzaWdoYXNoVHlwZXMpKTsKICAgIHJldHVybiB0aGlzOwogIH0KICBzaWduSW5wdXRIREFzeW5jKGlucHV0SW5kZXgsIGhkS2V5UGFpcikgewogICAgbGV0IHNpZ2hhc2hUeXBlcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogW3RyYW5zYWN0aW9uXzEuVHJhbnNhY3Rpb24uU0lHSEFTSF9BTExdOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgaWYgKCFoZEtleVBhaXIgfHwgIWhkS2V5UGFpci5wdWJsaWNLZXkgfHwgIWhkS2V5UGFpci5maW5nZXJwcmludCkgewogICAgICAgIHJldHVybiByZWplY3QobmV3IEVycm9yKCdOZWVkIEhEU2lnbmVyIHRvIHNpZ24gaW5wdXQnKSk7CiAgICAgIH0KICAgICAgY29uc3Qgc2lnbmVycyA9IGdldFNpZ25lcnNGcm9tSEQoaW5wdXRJbmRleCwgdGhpcy5kYXRhLmlucHV0cywgaGRLZXlQYWlyKTsKICAgICAgY29uc3QgcHJvbWlzZXMgPSBzaWduZXJzLm1hcChzaWduZXIgPT4gdGhpcy5zaWduSW5wdXRBc3luYyhpbnB1dEluZGV4LCBzaWduZXIsIHNpZ2hhc2hUeXBlcykpOwogICAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oKCkgPT4gewogICAgICAgIHJlc29sdmUoKTsKICAgICAgfSkuY2F0Y2gocmVqZWN0KTsKICAgIH0pOwogIH0KICBzaWduQWxsSW5wdXRzKGtleVBhaXIsIHNpZ2hhc2hUeXBlcykgewogICAgaWYgKCFrZXlQYWlyIHx8ICFrZXlQYWlyLnB1YmxpY0tleSkgdGhyb3cgbmV3IEVycm9yKCdOZWVkIFNpZ25lciB0byBzaWduIGlucHV0Jyk7CiAgICBjb25zdCByZXN1bHRzID0gW107CiAgICBmb3IgKGNvbnN0IGkgb2YgcmFuZ2UodGhpcy5kYXRhLmlucHV0cy5sZW5ndGgpKSB7CiAgICAgIHRyeSB7CiAgICAgICAgdGhpcy5zaWduSW5wdXQoaSwga2V5UGFpciwgc2lnaGFzaFR5cGVzKTsKICAgICAgICByZXN1bHRzLnB1c2godHJ1ZSk7CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIHJlc3VsdHMucHVzaChmYWxzZSk7CiAgICAgIH0KICAgIH0KICAgIGlmIChyZXN1bHRzLmV2ZXJ5KHYgPT4gdiA9PT0gZmFsc2UpKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gaW5wdXRzIHdlcmUgc2lnbmVkJyk7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9CiAgc2lnbkFsbElucHV0c0FzeW5jKGtleVBhaXIsIHNpZ2hhc2hUeXBlcykgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgaWYgKCFrZXlQYWlyIHx8ICFrZXlQYWlyLnB1YmxpY0tleSkgcmV0dXJuIHJlamVjdChuZXcgRXJyb3IoJ05lZWQgU2lnbmVyIHRvIHNpZ24gaW5wdXQnKSk7CiAgICAgIGNvbnN0IHJlc3VsdHMgPSBbXTsKICAgICAgY29uc3QgcHJvbWlzZXMgPSBbXTsKICAgICAgZm9yIChjb25zdCBbaV0gb2YgdGhpcy5kYXRhLmlucHV0cy5lbnRyaWVzKCkpIHsKICAgICAgICBwcm9taXNlcy5wdXNoKHRoaXMuc2lnbklucHV0QXN5bmMoaSwga2V5UGFpciwgc2lnaGFzaFR5cGVzKS50aGVuKCgpID0+IHsKICAgICAgICAgIHJlc3VsdHMucHVzaCh0cnVlKTsKICAgICAgICB9LCAoKSA9PiB7CiAgICAgICAgICByZXN1bHRzLnB1c2goZmFsc2UpOwogICAgICAgIH0pKTsKICAgICAgfQogICAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oKCkgPT4gewogICAgICAgIGlmIChyZXN1bHRzLmV2ZXJ5KHYgPT4gdiA9PT0gZmFsc2UpKSB7CiAgICAgICAgICByZXR1cm4gcmVqZWN0KG5ldyBFcnJvcignTm8gaW5wdXRzIHdlcmUgc2lnbmVkJykpOwogICAgICAgIH0KICAgICAgICByZXNvbHZlKCk7CiAgICAgIH0pOwogICAgfSk7CiAgfQogIHNpZ25JbnB1dChpbnB1dEluZGV4LCBrZXlQYWlyLCBzaWdoYXNoVHlwZXMpIHsKICAgIGlmICgha2V5UGFpciB8fCAha2V5UGFpci5wdWJsaWNLZXkpIHRocm93IG5ldyBFcnJvcignTmVlZCBTaWduZXIgdG8gc2lnbiBpbnB1dCcpOwogICAgY29uc3QgaW5wdXQgPSAoMCwgdXRpbHNfMS5jaGVja0ZvcklucHV0KSh0aGlzLmRhdGEuaW5wdXRzLCBpbnB1dEluZGV4KTsKICAgIGlmICgoMCwgYmlwMzcxXzEuaXNUYXByb290SW5wdXQpKGlucHV0KSkgewogICAgICByZXR1cm4gdGhpcy5fc2lnblRhcHJvb3RJbnB1dChpbnB1dEluZGV4LCBpbnB1dCwga2V5UGFpciwgdW5kZWZpbmVkLCBzaWdoYXNoVHlwZXMpOwogICAgfQogICAgcmV0dXJuIHRoaXMuX3NpZ25JbnB1dChpbnB1dEluZGV4LCBrZXlQYWlyLCBzaWdoYXNoVHlwZXMpOwogIH0KICBzaWduVGFwcm9vdElucHV0KGlucHV0SW5kZXgsIGtleVBhaXIsIHRhcExlYWZIYXNoVG9TaWduLCBzaWdoYXNoVHlwZXMpIHsKICAgIGlmICgha2V5UGFpciB8fCAha2V5UGFpci5wdWJsaWNLZXkpIHRocm93IG5ldyBFcnJvcignTmVlZCBTaWduZXIgdG8gc2lnbiBpbnB1dCcpOwogICAgY29uc3QgaW5wdXQgPSAoMCwgdXRpbHNfMS5jaGVja0ZvcklucHV0KSh0aGlzLmRhdGEuaW5wdXRzLCBpbnB1dEluZGV4KTsKICAgIGlmICgoMCwgYmlwMzcxXzEuaXNUYXByb290SW5wdXQpKGlucHV0KSkgcmV0dXJuIHRoaXMuX3NpZ25UYXByb290SW5wdXQoaW5wdXRJbmRleCwgaW5wdXQsIGtleVBhaXIsIHRhcExlYWZIYXNoVG9TaWduLCBzaWdoYXNoVHlwZXMpOwogICAgdGhyb3cgbmV3IEVycm9yKGBJbnB1dCAjJHtpbnB1dEluZGV4fSBpcyBub3Qgb2YgdHlwZSBUYXByb290LmApOwogIH0KICBnZXRIYXNoQW5kU2lnaGFzaFR5cGUoaW5wdXRJbmRleCwgcHVibGljS2V5KSB7CiAgICBsZXQgc2lnaGFzaFR5cGVzID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBbdHJhbnNhY3Rpb25fMS5UcmFuc2FjdGlvbi5TSUdIQVNIX0FMTF07CiAgICBjb25zdCB7CiAgICAgIGhhc2gsCiAgICAgIHNpZ2hhc2hUeXBlCiAgICB9ID0gZ2V0SGFzaEFuZFNpZ2hhc2hUeXBlKHRoaXMuZGF0YS5pbnB1dHMsIGlucHV0SW5kZXgsIHB1YmxpY0tleSwgdGhpcy5fX0NBQ0hFLCBzaWdoYXNoVHlwZXMpOwogICAgcmV0dXJuIHsKICAgICAgaGFzaCwKICAgICAgc2lnaGFzaFR5cGUKICAgIH07CiAgfQogIF9zaWduSW5wdXQoaW5wdXRJbmRleCwga2V5UGFpcikgewogICAgbGV0IHNpZ2hhc2hUeXBlcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogW3RyYW5zYWN0aW9uXzEuVHJhbnNhY3Rpb24uU0lHSEFTSF9BTExdOwogICAgY29uc3QgewogICAgICBoYXNoLAogICAgICBzaWdoYXNoVHlwZQogICAgfSA9IGdldEhhc2hBbmRTaWdoYXNoVHlwZSh0aGlzLmRhdGEuaW5wdXRzLCBpbnB1dEluZGV4LCBrZXlQYWlyLnB1YmxpY0tleSwgdGhpcy5fX0NBQ0hFLCBzaWdoYXNoVHlwZXMpOwogICAgY29uc3QgcGFydGlhbFNpZyA9IFt7CiAgICAgIHB1YmtleToga2V5UGFpci5wdWJsaWNLZXksCiAgICAgIHNpZ25hdHVyZTogYnNjcmlwdC5zaWduYXR1cmUuZW5jb2RlKGtleVBhaXIuc2lnbihoYXNoKSwgc2lnaGFzaFR5cGUpCiAgICB9XTsKICAgIHRoaXMuZGF0YS51cGRhdGVJbnB1dChpbnB1dEluZGV4LCB7CiAgICAgIHBhcnRpYWxTaWcKICAgIH0pOwogICAgcmV0dXJuIHRoaXM7CiAgfQogIF9zaWduVGFwcm9vdElucHV0KGlucHV0SW5kZXgsIGlucHV0LCBrZXlQYWlyLCB0YXBMZWFmSGFzaFRvU2lnbikgewogICAgbGV0IGFsbG93ZWRTaWdoYXNoVHlwZXMgPSBhcmd1bWVudHMubGVuZ3RoID4gNCAmJiBhcmd1bWVudHNbNF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1s0XSA6IFt0cmFuc2FjdGlvbl8xLlRyYW5zYWN0aW9uLlNJR0hBU0hfREVGQVVMVF07CiAgICBjb25zdCBoYXNoZXNGb3JTaWcgPSB0aGlzLmNoZWNrVGFwcm9vdEhhc2hlc0ZvclNpZyhpbnB1dEluZGV4LCBpbnB1dCwga2V5UGFpciwgdGFwTGVhZkhhc2hUb1NpZ24sIGFsbG93ZWRTaWdoYXNoVHlwZXMpOwogICAgY29uc3QgdGFwS2V5U2lnID0gaGFzaGVzRm9yU2lnLmZpbHRlcihoID0+ICFoLmxlYWZIYXNoKS5tYXAoaCA9PiAoMCwgYmlwMzcxXzEuc2VyaWFsaXplVGFwcm9vdFNpZ25hdHVyZSkoa2V5UGFpci5zaWduU2Nobm9ycihoLmhhc2gpLCBpbnB1dC5zaWdoYXNoVHlwZSkpWzBdOwogICAgY29uc3QgdGFwU2NyaXB0U2lnID0gaGFzaGVzRm9yU2lnLmZpbHRlcihoID0+ICEhaC5sZWFmSGFzaCkubWFwKGggPT4gKHsKICAgICAgcHVia2V5OiAoMCwgYmlwMzcxXzEudG9YT25seSkoa2V5UGFpci5wdWJsaWNLZXkpLAogICAgICBzaWduYXR1cmU6ICgwLCBiaXAzNzFfMS5zZXJpYWxpemVUYXByb290U2lnbmF0dXJlKShrZXlQYWlyLnNpZ25TY2hub3JyKGguaGFzaCksIGlucHV0LnNpZ2hhc2hUeXBlKSwKICAgICAgbGVhZkhhc2g6IGgubGVhZkhhc2gKICAgIH0pKTsKICAgIGlmICh0YXBLZXlTaWcpIHsKICAgICAgdGhpcy5kYXRhLnVwZGF0ZUlucHV0KGlucHV0SW5kZXgsIHsKICAgICAgICB0YXBLZXlTaWcKICAgICAgfSk7CiAgICB9CiAgICBpZiAodGFwU2NyaXB0U2lnLmxlbmd0aCkgewogICAgICB0aGlzLmRhdGEudXBkYXRlSW5wdXQoaW5wdXRJbmRleCwgewogICAgICAgIHRhcFNjcmlwdFNpZwogICAgICB9KTsKICAgIH0KICAgIHJldHVybiB0aGlzOwogIH0KICBzaWduSW5wdXRBc3luYyhpbnB1dEluZGV4LCBrZXlQYWlyLCBzaWdoYXNoVHlwZXMpIHsKICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKCgpID0+IHsKICAgICAgaWYgKCFrZXlQYWlyIHx8ICFrZXlQYWlyLnB1YmxpY0tleSkgdGhyb3cgbmV3IEVycm9yKCdOZWVkIFNpZ25lciB0byBzaWduIGlucHV0Jyk7CiAgICAgIGNvbnN0IGlucHV0ID0gKDAsIHV0aWxzXzEuY2hlY2tGb3JJbnB1dCkodGhpcy5kYXRhLmlucHV0cywgaW5wdXRJbmRleCk7CiAgICAgIGlmICgoMCwgYmlwMzcxXzEuaXNUYXByb290SW5wdXQpKGlucHV0KSkgcmV0dXJuIHRoaXMuX3NpZ25UYXByb290SW5wdXRBc3luYyhpbnB1dEluZGV4LCBpbnB1dCwga2V5UGFpciwgdW5kZWZpbmVkLCBzaWdoYXNoVHlwZXMpOwogICAgICByZXR1cm4gdGhpcy5fc2lnbklucHV0QXN5bmMoaW5wdXRJbmRleCwga2V5UGFpciwgc2lnaGFzaFR5cGVzKTsKICAgIH0pOwogIH0KICBzaWduVGFwcm9vdElucHV0QXN5bmMoaW5wdXRJbmRleCwga2V5UGFpciwgdGFwTGVhZkhhc2gsIHNpZ2hhc2hUeXBlcykgewogICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oKCkgPT4gewogICAgICBpZiAoIWtleVBhaXIgfHwgIWtleVBhaXIucHVibGljS2V5KSB0aHJvdyBuZXcgRXJyb3IoJ05lZWQgU2lnbmVyIHRvIHNpZ24gaW5wdXQnKTsKICAgICAgY29uc3QgaW5wdXQgPSAoMCwgdXRpbHNfMS5jaGVja0ZvcklucHV0KSh0aGlzLmRhdGEuaW5wdXRzLCBpbnB1dEluZGV4KTsKICAgICAgaWYgKCgwLCBiaXAzNzFfMS5pc1RhcHJvb3RJbnB1dCkoaW5wdXQpKSByZXR1cm4gdGhpcy5fc2lnblRhcHJvb3RJbnB1dEFzeW5jKGlucHV0SW5kZXgsIGlucHV0LCBrZXlQYWlyLCB0YXBMZWFmSGFzaCwgc2lnaGFzaFR5cGVzKTsKICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnB1dCAjJHtpbnB1dEluZGV4fSBpcyBub3Qgb2YgdHlwZSBUYXByb290LmApOwogICAgfSk7CiAgfQogIF9zaWduSW5wdXRBc3luYyhpbnB1dEluZGV4LCBrZXlQYWlyKSB7CiAgICBsZXQgc2lnaGFzaFR5cGVzID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBbdHJhbnNhY3Rpb25fMS5UcmFuc2FjdGlvbi5TSUdIQVNIX0FMTF07CiAgICBjb25zdCB7CiAgICAgIGhhc2gsCiAgICAgIHNpZ2hhc2hUeXBlCiAgICB9ID0gZ2V0SGFzaEFuZFNpZ2hhc2hUeXBlKHRoaXMuZGF0YS5pbnB1dHMsIGlucHV0SW5kZXgsIGtleVBhaXIucHVibGljS2V5LCB0aGlzLl9fQ0FDSEUsIHNpZ2hhc2hUeXBlcyk7CiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGtleVBhaXIuc2lnbihoYXNoKSkudGhlbihzaWduYXR1cmUgPT4gewogICAgICBjb25zdCBwYXJ0aWFsU2lnID0gW3sKICAgICAgICBwdWJrZXk6IGtleVBhaXIucHVibGljS2V5LAogICAgICAgIHNpZ25hdHVyZTogYnNjcmlwdC5zaWduYXR1cmUuZW5jb2RlKHNpZ25hdHVyZSwgc2lnaGFzaFR5cGUpCiAgICAgIH1dOwogICAgICB0aGlzLmRhdGEudXBkYXRlSW5wdXQoaW5wdXRJbmRleCwgewogICAgICAgIHBhcnRpYWxTaWcKICAgICAgfSk7CiAgICB9KTsKICB9CiAgYXN5bmMgX3NpZ25UYXByb290SW5wdXRBc3luYyhpbnB1dEluZGV4LCBpbnB1dCwga2V5UGFpciwgdGFwTGVhZkhhc2gpIHsKICAgIGxldCBzaWdoYXNoVHlwZXMgPSBhcmd1bWVudHMubGVuZ3RoID4gNCAmJiBhcmd1bWVudHNbNF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1s0XSA6IFt0cmFuc2FjdGlvbl8xLlRyYW5zYWN0aW9uLlNJR0hBU0hfREVGQVVMVF07CiAgICBjb25zdCBoYXNoZXNGb3JTaWcgPSB0aGlzLmNoZWNrVGFwcm9vdEhhc2hlc0ZvclNpZyhpbnB1dEluZGV4LCBpbnB1dCwga2V5UGFpciwgdGFwTGVhZkhhc2gsIHNpZ2hhc2hUeXBlcyk7CiAgICBjb25zdCBzaWduYXR1cmVQcm9taXNlcyA9IFtdOwogICAgY29uc3QgdGFwS2V5SGFzaCA9IGhhc2hlc0ZvclNpZy5maWx0ZXIoaCA9PiAhaC5sZWFmSGFzaClbMF07CiAgICBpZiAodGFwS2V5SGFzaCkgewogICAgICBjb25zdCB0YXBLZXlTaWdQcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKGtleVBhaXIuc2lnblNjaG5vcnIodGFwS2V5SGFzaC5oYXNoKSkudGhlbihzaWcgPT4gewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0YXBLZXlTaWc6ICgwLCBiaXAzNzFfMS5zZXJpYWxpemVUYXByb290U2lnbmF0dXJlKShzaWcsIGlucHV0LnNpZ2hhc2hUeXBlKQogICAgICAgIH07CiAgICAgIH0pOwogICAgICBzaWduYXR1cmVQcm9taXNlcy5wdXNoKHRhcEtleVNpZ1Byb21pc2UpOwogICAgfQogICAgY29uc3QgdGFwU2NyaXB0SGFzaGVzID0gaGFzaGVzRm9yU2lnLmZpbHRlcihoID0+ICEhaC5sZWFmSGFzaCk7CiAgICBpZiAodGFwU2NyaXB0SGFzaGVzLmxlbmd0aCkgewogICAgICBjb25zdCB0YXBTY3JpcHRTaWdQcm9taXNlcyA9IHRhcFNjcmlwdEhhc2hlcy5tYXAodHNoID0+IHsKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGtleVBhaXIuc2lnblNjaG5vcnIodHNoLmhhc2gpKS50aGVuKHNpZ25hdHVyZSA9PiB7CiAgICAgICAgICBjb25zdCB0YXBTY3JpcHRTaWcgPSBbewogICAgICAgICAgICBwdWJrZXk6ICgwLCBiaXAzNzFfMS50b1hPbmx5KShrZXlQYWlyLnB1YmxpY0tleSksCiAgICAgICAgICAgIHNpZ25hdHVyZTogKDAsIGJpcDM3MV8xLnNlcmlhbGl6ZVRhcHJvb3RTaWduYXR1cmUpKHNpZ25hdHVyZSwgaW5wdXQuc2lnaGFzaFR5cGUpLAogICAgICAgICAgICBsZWFmSGFzaDogdHNoLmxlYWZIYXNoCiAgICAgICAgICB9XTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHRhcFNjcmlwdFNpZwogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIHNpZ25hdHVyZVByb21pc2VzLnB1c2goLi4udGFwU2NyaXB0U2lnUHJvbWlzZXMpOwogICAgfQogICAgcmV0dXJuIFByb21pc2UuYWxsKHNpZ25hdHVyZVByb21pc2VzKS50aGVuKHJlc3VsdHMgPT4gewogICAgICByZXN1bHRzLmZvckVhY2godiA9PiB0aGlzLmRhdGEudXBkYXRlSW5wdXQoaW5wdXRJbmRleCwgdikpOwogICAgfSk7CiAgfQogIGNoZWNrVGFwcm9vdEhhc2hlc0ZvclNpZyhpbnB1dEluZGV4LCBpbnB1dCwga2V5UGFpciwgdGFwTGVhZkhhc2hUb1NpZ24sIGFsbG93ZWRTaWdoYXNoVHlwZXMpIHsKICAgIGlmICh0eXBlb2Yga2V5UGFpci5zaWduU2Nobm9yciAhPT0gJ2Z1bmN0aW9uJykgdGhyb3cgbmV3IEVycm9yKGBOZWVkIFNjaG5vcnIgU2lnbmVyIHRvIHNpZ24gdGFwcm9vdCBpbnB1dCAjJHtpbnB1dEluZGV4fS5gKTsKICAgIGNvbnN0IGhhc2hlc0ZvclNpZyA9IGdldFRhcHJvb3RIYXNoZXNGb3JTaWcoaW5wdXRJbmRleCwgaW5wdXQsIHRoaXMuZGF0YS5pbnB1dHMsIGtleVBhaXIucHVibGljS2V5LCB0aGlzLl9fQ0FDSEUsIHRhcExlYWZIYXNoVG9TaWduLCBhbGxvd2VkU2lnaGFzaFR5cGVzKTsKICAgIGlmICghaGFzaGVzRm9yU2lnIHx8ICFoYXNoZXNGb3JTaWcubGVuZ3RoKSB0aHJvdyBuZXcgRXJyb3IoYENhbiBub3Qgc2lnbiBmb3IgaW5wdXQgIyR7aW5wdXRJbmRleH0gd2l0aCB0aGUga2V5ICR7a2V5UGFpci5wdWJsaWNLZXkudG9TdHJpbmcoJ2hleCcpfWApOwogICAgcmV0dXJuIGhhc2hlc0ZvclNpZzsKICB9CiAgdG9CdWZmZXIoKSB7CiAgICBjaGVja0NhY2hlKHRoaXMuX19DQUNIRSk7CiAgICByZXR1cm4gdGhpcy5kYXRhLnRvQnVmZmVyKCk7CiAgfQogIHRvSGV4KCkgewogICAgY2hlY2tDYWNoZSh0aGlzLl9fQ0FDSEUpOwogICAgcmV0dXJuIHRoaXMuZGF0YS50b0hleCgpOwogIH0KICB0b0Jhc2U2NCgpIHsKICAgIGNoZWNrQ2FjaGUodGhpcy5fX0NBQ0hFKTsKICAgIHJldHVybiB0aGlzLmRhdGEudG9CYXNlNjQoKTsKICB9CiAgdXBkYXRlR2xvYmFsKHVwZGF0ZURhdGEpIHsKICAgIHRoaXMuZGF0YS51cGRhdGVHbG9iYWwodXBkYXRlRGF0YSk7CiAgICByZXR1cm4gdGhpczsKICB9CiAgdXBkYXRlSW5wdXQoaW5wdXRJbmRleCwgdXBkYXRlRGF0YSkgewogICAgaWYgKHVwZGF0ZURhdGEud2l0bmVzc1NjcmlwdCkgY2hlY2tJbnZhbGlkUDJXU0godXBkYXRlRGF0YS53aXRuZXNzU2NyaXB0KTsKICAgICgwLCBiaXAzNzFfMS5jaGVja1RhcHJvb3RJbnB1dEZpZWxkcykodGhpcy5kYXRhLmlucHV0c1tpbnB1dEluZGV4XSwgdXBkYXRlRGF0YSwgJ3VwZGF0ZUlucHV0Jyk7CiAgICB0aGlzLmRhdGEudXBkYXRlSW5wdXQoaW5wdXRJbmRleCwgdXBkYXRlRGF0YSk7CiAgICBpZiAodXBkYXRlRGF0YS5ub25XaXRuZXNzVXR4bykgewogICAgICBhZGROb25XaXRuZXNzVHhDYWNoZSh0aGlzLl9fQ0FDSEUsIHRoaXMuZGF0YS5pbnB1dHNbaW5wdXRJbmRleF0sIGlucHV0SW5kZXgpOwogICAgfQogICAgcmV0dXJuIHRoaXM7CiAgfQogIHVwZGF0ZU91dHB1dChvdXRwdXRJbmRleCwgdXBkYXRlRGF0YSkgewogICAgY29uc3Qgb3V0cHV0RGF0YSA9IHRoaXMuZGF0YS5vdXRwdXRzW291dHB1dEluZGV4XTsKICAgICgwLCBiaXAzNzFfMS5jaGVja1RhcHJvb3RPdXRwdXRGaWVsZHMpKG91dHB1dERhdGEsIHVwZGF0ZURhdGEsICd1cGRhdGVPdXRwdXQnKTsKICAgIHRoaXMuZGF0YS51cGRhdGVPdXRwdXQob3V0cHV0SW5kZXgsIHVwZGF0ZURhdGEpOwogICAgcmV0dXJuIHRoaXM7CiAgfQogIGFkZFVua25vd25LZXlWYWxUb0dsb2JhbChrZXlWYWwpIHsKICAgIHRoaXMuZGF0YS5hZGRVbmtub3duS2V5VmFsVG9HbG9iYWwoa2V5VmFsKTsKICAgIHJldHVybiB0aGlzOwogIH0KICBhZGRVbmtub3duS2V5VmFsVG9JbnB1dChpbnB1dEluZGV4LCBrZXlWYWwpIHsKICAgIHRoaXMuZGF0YS5hZGRVbmtub3duS2V5VmFsVG9JbnB1dChpbnB1dEluZGV4LCBrZXlWYWwpOwogICAgcmV0dXJuIHRoaXM7CiAgfQogIGFkZFVua25vd25LZXlWYWxUb091dHB1dChvdXRwdXRJbmRleCwga2V5VmFsKSB7CiAgICB0aGlzLmRhdGEuYWRkVW5rbm93bktleVZhbFRvT3V0cHV0KG91dHB1dEluZGV4LCBrZXlWYWwpOwogICAgcmV0dXJuIHRoaXM7CiAgfQogIGNsZWFyRmluYWxpemVkSW5wdXQoaW5wdXRJbmRleCkgewogICAgdGhpcy5kYXRhLmNsZWFyRmluYWxpemVkSW5wdXQoaW5wdXRJbmRleCk7CiAgICByZXR1cm4gdGhpczsKICB9CiAgdmVyaWZ5KHB1YkJ1Ziwgd2l0bmVzcykgewogICAgY29uc3QgYWxsb3dlZFNpZ2hhc2hUeXBlcyA9IFt0cmFuc2FjdGlvbl8xLlRyYW5zYWN0aW9uLlNJR0hBU0hfU0lOR0xFIHwgdHJhbnNhY3Rpb25fMS5UcmFuc2FjdGlvbi5TSUdIQVNIX0FOWU9ORUNBTlBBWSwgdHJhbnNhY3Rpb25fMS5UcmFuc2FjdGlvbi5TSUdIQVNIX0FMTCwgdHJhbnNhY3Rpb25fMS5UcmFuc2FjdGlvbi5TSUdIQVNIX0RFRkFVTFRdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmlucHV0Q291bnQ7IGkrKykgewogICAgICBpZiAoKDAsIGJpcDM3MV8xLmlzVGFwcm9vdElucHV0KSh0aGlzLmRhdGEuaW5wdXRzW2ldKSkgewogICAgICAgIGNvbnN0IHR3ZWFrS2V5ID0gQnVmZmVyLmZyb20oKDAsIHRhcHJvb3RfMS50YXByb290VHdlYWtQdWJrZXkpKHB1YkJ1Zi5zbGljZSgxKSlbMF0pOwogICAgICAgIGNvbnN0IGJ1ZmZlclJlYWRlciA9IG5ldyBidWZmZXJ1dGlsc18xLkJ1ZmZlclJlYWRlcih3aXRuZXNzKTsKICAgICAgICBjb25zdCB2ZWN0b3IgPSBidWZmZXJSZWFkZXIucmVhZFZlY3RvcigpOwogICAgICAgIGNvbnN0IHNpZ25lciA9IHsKICAgICAgICAgIHB1YmxpY0tleTogdHdlYWtLZXksCiAgICAgICAgICBzaWduKGhhc2gpIHsKICAgICAgICAgICAgcmV0dXJuIEJ1ZmZlci5hbGxvYyg2NCk7CiAgICAgICAgICB9LAogICAgICAgICAgc2lnblNjaG5vcnIoaGFzaCkgewogICAgICAgICAgICByZXR1cm4gQnVmZmVyLmFsbG9jKDY0KTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGNvbnN0IGhhc2hlc0ZvclNpZyA9IHRoaXMuY2hlY2tUYXByb290SGFzaGVzRm9yU2lnKGksIHRoaXMuZGF0YS5pbnB1dHNbaV0sIHNpZ25lciwgdW5kZWZpbmVkLCBhbGxvd2VkU2lnaGFzaFR5cGVzKTsKICAgICAgICBjb25zdCBtZXNzYWdlVG9TaWduID0gaGFzaGVzRm9yU2lnLmZpbHRlcihoID0+ICFoLmxlYWZIYXNoKVswXS5oYXNoOwogICAgICAgIGlmICghc2Nobm9yci52ZXJpZnkoY3J5cHRvX2xpYl8xLmJhc2UudG9IZXgodmVjdG9yWzBdKSwgY3J5cHRvX2xpYl8xLmJhc2UudG9IZXgobWVzc2FnZVRvU2lnbiksIGNyeXB0b19saWJfMS5iYXNlLnRvSGV4KHR3ZWFrS2V5KSkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgewogICAgICAgICAgaGFzaAogICAgICAgIH0gPSBnZXRIYXNoQW5kU2lnaGFzaFR5cGUodGhpcy5kYXRhLmlucHV0cywgaSwgcHViQnVmLCB0aGlzLl9fQ0FDSEUsIGFsbG93ZWRTaWdoYXNoVHlwZXMpOwogICAgICAgIGNvbnN0IGJ1ZmZlclJlYWRlciA9IG5ldyBidWZmZXJ1dGlsc18xLkJ1ZmZlclJlYWRlcih3aXRuZXNzKTsKICAgICAgICBjb25zdCB2ZWN0b3IgPSBidWZmZXJSZWFkZXIucmVhZFZlY3RvcigpOwogICAgICAgIGNvbnN0IHNpZ25hdHVyZSA9IHNjcmlwdF8xLnNpZ25hdHVyZS5kZWNvZGUodmVjdG9yWzBdKS5zaWduYXR1cmU7CiAgICAgICAgY29uc3Qgd2l0bmVzc1B1YktleSA9IHZlY3RvclsxXTsKICAgICAgICBpZiAoIXB1YkJ1Zi5lcXVhbHMod2l0bmVzc1B1YktleSkpIHsKICAgICAgICAgIHRocm93IEVycm9yKCJwdWJLZXkgZXJyb3IiKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFjcnlwdG9fbGliXzEuc2lnblV0aWwuc2VjcDI1NmsxLnZlcmlmeVdpdGhOb1JlY292ZXJ5KGhhc2gsIHNpZ25hdHVyZSwgcHViQnVmKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQp9CmV4cG9ydHMuUHNidCA9IFBzYnQ7CmNvbnN0IHRyYW5zYWN0aW9uRnJvbUJ1ZmZlciA9IGJ1ZmZlciA9PiBuZXcgUHNidFRyYW5zYWN0aW9uKGJ1ZmZlcik7CmNsYXNzIFBzYnRUcmFuc2FjdGlvbiB7CiAgY29uc3RydWN0b3IoKSB7CiAgICBsZXQgYnVmZmVyID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBCdWZmZXIuZnJvbShbMiwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF0pOwogICAgdGhpcy50eCA9IHRyYW5zYWN0aW9uXzEuVHJhbnNhY3Rpb24uZnJvbUJ1ZmZlcihidWZmZXIpOwogICAgY2hlY2tUeEVtcHR5KHRoaXMudHgpOwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICd0eCcsIHsKICAgICAgZW51bWVyYWJsZTogZmFsc2UsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9CiAgZ2V0SW5wdXRPdXRwdXRDb3VudHMoKSB7CiAgICByZXR1cm4gewogICAgICBpbnB1dENvdW50OiB0aGlzLnR4Lmlucy5sZW5ndGgsCiAgICAgIG91dHB1dENvdW50OiB0aGlzLnR4Lm91dHMubGVuZ3RoCiAgICB9OwogIH0KICBhZGRJbnB1dChpbnB1dCkgewogICAgaWYgKGlucHV0Lmhhc2ggPT09IHVuZGVmaW5lZCB8fCBpbnB1dC5pbmRleCA9PT0gdW5kZWZpbmVkIHx8ICFCdWZmZXIuaXNCdWZmZXIoaW5wdXQuaGFzaCkgJiYgdHlwZW9mIGlucHV0Lmhhc2ggIT09ICdzdHJpbmcnIHx8IHR5cGVvZiBpbnB1dC5pbmRleCAhPT0gJ251bWJlcicpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdFcnJvciBhZGRpbmcgaW5wdXQuJyk7CiAgICB9CiAgICBjb25zdCBoYXNoID0gdHlwZW9mIGlucHV0Lmhhc2ggPT09ICdzdHJpbmcnID8gKDAsIGJ1ZmZlcnV0aWxzXzEucmV2ZXJzZUJ1ZmZlcikoQnVmZmVyLmZyb20oaW5wdXQuaGFzaCwgJ2hleCcpKSA6IGlucHV0Lmhhc2g7CiAgICB0aGlzLnR4LmFkZElucHV0KGhhc2gsIGlucHV0LmluZGV4LCBpbnB1dC5zZXF1ZW5jZSk7CiAgfQogIGFkZE91dHB1dChvdXRwdXQpIHsKICAgIGlmIChvdXRwdXQuc2NyaXB0ID09PSB1bmRlZmluZWQgfHwgb3V0cHV0LnZhbHVlID09PSB1bmRlZmluZWQgfHwgIUJ1ZmZlci5pc0J1ZmZlcihvdXRwdXQuc2NyaXB0KSB8fCB0eXBlb2Ygb3V0cHV0LnZhbHVlICE9PSAnbnVtYmVyJykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Vycm9yIGFkZGluZyBvdXRwdXQuJyk7CiAgICB9CiAgICB0aGlzLnR4LmFkZE91dHB1dChvdXRwdXQuc2NyaXB0LCBvdXRwdXQudmFsdWUpOwogIH0KICB0b0J1ZmZlcigpIHsKICAgIHJldHVybiB0aGlzLnR4LnRvQnVmZmVyKCk7CiAgfQp9CmZ1bmN0aW9uIGNhbkZpbmFsaXplKGlucHV0LCBzY3JpcHQsIHNjcmlwdFR5cGUpIHsKICBzd2l0Y2ggKHNjcmlwdFR5cGUpIHsKICAgIGNhc2UgJ3B1YmtleSc6CiAgICBjYXNlICdwdWJrZXloYXNoJzoKICAgIGNhc2UgJ3dpdG5lc3NwdWJrZXloYXNoJzoKICAgICAgcmV0dXJuIGhhc1NpZ3MoMSwgaW5wdXQucGFydGlhbFNpZyk7CiAgICBjYXNlICdtdWx0aXNpZyc6CiAgICAgIGNvbnN0IHAybXMgPSBwYXltZW50cy5wMm1zKHsKICAgICAgICBvdXRwdXQ6IHNjcmlwdAogICAgICB9KTsKICAgICAgcmV0dXJuIGhhc1NpZ3MocDJtcy5tLCBpbnB1dC5wYXJ0aWFsU2lnLCBwMm1zLnB1YmtleXMpOwogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuIGZhbHNlOwogIH0KfQpmdW5jdGlvbiBjaGVja0NhY2hlKGNhY2hlKSB7CiAgaWYgKGNhY2hlLl9fVU5TQUZFX1NJR05fTk9OU0VHV0lUICE9PSBmYWxzZSkgewogICAgdGhyb3cgbmV3IEVycm9yKCdOb3QgQklQMTc0IGNvbXBsaWFudCwgY2FuIG5vdCBleHBvcnQnKTsKICB9Cn0KZnVuY3Rpb24gaGFzU2lncyhuZWVkZWRTaWdzLCBwYXJ0aWFsU2lnLCBwdWJrZXlzKSB7CiAgaWYgKCFwYXJ0aWFsU2lnKSByZXR1cm4gZmFsc2U7CiAgbGV0IHNpZ3M7CiAgaWYgKHB1YmtleXMpIHsKICAgIHNpZ3MgPSBwdWJrZXlzLm1hcChwa2V5ID0+IHsKICAgICAgY29uc3QgcHVia2V5ID0gY29tcHJlc3NQdWJrZXkocGtleSk7CiAgICAgIHJldHVybiBwYXJ0aWFsU2lnLmZpbmQocFNpZyA9PiBwU2lnLnB1YmtleS5lcXVhbHMocHVia2V5KSk7CiAgICB9KS5maWx0ZXIodiA9PiAhIXYpOwogIH0gZWxzZSB7CiAgICBzaWdzID0gcGFydGlhbFNpZzsKICB9CiAgaWYgKHNpZ3MubGVuZ3RoID4gbmVlZGVkU2lncykgdGhyb3cgbmV3IEVycm9yKCdUb28gbWFueSBzaWduYXR1cmVzJyk7CiAgcmV0dXJuIHNpZ3MubGVuZ3RoID09PSBuZWVkZWRTaWdzOwp9CmZ1bmN0aW9uIGlzRmluYWxpemVkKGlucHV0KSB7CiAgcmV0dXJuICEhaW5wdXQuZmluYWxTY3JpcHRTaWcgfHwgISFpbnB1dC5maW5hbFNjcmlwdFdpdG5lc3M7Cn0KZnVuY3Rpb24gYmlwMzJEZXJpdmF0aW9uSXNNaW5lKHJvb3QpIHsKICByZXR1cm4gZCA9PiB7CiAgICBpZiAoIWQubWFzdGVyRmluZ2VycHJpbnQuZXF1YWxzKHJvb3QuZmluZ2VycHJpbnQpKSByZXR1cm4gZmFsc2U7CiAgICBpZiAoIXJvb3QuZGVyaXZlUGF0aChkLnBhdGgpLnB1YmxpY0tleS5lcXVhbHMoZC5wdWJrZXkpKSByZXR1cm4gZmFsc2U7CiAgICByZXR1cm4gdHJ1ZTsKICB9Owp9CmZ1bmN0aW9uIGNoZWNrMzJCaXQobnVtKSB7CiAgaWYgKHR5cGVvZiBudW0gIT09ICdudW1iZXInIHx8IG51bSAhPT0gTWF0aC5mbG9vcihudW0pIHx8IG51bSA+IDB4ZmZmZmZmZmYgfHwgbnVtIDwgMCkgewogICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIDMyIGJpdCBpbnRlZ2VyJyk7CiAgfQp9CmZ1bmN0aW9uIGNoZWNrRmVlcyhwc2J0LCBjYWNoZSwgb3B0cykgewogIGNvbnN0IGZlZVJhdGUgPSBjYWNoZS5fX0ZFRV9SQVRFIHx8IHBzYnQuZ2V0RmVlUmF0ZSgpOwogIGNvbnN0IHZzaXplID0gY2FjaGUuX19FWFRSQUNURURfVFgudmlydHVhbFNpemUoKTsKICBjb25zdCBzYXRvc2hpcyA9IGZlZVJhdGUgKiB2c2l6ZTsKICBpZiAoZmVlUmF0ZSA+PSBvcHRzLm1heGltdW1GZWVSYXRlKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoYFdhcm5pbmc6IFlvdSBhcmUgcGF5aW5nIGFyb3VuZCAkeyhzYXRvc2hpcyAvIDFlOCkudG9GaXhlZCg4KX0gaW4gYCArIGBmZWVzLCB3aGljaCBpcyAke2ZlZVJhdGV9IHNhdG9zaGkgcGVyIGJ5dGUgZm9yIGEgdHJhbnNhY3Rpb24gYCArIGB3aXRoIGEgVlNpemUgb2YgJHt2c2l6ZX0gYnl0ZXMgKHNlZ3dpdCBjb3VudGVkIGFzIDAuMjUgYnl0ZSBwZXIgYCArIGBieXRlKS4gVXNlIHNldE1heGltdW1GZWVSYXRlIG1ldGhvZCB0byByYWlzZSB5b3VyIHRocmVzaG9sZCwgb3IgYCArIGBwYXNzIHRydWUgdG8gdGhlIGZpcnN0IGFyZyBvZiBleHRyYWN0VHJhbnNhY3Rpb24uYCk7CiAgfQp9CmZ1bmN0aW9uIGNoZWNrSW5wdXRzRm9yUGFydGlhbFNpZyhpbnB1dHMsIGFjdGlvbikgewogIGlucHV0cy5mb3JFYWNoKGlucHV0ID0+IHsKICAgIGNvbnN0IHRocm93cyA9ICgwLCBiaXAzNzFfMS5pc1RhcHJvb3RJbnB1dCkoaW5wdXQpID8gKDAsIGJpcDM3MV8xLmNoZWNrVGFwcm9vdElucHV0Rm9yU2lncykoaW5wdXQsIGFjdGlvbikgOiAoMCwgcHNidHV0aWxzXzEuY2hlY2tJbnB1dEZvclNpZykoaW5wdXQsIGFjdGlvbik7CiAgICBpZiAodGhyb3dzKSB0aHJvdyBuZXcgRXJyb3IoJ0NhbiBub3QgbW9kaWZ5IHRyYW5zYWN0aW9uLCBzaWduYXR1cmVzIGV4aXN0LicpOwogIH0pOwp9CmZ1bmN0aW9uIGNoZWNrUGFydGlhbFNpZ1NpZ2hhc2hlcyhpbnB1dCkgewogIGlmICghaW5wdXQuc2lnaGFzaFR5cGUgfHwgIWlucHV0LnBhcnRpYWxTaWcpIHJldHVybjsKICBjb25zdCB7CiAgICBwYXJ0aWFsU2lnLAogICAgc2lnaGFzaFR5cGUKICB9ID0gaW5wdXQ7CiAgcGFydGlhbFNpZy5mb3JFYWNoKHBTaWcgPT4gewogICAgY29uc3QgewogICAgICBoYXNoVHlwZQogICAgfSA9IGJzY3JpcHQuc2lnbmF0dXJlLmRlY29kZShwU2lnLnNpZ25hdHVyZSk7CiAgICBpZiAoc2lnaGFzaFR5cGUgIT09IGhhc2hUeXBlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignU2lnbmF0dXJlIHNpZ2hhc2ggZG9lcyBub3QgbWF0Y2ggaW5wdXQgc2lnaGFzaCB0eXBlJyk7CiAgICB9CiAgfSk7Cn0KZnVuY3Rpb24gY2hlY2tTY3JpcHRGb3JQdWJrZXkocHVia2V5LCBzY3JpcHQsIGFjdGlvbikgewogIGlmICghKDAsIHBzYnR1dGlsc18xLnB1YmtleUluU2NyaXB0KShwdWJrZXksIHNjcmlwdCkpIHsKICAgIHRocm93IG5ldyBFcnJvcihgQ2FuIG5vdCAke2FjdGlvbn0gZm9yIHRoaXMgaW5wdXQgd2l0aCB0aGUga2V5ICR7cHVia2V5LnRvU3RyaW5nKCdoZXgnKX1gKTsKICB9Cn0KZnVuY3Rpb24gY2hlY2tUeEVtcHR5KHR4KSB7CiAgY29uc3QgaXNFbXB0eSA9IHR4Lmlucy5ldmVyeShpbnB1dCA9PiBpbnB1dC5zY3JpcHQgJiYgaW5wdXQuc2NyaXB0Lmxlbmd0aCA9PT0gMCAmJiBpbnB1dC53aXRuZXNzICYmIGlucHV0LndpdG5lc3MubGVuZ3RoID09PSAwKTsKICBpZiAoIWlzRW1wdHkpIHsKICAgIHRocm93IG5ldyBFcnJvcignRm9ybWF0IEVycm9yOiBUcmFuc2FjdGlvbiBTY3JpcHRTaWdzIGFyZSBub3QgZW1wdHknKTsKICB9Cn0KZnVuY3Rpb24gY2hlY2tUeEZvckR1cGVJbnModHgsIGNhY2hlKSB7CiAgdHguaW5zLmZvckVhY2goaW5wdXQgPT4gewogICAgY2hlY2tUeElucHV0Q2FjaGUoY2FjaGUsIGlucHV0KTsKICB9KTsKfQpmdW5jdGlvbiBjaGVja1R4SW5wdXRDYWNoZShjYWNoZSwgaW5wdXQpIHsKICBjb25zdCBrZXkgPSAoMCwgYnVmZmVydXRpbHNfMS5yZXZlcnNlQnVmZmVyKShCdWZmZXIuZnJvbShpbnB1dC5oYXNoKSkudG9TdHJpbmcoJ2hleCcpICsgJzonICsgaW5wdXQuaW5kZXg7CiAgaWYgKGNhY2hlLl9fVFhfSU5fQ0FDSEVba2V5XSkgdGhyb3cgbmV3IEVycm9yKCdEdXBsaWNhdGUgaW5wdXQgZGV0ZWN0ZWQuJyk7CiAgY2FjaGUuX19UWF9JTl9DQUNIRVtrZXldID0gMTsKfQpmdW5jdGlvbiBzY3JpcHRDaGVja2VyRmFjdG9yeShwYXltZW50LCBwYXltZW50U2NyaXB0TmFtZSkgewogIHJldHVybiAoaW5wdXRJbmRleCwgc2NyaXB0UHViS2V5LCByZWRlZW1TY3JpcHQsIGlvVHlwZSkgPT4gewogICAgY29uc3QgcmVkZWVtU2NyaXB0T3V0cHV0ID0gcGF5bWVudCh7CiAgICAgIHJlZGVlbTogewogICAgICAgIG91dHB1dDogcmVkZWVtU2NyaXB0CiAgICAgIH0KICAgIH0pLm91dHB1dDsKICAgIGlmICghc2NyaXB0UHViS2V5LmVxdWFscyhyZWRlZW1TY3JpcHRPdXRwdXQpKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgJHtwYXltZW50U2NyaXB0TmFtZX0gZm9yICR7aW9UeXBlfSAjJHtpbnB1dEluZGV4fSBkb2Vzbid0IG1hdGNoIHRoZSBzY3JpcHRQdWJLZXkgaW4gdGhlIHByZXZvdXRgKTsKICAgIH0KICB9Owp9CmNvbnN0IGNoZWNrUmVkZWVtU2NyaXB0ID0gc2NyaXB0Q2hlY2tlckZhY3RvcnkocGF5bWVudHMucDJzaCwgJ1JlZGVlbSBzY3JpcHQnKTsKY29uc3QgY2hlY2tXaXRuZXNzU2NyaXB0ID0gc2NyaXB0Q2hlY2tlckZhY3RvcnkocGF5bWVudHMucDJ3c2gsICdXaXRuZXNzIHNjcmlwdCcpOwpmdW5jdGlvbiBnZXRUeENhY2hlVmFsdWUoa2V5LCBuYW1lLCBpbnB1dHMsIGMpIHsKICBpZiAoIWlucHV0cy5ldmVyeShpc0ZpbmFsaXplZCkpIHRocm93IG5ldyBFcnJvcihgUFNCVCBtdXN0IGJlIGZpbmFsaXplZCB0byBjYWxjdWxhdGUgJHtuYW1lfWApOwogIGlmIChrZXkgPT09ICdfX0ZFRV9SQVRFJyAmJiBjLl9fRkVFX1JBVEUpIHJldHVybiBjLl9fRkVFX1JBVEU7CiAgaWYgKGtleSA9PT0gJ19fRkVFJyAmJiBjLl9fRkVFKSByZXR1cm4gYy5fX0ZFRTsKICBsZXQgdHg7CiAgbGV0IG11c3RGaW5hbGl6ZSA9IHRydWU7CiAgaWYgKGMuX19FWFRSQUNURURfVFgpIHsKICAgIHR4ID0gYy5fX0VYVFJBQ1RFRF9UWDsKICAgIG11c3RGaW5hbGl6ZSA9IGZhbHNlOwogIH0gZWxzZSB7CiAgICB0eCA9IGMuX19UWC5jbG9uZSgpOwogIH0KICBpbnB1dEZpbmFsaXplR2V0QW10cyhpbnB1dHMsIHR4LCBjLCBtdXN0RmluYWxpemUpOwogIGlmIChrZXkgPT09ICdfX0ZFRV9SQVRFJykgcmV0dXJuIGMuX19GRUVfUkFURTtlbHNlIGlmIChrZXkgPT09ICdfX0ZFRScpIHJldHVybiBjLl9fRkVFOwp9CmZ1bmN0aW9uIGdldEZpbmFsU2NyaXB0cyhpbnB1dEluZGV4LCBpbnB1dCwgc2NyaXB0LCBpc1NlZ3dpdCwgaXNQMlNILCBpc1AyV1NIKSB7CiAgY29uc3Qgc2NyaXB0VHlwZSA9IGNsYXNzaWZ5U2NyaXB0KHNjcmlwdCk7CiAgaWYgKCFjYW5GaW5hbGl6ZShpbnB1dCwgc2NyaXB0LCBzY3JpcHRUeXBlKSkgdGhyb3cgbmV3IEVycm9yKGBDYW4gbm90IGZpbmFsaXplIGlucHV0ICMke2lucHV0SW5kZXh9YCk7CiAgcmV0dXJuIHByZXBhcmVGaW5hbFNjcmlwdHMoc2NyaXB0LCBzY3JpcHRUeXBlLCBpbnB1dC5wYXJ0aWFsU2lnLCBpc1NlZ3dpdCwgaXNQMlNILCBpc1AyV1NIKTsKfQpmdW5jdGlvbiBwcmVwYXJlRmluYWxTY3JpcHRzKHNjcmlwdCwgc2NyaXB0VHlwZSwgcGFydGlhbFNpZywgaXNTZWd3aXQsIGlzUDJTSCwgaXNQMldTSCkgewogIGxldCBmaW5hbFNjcmlwdFNpZzsKICBsZXQgZmluYWxTY3JpcHRXaXRuZXNzOwogIGNvbnN0IHBheW1lbnQgPSBnZXRQYXltZW50KHNjcmlwdCwgc2NyaXB0VHlwZSwgcGFydGlhbFNpZyk7CiAgY29uc3QgcDJ3c2ggPSAhaXNQMldTSCA/IG51bGwgOiBwYXltZW50cy5wMndzaCh7CiAgICByZWRlZW06IHBheW1lbnQKICB9KTsKICBjb25zdCBwMnNoID0gIWlzUDJTSCA/IG51bGwgOiBwYXltZW50cy5wMnNoKHsKICAgIHJlZGVlbTogcDJ3c2ggfHwgcGF5bWVudAogIH0pOwogIGlmIChpc1NlZ3dpdCkgewogICAgaWYgKHAyd3NoKSB7CiAgICAgIGZpbmFsU2NyaXB0V2l0bmVzcyA9ICgwLCBwc2J0dXRpbHNfMS53aXRuZXNzU3RhY2tUb1NjcmlwdFdpdG5lc3MpKHAyd3NoLndpdG5lc3MpOwogICAgfSBlbHNlIHsKICAgICAgZmluYWxTY3JpcHRXaXRuZXNzID0gKDAsIHBzYnR1dGlsc18xLndpdG5lc3NTdGFja1RvU2NyaXB0V2l0bmVzcykocGF5bWVudC53aXRuZXNzKTsKICAgIH0KICAgIGlmIChwMnNoKSB7CiAgICAgIGZpbmFsU2NyaXB0U2lnID0gcDJzaC5pbnB1dDsKICAgIH0KICB9IGVsc2UgewogICAgaWYgKHAyc2gpIHsKICAgICAgZmluYWxTY3JpcHRTaWcgPSBwMnNoLmlucHV0OwogICAgfSBlbHNlIHsKICAgICAgZmluYWxTY3JpcHRTaWcgPSBwYXltZW50LmlucHV0OwogICAgfQogIH0KICByZXR1cm4gewogICAgZmluYWxTY3JpcHRTaWcsCiAgICBmaW5hbFNjcmlwdFdpdG5lc3MKICB9Owp9CmZ1bmN0aW9uIGdldEhhc2hBbmRTaWdoYXNoVHlwZShpbnB1dHMsIGlucHV0SW5kZXgsIHB1YmtleSwgY2FjaGUsIHNpZ2hhc2hUeXBlcykgewogIGNvbnN0IGlucHV0ID0gKDAsIHV0aWxzXzEuY2hlY2tGb3JJbnB1dCkoaW5wdXRzLCBpbnB1dEluZGV4KTsKICBjb25zdCB7CiAgICBoYXNoLAogICAgc2lnaGFzaFR5cGUsCiAgICBzY3JpcHQKICB9ID0gZ2V0SGFzaEZvclNpZyhpbnB1dEluZGV4LCBpbnB1dCwgY2FjaGUsIGZhbHNlLCBzaWdoYXNoVHlwZXMpOwogIGNoZWNrU2NyaXB0Rm9yUHVia2V5KHB1YmtleSwgc2NyaXB0LCAnc2lnbicpOwogIHJldHVybiB7CiAgICBoYXNoLAogICAgc2lnaGFzaFR5cGUKICB9Owp9CmV4cG9ydHMuZ2V0SGFzaEFuZFNpZ2hhc2hUeXBlID0gZ2V0SGFzaEFuZFNpZ2hhc2hUeXBlOwpmdW5jdGlvbiBnZXRIYXNoRm9yU2lnKGlucHV0SW5kZXgsIGlucHV0LCBjYWNoZSwgZm9yVmFsaWRhdGUsIHNpZ2hhc2hUeXBlcykgewogIGNvbnN0IHVuc2lnbmVkVHggPSBjYWNoZS5fX1RYOwogIGNvbnN0IHNpZ2hhc2hUeXBlID0gaW5wdXQuc2lnaGFzaFR5cGUgfHwgdHJhbnNhY3Rpb25fMS5UcmFuc2FjdGlvbi5TSUdIQVNIX0FMTDsKICBjaGVja1NpZ2hhc2hUeXBlQWxsb3dlZChzaWdoYXNoVHlwZSwgc2lnaGFzaFR5cGVzKTsKICBsZXQgaGFzaDsKICBsZXQgcHJldm91dDsKICBpZiAoaW5wdXQubm9uV2l0bmVzc1V0eG8pIHsKICAgIGNvbnN0IG5vbldpdG5lc3NVdHhvVHggPSBub25XaXRuZXNzVXR4b1R4RnJvbUNhY2hlKGNhY2hlLCBpbnB1dCwgaW5wdXRJbmRleCk7CiAgICBjb25zdCBwcmV2b3V0SGFzaCA9IHVuc2lnbmVkVHguaW5zW2lucHV0SW5kZXhdLmhhc2g7CiAgICBjb25zdCB1dHhvSGFzaCA9IG5vbldpdG5lc3NVdHhvVHguZ2V0SGFzaCgpOwogICAgaWYgKCFwcmV2b3V0SGFzaC5lcXVhbHModXR4b0hhc2gpKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgTm9uLXdpdG5lc3MgVVRYTyBoYXNoIGZvciBpbnB1dCAjJHtpbnB1dEluZGV4fSBkb2Vzbid0IG1hdGNoIHRoZSBoYXNoIHNwZWNpZmllZCBpbiB0aGUgcHJldm91dGApOwogICAgfQogICAgY29uc3QgcHJldm91dEluZGV4ID0gdW5zaWduZWRUeC5pbnNbaW5wdXRJbmRleF0uaW5kZXg7CiAgICBwcmV2b3V0ID0gbm9uV2l0bmVzc1V0eG9UeC5vdXRzW3ByZXZvdXRJbmRleF07CiAgfSBlbHNlIGlmIChpbnB1dC53aXRuZXNzVXR4bykgewogICAgcHJldm91dCA9IGlucHV0LndpdG5lc3NVdHhvOwogIH0gZWxzZSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ05lZWQgYSBVdHhvIGlucHV0IGl0ZW0gZm9yIHNpZ25pbmcnKTsKICB9CiAgY29uc3QgewogICAgbWVhbmluZ2Z1bFNjcmlwdCwKICAgIHR5cGUKICB9ID0gZ2V0TWVhbmluZ2Z1bFNjcmlwdChwcmV2b3V0LnNjcmlwdCwgaW5wdXRJbmRleCwgJ2lucHV0JywgaW5wdXQucmVkZWVtU2NyaXB0LCBpbnB1dC53aXRuZXNzU2NyaXB0KTsKICBpZiAoWydwMnNoLXAyd3NoJywgJ3Ayd3NoJ10uaW5kZXhPZih0eXBlKSA+PSAwKSB7CiAgICBoYXNoID0gdW5zaWduZWRUeC5oYXNoRm9yV2l0bmVzc1YwKGlucHV0SW5kZXgsIG1lYW5pbmdmdWxTY3JpcHQsIHByZXZvdXQudmFsdWUsIHNpZ2hhc2hUeXBlKTsKICB9IGVsc2UgaWYgKCgwLCBwc2J0dXRpbHNfMS5pc1AyV1BLSCkobWVhbmluZ2Z1bFNjcmlwdCkpIHsKICAgIGNvbnN0IHNpZ25pbmdTY3JpcHQgPSBwYXltZW50cy5wMnBraCh7CiAgICAgIGhhc2g6IG1lYW5pbmdmdWxTY3JpcHQuc2xpY2UoMikKICAgIH0pLm91dHB1dDsKICAgIGhhc2ggPSB1bnNpZ25lZFR4Lmhhc2hGb3JXaXRuZXNzVjAoaW5wdXRJbmRleCwgc2lnbmluZ1NjcmlwdCwgcHJldm91dC52YWx1ZSwgc2lnaGFzaFR5cGUpOwogIH0gZWxzZSB7CiAgICBpZiAoaW5wdXQubm9uV2l0bmVzc1V0eG8gPT09IHVuZGVmaW5lZCAmJiBjYWNoZS5fX1VOU0FGRV9TSUdOX05PTlNFR1dJVCA9PT0gZmFsc2UpIHRocm93IG5ldyBFcnJvcihgSW5wdXQgIyR7aW5wdXRJbmRleH0gaGFzIHdpdG5lc3NVdHhvIGJ1dCBub24tc2Vnd2l0IHNjcmlwdDogYCArIGAke21lYW5pbmdmdWxTY3JpcHQudG9TdHJpbmcoJ2hleCcpfWApOwogICAgaWYgKCFmb3JWYWxpZGF0ZSAmJiBjYWNoZS5fX1VOU0FGRV9TSUdOX05PTlNFR1dJVCAhPT0gZmFsc2UpIGNvbnNvbGUud2FybignV2FybmluZzogU2lnbmluZyBub24tc2Vnd2l0IGlucHV0cyB3aXRob3V0IHRoZSBmdWxsIHBhcmVudCB0cmFuc2FjdGlvbiAnICsgJ21lYW5zIHRoZXJlIGlzIGEgY2hhbmNlIHRoYXQgYSBtaW5lciBjb3VsZCBmZWVkIHlvdSBpbmNvcnJlY3QgaW5mb3JtYXRpb24gJyArICJ0byB0cmljayB5b3UgaW50byBwYXlpbmcgbGFyZ2UgZmVlcy4gVGhpcyBiZWhhdmlvciBpcyB0aGUgc2FtZSBhcyBQc2J0J3MgcHJlZGVjZXNvciAiICsgJyhUcmFuc2FjdGlvbkJ1aWxkZXIgLSBub3cgcmVtb3ZlZCkgd2hlbiBzaWduaW5nIG5vbi1zZWd3aXQgc2NyaXB0cy4gWW91IGFyZSBub3QgJyArICdhYmxlIHRvIGV4cG9ydCB0aGlzIFBzYnQgd2l0aCB0b0J1ZmZlcnx0b0Jhc2U2NHx0b0hleCBzaW5jZSBpdCBpcyBub3QgJyArICdCSVAxNzQgY29tcGxpYW50LlxuKioqKioqKioqKioqKioqKioqKioqXG5QUk9DRUVEIFdJVEggQ0FVVElPTiFcbicgKyAnKioqKioqKioqKioqKioqKioqKioqJyk7CiAgICBoYXNoID0gdW5zaWduZWRUeC5oYXNoRm9yU2lnbmF0dXJlKGlucHV0SW5kZXgsIG1lYW5pbmdmdWxTY3JpcHQsIHNpZ2hhc2hUeXBlKTsKICB9CiAgcmV0dXJuIHsKICAgIHNjcmlwdDogbWVhbmluZ2Z1bFNjcmlwdCwKICAgIHNpZ2hhc2hUeXBlLAogICAgaGFzaAogIH07Cn0KZnVuY3Rpb24gZ2V0QWxsVGFwcm9vdEhhc2hlc0ZvclNpZyhpbnB1dEluZGV4LCBpbnB1dCwgaW5wdXRzLCBjYWNoZSkgewogIGNvbnN0IGFsbFB1YmxpY0tleXMgPSBbXTsKICBpZiAoaW5wdXQudGFwSW50ZXJuYWxLZXkpIHsKICAgIGNvbnN0IG91dHB1dEtleSA9ICgwLCBiaXAzNzFfMS50d2Vha0ludGVybmFsUHViS2V5KShpbnB1dEluZGV4LCBpbnB1dCk7CiAgICBhbGxQdWJsaWNLZXlzLnB1c2gob3V0cHV0S2V5KTsKICB9CiAgaWYgKGlucHV0LnRhcFNjcmlwdFNpZykgewogICAgY29uc3QgdGFwU2NyaXB0UHVia2V5cyA9IGlucHV0LnRhcFNjcmlwdFNpZy5tYXAodHNzID0+IHRzcy5wdWJrZXkpOwogICAgYWxsUHVibGljS2V5cy5wdXNoKC4uLnRhcFNjcmlwdFB1YmtleXMpOwogIH0KICBjb25zdCBhbGxIYXNoZXMgPSBhbGxQdWJsaWNLZXlzLm1hcChwdWJpY0tleSA9PiBnZXRUYXByb290SGFzaGVzRm9yU2lnKGlucHV0SW5kZXgsIGlucHV0LCBpbnB1dHMsIHB1YmljS2V5LCBjYWNoZSkpOwogIHJldHVybiBhbGxIYXNoZXMuZmxhdCgpOwp9CmZ1bmN0aW9uIGdldFRhcHJvb3RIYXNoZXNGb3JTaWcoaW5wdXRJbmRleCwgaW5wdXQsIGlucHV0cywgcHVia2V5LCBjYWNoZSwgdGFwTGVhZkhhc2hUb1NpZ24sIGFsbG93ZWRTaWdoYXNoVHlwZXMpIHsKICBjb25zdCB1bnNpZ25lZFR4ID0gY2FjaGUuX19UWDsKICBjb25zdCBzaWdoYXNoVHlwZSA9IGlucHV0LnNpZ2hhc2hUeXBlIHx8IHRyYW5zYWN0aW9uXzEuVHJhbnNhY3Rpb24uU0lHSEFTSF9ERUZBVUxUOwogIGNoZWNrU2lnaGFzaFR5cGVBbGxvd2VkKHNpZ2hhc2hUeXBlLCBhbGxvd2VkU2lnaGFzaFR5cGVzKTsKICBjb25zdCBwcmV2T3V0cyA9IGlucHV0cy5tYXAoKGksIGluZGV4KSA9PiBnZXRTY3JpcHRBbmRBbW91bnRGcm9tVXR4byhpbmRleCwgaSwgY2FjaGUpKTsKICBjb25zdCBzaWduaW5nU2NyaXB0cyA9IHByZXZPdXRzLm1hcChvID0+IG8uc2NyaXB0KTsKICBjb25zdCB2YWx1ZXMgPSBwcmV2T3V0cy5tYXAobyA9PiBvLnZhbHVlKTsKICBjb25zdCBoYXNoZXMgPSBbXTsKICBpZiAoaW5wdXQudGFwSW50ZXJuYWxLZXkgJiYgIXRhcExlYWZIYXNoVG9TaWduKSB7CiAgICBjb25zdCBvdXRwdXRLZXkgPSAoMCwgYmlwMzcxXzEudHdlYWtJbnRlcm5hbFB1YktleSkoaW5wdXRJbmRleCwgaW5wdXQpOwogICAgaWYgKCgwLCBiaXAzNzFfMS50b1hPbmx5KShwdWJrZXkpLmVxdWFscyhvdXRwdXRLZXkpKSB7CiAgICAgIGNvbnN0IHRhcEtleUhhc2ggPSB1bnNpZ25lZFR4Lmhhc2hGb3JXaXRuZXNzVjEoaW5wdXRJbmRleCwgc2lnbmluZ1NjcmlwdHMsIHZhbHVlcywgc2lnaGFzaFR5cGUpOwogICAgICBoYXNoZXMucHVzaCh7CiAgICAgICAgcHVia2V5LAogICAgICAgIGhhc2g6IHRhcEtleUhhc2gKICAgICAgfSk7CiAgICB9CiAgfQogIGNvbnN0IHRhcExlYWZIYXNoZXMgPSAoaW5wdXQudGFwTGVhZlNjcmlwdCB8fCBbXSkuZmlsdGVyKHRhcExlYWYgPT4gKDAsIHBzYnR1dGlsc18xLnB1YmtleUluU2NyaXB0KShwdWJrZXksIHRhcExlYWYuc2NyaXB0KSkubWFwKHRhcExlYWYgPT4gewogICAgY29uc3QgaGFzaCA9ICgwLCBiaXAzNDFfMS50YXBsZWFmSGFzaCkoewogICAgICBvdXRwdXQ6IHRhcExlYWYuc2NyaXB0LAogICAgICB2ZXJzaW9uOiB0YXBMZWFmLmxlYWZWZXJzaW9uCiAgICB9KTsKICAgIHJldHVybiBPYmplY3QuYXNzaWduKHsKICAgICAgaGFzaAogICAgfSwgdGFwTGVhZik7CiAgfSkuZmlsdGVyKHRhcExlYWYgPT4gIXRhcExlYWZIYXNoVG9TaWduIHx8IHRhcExlYWZIYXNoVG9TaWduLmVxdWFscyh0YXBMZWFmLmhhc2gpKS5tYXAodGFwTGVhZiA9PiB7CiAgICBjb25zdCB0YXBTY3JpcHRIYXNoID0gdW5zaWduZWRUeC5oYXNoRm9yV2l0bmVzc1YxKGlucHV0SW5kZXgsIHNpZ25pbmdTY3JpcHRzLCB2YWx1ZXMsIHRyYW5zYWN0aW9uXzEuVHJhbnNhY3Rpb24uU0lHSEFTSF9ERUZBVUxULCB0YXBMZWFmLmhhc2gpOwogICAgcmV0dXJuIHsKICAgICAgcHVia2V5LAogICAgICBoYXNoOiB0YXBTY3JpcHRIYXNoLAogICAgICBsZWFmSGFzaDogdGFwTGVhZi5oYXNoCiAgICB9OwogIH0pOwogIHJldHVybiBoYXNoZXMuY29uY2F0KHRhcExlYWZIYXNoZXMpOwp9CmZ1bmN0aW9uIGNoZWNrU2lnaGFzaFR5cGVBbGxvd2VkKHNpZ2hhc2hUeXBlLCBzaWdoYXNoVHlwZXMpIHsKICBpZiAoc2lnaGFzaFR5cGVzICYmIHNpZ2hhc2hUeXBlcy5pbmRleE9mKHNpZ2hhc2hUeXBlKSA8IDApIHsKICAgIGNvbnN0IHN0ciA9IHNpZ2hhc2hUeXBlVG9TdHJpbmcoc2lnaGFzaFR5cGUpOwogICAgdGhyb3cgbmV3IEVycm9yKGBTaWdoYXNoIHR5cGUgaXMgbm90IGFsbG93ZWQuIFJldHJ5IHRoZSBzaWduIG1ldGhvZCBwYXNzaW5nIHRoZSBgICsgYHNpZ2hhc2hUeXBlcyBhcnJheSBvZiB3aGl0ZWxpc3RlZCB0eXBlcy4gU2lnaGFzaCB0eXBlOiAke3N0cn1gKTsKICB9Cn0KZnVuY3Rpb24gZ2V0UGF5bWVudChzY3JpcHQsIHNjcmlwdFR5cGUsIHBhcnRpYWxTaWcpIHsKICBsZXQgcGF5bWVudDsKICBzd2l0Y2ggKHNjcmlwdFR5cGUpIHsKICAgIGNhc2UgJ211bHRpc2lnJzoKICAgICAgY29uc3Qgc2lncyA9IGdldFNvcnRlZFNpZ3Moc2NyaXB0LCBwYXJ0aWFsU2lnKTsKICAgICAgcGF5bWVudCA9IHBheW1lbnRzLnAybXMoewogICAgICAgIG91dHB1dDogc2NyaXB0LAogICAgICAgIHNpZ25hdHVyZXM6IHNpZ3MKICAgICAgfSk7CiAgICAgIGJyZWFrOwogICAgY2FzZSAncHVia2V5JzoKICAgICAgcGF5bWVudCA9IHBheW1lbnRzLnAycGsoewogICAgICAgIG91dHB1dDogc2NyaXB0LAogICAgICAgIHNpZ25hdHVyZTogcGFydGlhbFNpZ1swXS5zaWduYXR1cmUKICAgICAgfSk7CiAgICAgIGJyZWFrOwogICAgY2FzZSAncHVia2V5aGFzaCc6CiAgICAgIHBheW1lbnQgPSBwYXltZW50cy5wMnBraCh7CiAgICAgICAgb3V0cHV0OiBzY3JpcHQsCiAgICAgICAgcHVia2V5OiBwYXJ0aWFsU2lnWzBdLnB1YmtleSwKICAgICAgICBzaWduYXR1cmU6IHBhcnRpYWxTaWdbMF0uc2lnbmF0dXJlCiAgICAgIH0pOwogICAgICBicmVhazsKICAgIGNhc2UgJ3dpdG5lc3NwdWJrZXloYXNoJzoKICAgICAgcGF5bWVudCA9IHBheW1lbnRzLnAyd3BraCh7CiAgICAgICAgb3V0cHV0OiBzY3JpcHQsCiAgICAgICAgcHVia2V5OiBwYXJ0aWFsU2lnWzBdLnB1YmtleSwKICAgICAgICBzaWduYXR1cmU6IHBhcnRpYWxTaWdbMF0uc2lnbmF0dXJlCiAgICAgIH0pOwogICAgICBicmVhazsKICB9CiAgcmV0dXJuIHBheW1lbnQ7Cn0KZnVuY3Rpb24gZ2V0U2NyaXB0RnJvbUlucHV0KGlucHV0SW5kZXgsIGlucHV0LCBjYWNoZSkgewogIGNvbnN0IHVuc2lnbmVkVHggPSBjYWNoZS5fX1RYOwogIGNvbnN0IHJlcyA9IHsKICAgIHNjcmlwdDogbnVsbCwKICAgIGlzU2Vnd2l0OiBmYWxzZSwKICAgIGlzUDJTSDogZmFsc2UsCiAgICBpc1AyV1NIOiBmYWxzZQogIH07CiAgcmVzLmlzUDJTSCA9ICEhaW5wdXQucmVkZWVtU2NyaXB0OwogIHJlcy5pc1AyV1NIID0gISFpbnB1dC53aXRuZXNzU2NyaXB0OwogIGlmIChpbnB1dC53aXRuZXNzU2NyaXB0KSB7CiAgICByZXMuc2NyaXB0ID0gaW5wdXQud2l0bmVzc1NjcmlwdDsKICB9IGVsc2UgaWYgKGlucHV0LnJlZGVlbVNjcmlwdCkgewogICAgcmVzLnNjcmlwdCA9IGlucHV0LnJlZGVlbVNjcmlwdDsKICB9IGVsc2UgewogICAgaWYgKGlucHV0Lm5vbldpdG5lc3NVdHhvKSB7CiAgICAgIGNvbnN0IG5vbldpdG5lc3NVdHhvVHggPSBub25XaXRuZXNzVXR4b1R4RnJvbUNhY2hlKGNhY2hlLCBpbnB1dCwgaW5wdXRJbmRleCk7CiAgICAgIGNvbnN0IHByZXZvdXRJbmRleCA9IHVuc2lnbmVkVHguaW5zW2lucHV0SW5kZXhdLmluZGV4OwogICAgICByZXMuc2NyaXB0ID0gbm9uV2l0bmVzc1V0eG9UeC5vdXRzW3ByZXZvdXRJbmRleF0uc2NyaXB0OwogICAgfSBlbHNlIGlmIChpbnB1dC53aXRuZXNzVXR4bykgewogICAgICByZXMuc2NyaXB0ID0gaW5wdXQud2l0bmVzc1V0eG8uc2NyaXB0OwogICAgfQogIH0KICBpZiAoaW5wdXQud2l0bmVzc1NjcmlwdCB8fCAoMCwgcHNidHV0aWxzXzEuaXNQMldQS0gpKHJlcy5zY3JpcHQpKSB7CiAgICByZXMuaXNTZWd3aXQgPSB0cnVlOwogIH0KICByZXR1cm4gcmVzOwp9CmZ1bmN0aW9uIGdldFNpZ25lcnNGcm9tSEQoaW5wdXRJbmRleCwgaW5wdXRzLCBoZEtleVBhaXIpIHsKICBjb25zdCBpbnB1dCA9ICgwLCB1dGlsc18xLmNoZWNrRm9ySW5wdXQpKGlucHV0cywgaW5wdXRJbmRleCk7CiAgaWYgKCFpbnB1dC5iaXAzMkRlcml2YXRpb24gfHwgaW5wdXQuYmlwMzJEZXJpdmF0aW9uLmxlbmd0aCA9PT0gMCkgewogICAgdGhyb3cgbmV3IEVycm9yKCdOZWVkIGJpcDMyRGVyaXZhdGlvbiB0byBzaWduIHdpdGggSEQnKTsKICB9CiAgY29uc3QgbXlEZXJpdmF0aW9ucyA9IGlucHV0LmJpcDMyRGVyaXZhdGlvbi5tYXAoYmlwRHYgPT4gewogICAgaWYgKGJpcER2Lm1hc3RlckZpbmdlcnByaW50LmVxdWFscyhoZEtleVBhaXIuZmluZ2VycHJpbnQpKSB7CiAgICAgIHJldHVybiBiaXBEdjsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybjsKICAgIH0KICB9KS5maWx0ZXIodiA9PiAhIXYpOwogIGlmIChteURlcml2YXRpb25zLmxlbmd0aCA9PT0gMCkgewogICAgdGhyb3cgbmV3IEVycm9yKCdOZWVkIG9uZSBiaXAzMkRlcml2YXRpb24gbWFzdGVyRmluZ2VycHJpbnQgdG8gbWF0Y2ggdGhlIEhEU2lnbmVyIGZpbmdlcnByaW50Jyk7CiAgfQogIGNvbnN0IHNpZ25lcnMgPSBteURlcml2YXRpb25zLm1hcChiaXBEdiA9PiB7CiAgICBjb25zdCBub2RlID0gaGRLZXlQYWlyLmRlcml2ZVBhdGgoYmlwRHYucGF0aCk7CiAgICBpZiAoIWJpcER2LnB1YmtleS5lcXVhbHMobm9kZS5wdWJsaWNLZXkpKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigncHVia2V5IGRpZCBub3QgbWF0Y2ggYmlwMzJEZXJpdmF0aW9uJyk7CiAgICB9CiAgICByZXR1cm4gbm9kZTsKICB9KTsKICByZXR1cm4gc2lnbmVyczsKfQpmdW5jdGlvbiBnZXRTb3J0ZWRTaWdzKHNjcmlwdCwgcGFydGlhbFNpZykgewogIGNvbnN0IHAybXMgPSBwYXltZW50cy5wMm1zKHsKICAgIG91dHB1dDogc2NyaXB0CiAgfSk7CiAgcmV0dXJuIHAybXMucHVia2V5cy5tYXAocGsgPT4gewogICAgcmV0dXJuIChwYXJ0aWFsU2lnLmZpbHRlcihwcyA9PiB7CiAgICAgIHJldHVybiBwcy5wdWJrZXkuZXF1YWxzKHBrKTsKICAgIH0pWzBdIHx8IHt9KS5zaWduYXR1cmU7CiAgfSkuZmlsdGVyKHYgPT4gISF2KTsKfQpmdW5jdGlvbiBzY3JpcHRXaXRuZXNzVG9XaXRuZXNzU3RhY2soYnVmZmVyKSB7CiAgbGV0IG9mZnNldCA9IDA7CiAgZnVuY3Rpb24gcmVhZFNsaWNlKG4pIHsKICAgIG9mZnNldCArPSBuOwogICAgcmV0dXJuIGJ1ZmZlci5zbGljZShvZmZzZXQgLSBuLCBvZmZzZXQpOwogIH0KICBmdW5jdGlvbiByZWFkVmFySW50KCkgewogICAgY29uc3QgdmkgPSB2YXJ1aW50LmRlY29kZShidWZmZXIsIG9mZnNldCk7CiAgICBvZmZzZXQgKz0gdmFydWludC5kZWNvZGUuYnl0ZXM7CiAgICByZXR1cm4gdmk7CiAgfQogIGZ1bmN0aW9uIHJlYWRWYXJTbGljZSgpIHsKICAgIHJldHVybiByZWFkU2xpY2UocmVhZFZhckludCgpKTsKICB9CiAgZnVuY3Rpb24gcmVhZFZlY3RvcigpIHsKICAgIGNvbnN0IGNvdW50ID0gcmVhZFZhckludCgpOwogICAgY29uc3QgdmVjdG9yID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHZlY3Rvci5wdXNoKHJlYWRWYXJTbGljZSgpKTsKICAgIHJldHVybiB2ZWN0b3I7CiAgfQogIHJldHVybiByZWFkVmVjdG9yKCk7Cn0KZnVuY3Rpb24gc2lnaGFzaFR5cGVUb1N0cmluZyhzaWdoYXNoVHlwZSkgewogIGxldCB0ZXh0ID0gc2lnaGFzaFR5cGUgJiB0cmFuc2FjdGlvbl8xLlRyYW5zYWN0aW9uLlNJR0hBU0hfQU5ZT05FQ0FOUEFZID8gJ1NJR0hBU0hfQU5ZT05FQ0FOUEFZIHwgJyA6ICcnOwogIGNvbnN0IHNpZ01vZCA9IHNpZ2hhc2hUeXBlICYgMHgxZjsKICBzd2l0Y2ggKHNpZ01vZCkgewogICAgY2FzZSB0cmFuc2FjdGlvbl8xLlRyYW5zYWN0aW9uLlNJR0hBU0hfQUxMOgogICAgICB0ZXh0ICs9ICdTSUdIQVNIX0FMTCc7CiAgICAgIGJyZWFrOwogICAgY2FzZSB0cmFuc2FjdGlvbl8xLlRyYW5zYWN0aW9uLlNJR0hBU0hfU0lOR0xFOgogICAgICB0ZXh0ICs9ICdTSUdIQVNIX1NJTkdMRSc7CiAgICAgIGJyZWFrOwogICAgY2FzZSB0cmFuc2FjdGlvbl8xLlRyYW5zYWN0aW9uLlNJR0hBU0hfTk9ORToKICAgICAgdGV4dCArPSAnU0lHSEFTSF9OT05FJzsKICAgICAgYnJlYWs7CiAgfQogIHJldHVybiB0ZXh0Owp9CmZ1bmN0aW9uIGFkZE5vbldpdG5lc3NUeENhY2hlKGNhY2hlLCBpbnB1dCwgaW5wdXRJbmRleCkgewogIGNhY2hlLl9fTk9OX1dJVE5FU1NfVVRYT19CVUZfQ0FDSEVbaW5wdXRJbmRleF0gPSBpbnB1dC5ub25XaXRuZXNzVXR4bzsKICBjb25zdCB0eCA9IHRyYW5zYWN0aW9uXzEuVHJhbnNhY3Rpb24uZnJvbUJ1ZmZlcihpbnB1dC5ub25XaXRuZXNzVXR4byk7CiAgY2FjaGUuX19OT05fV0lUTkVTU19VVFhPX1RYX0NBQ0hFW2lucHV0SW5kZXhdID0gdHg7CiAgY29uc3Qgc2VsZiA9IGNhY2hlOwogIGNvbnN0IHNlbGZJbmRleCA9IGlucHV0SW5kZXg7CiAgZGVsZXRlIGlucHV0Lm5vbldpdG5lc3NVdHhvOwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpbnB1dCwgJ25vbldpdG5lc3NVdHhvJywgewogICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgIGdldCgpIHsKICAgICAgY29uc3QgYnVmID0gc2VsZi5fX05PTl9XSVRORVNTX1VUWE9fQlVGX0NBQ0hFW3NlbGZJbmRleF07CiAgICAgIGNvbnN0IHR4Q2FjaGUgPSBzZWxmLl9fTk9OX1dJVE5FU1NfVVRYT19UWF9DQUNIRVtzZWxmSW5kZXhdOwogICAgICBpZiAoYnVmICE9PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gYnVmOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IG5ld0J1ZiA9IHR4Q2FjaGUudG9CdWZmZXIoKTsKICAgICAgICBzZWxmLl9fTk9OX1dJVE5FU1NfVVRYT19CVUZfQ0FDSEVbc2VsZkluZGV4XSA9IG5ld0J1ZjsKICAgICAgICByZXR1cm4gbmV3QnVmOwogICAgICB9CiAgICB9LAogICAgc2V0KGRhdGEpIHsKICAgICAgc2VsZi5fX05PTl9XSVRORVNTX1VUWE9fQlVGX0NBQ0hFW3NlbGZJbmRleF0gPSBkYXRhOwogICAgfQogIH0pOwp9CmZ1bmN0aW9uIGlucHV0RmluYWxpemVHZXRBbXRzKGlucHV0cywgdHgsIGNhY2hlLCBtdXN0RmluYWxpemUpIHsKICBsZXQgaW5wdXRBbW91bnQgPSAwOwogIGlucHV0cy5mb3JFYWNoKChpbnB1dCwgaWR4KSA9PiB7CiAgICBpZiAobXVzdEZpbmFsaXplICYmIGlucHV0LmZpbmFsU2NyaXB0U2lnKSB0eC5pbnNbaWR4XS5zY3JpcHQgPSBpbnB1dC5maW5hbFNjcmlwdFNpZzsKICAgIGlmIChtdXN0RmluYWxpemUgJiYgaW5wdXQuZmluYWxTY3JpcHRXaXRuZXNzKSB7CiAgICAgIHR4Lmluc1tpZHhdLndpdG5lc3MgPSBzY3JpcHRXaXRuZXNzVG9XaXRuZXNzU3RhY2soaW5wdXQuZmluYWxTY3JpcHRXaXRuZXNzKTsKICAgIH0KICAgIGlmIChpbnB1dC53aXRuZXNzVXR4bykgewogICAgICBpbnB1dEFtb3VudCArPSBpbnB1dC53aXRuZXNzVXR4by52YWx1ZTsKICAgIH0gZWxzZSBpZiAoaW5wdXQubm9uV2l0bmVzc1V0eG8pIHsKICAgICAgY29uc3QgbndUeCA9IG5vbldpdG5lc3NVdHhvVHhGcm9tQ2FjaGUoY2FjaGUsIGlucHV0LCBpZHgpOwogICAgICBjb25zdCB2b3V0ID0gdHguaW5zW2lkeF0uaW5kZXg7CiAgICAgIGNvbnN0IG91dCA9IG53VHgub3V0c1t2b3V0XTsKICAgICAgaW5wdXRBbW91bnQgKz0gb3V0LnZhbHVlOwogICAgfQogIH0pOwogIGNvbnN0IG91dHB1dEFtb3VudCA9IHR4Lm91dHMucmVkdWNlKCh0b3RhbCwgbykgPT4gdG90YWwgKyBvLnZhbHVlLCAwKTsKICBjb25zdCBmZWUgPSBpbnB1dEFtb3VudCAtIG91dHB1dEFtb3VudDsKICBpZiAoZmVlIDwgMCkgewogICAgdGhyb3cgbmV3IEVycm9yKCdPdXRwdXRzIGFyZSBzcGVuZGluZyBtb3JlIHRoYW4gSW5wdXRzJyk7CiAgfQogIGNvbnN0IGJ5dGVzID0gdHgudmlydHVhbFNpemUoKTsKICBjYWNoZS5fX0ZFRSA9IGZlZTsKICBjYWNoZS5fX0VYVFJBQ1RFRF9UWCA9IHR4OwogIGNhY2hlLl9fRkVFX1JBVEUgPSBNYXRoLmZsb29yKGZlZSAvIGJ5dGVzKTsKfQpmdW5jdGlvbiBub25XaXRuZXNzVXR4b1R4RnJvbUNhY2hlKGNhY2hlLCBpbnB1dCwgaW5wdXRJbmRleCkgewogIGNvbnN0IGMgPSBjYWNoZS5fX05PTl9XSVRORVNTX1VUWE9fVFhfQ0FDSEU7CiAgaWYgKCFjW2lucHV0SW5kZXhdKSB7CiAgICBhZGROb25XaXRuZXNzVHhDYWNoZShjYWNoZSwgaW5wdXQsIGlucHV0SW5kZXgpOwogIH0KICByZXR1cm4gY1tpbnB1dEluZGV4XTsKfQpmdW5jdGlvbiBnZXRTY3JpcHRGcm9tVXR4byhpbnB1dEluZGV4LCBpbnB1dCwgY2FjaGUpIHsKICBjb25zdCB7CiAgICBzY3JpcHQKICB9ID0gZ2V0U2NyaXB0QW5kQW1vdW50RnJvbVV0eG8oaW5wdXRJbmRleCwgaW5wdXQsIGNhY2hlKTsKICByZXR1cm4gc2NyaXB0Owp9CmZ1bmN0aW9uIGdldFNjcmlwdEFuZEFtb3VudEZyb21VdHhvKGlucHV0SW5kZXgsIGlucHV0LCBjYWNoZSkgewogIGlmIChpbnB1dC53aXRuZXNzVXR4byAhPT0gdW5kZWZpbmVkKSB7CiAgICByZXR1cm4gewogICAgICBzY3JpcHQ6IGlucHV0LndpdG5lc3NVdHhvLnNjcmlwdCwKICAgICAgdmFsdWU6IGlucHV0LndpdG5lc3NVdHhvLnZhbHVlCiAgICB9OwogIH0gZWxzZSBpZiAoaW5wdXQubm9uV2l0bmVzc1V0eG8gIT09IHVuZGVmaW5lZCkgewogICAgY29uc3Qgbm9uV2l0bmVzc1V0eG9UeCA9IG5vbldpdG5lc3NVdHhvVHhGcm9tQ2FjaGUoY2FjaGUsIGlucHV0LCBpbnB1dEluZGV4KTsKICAgIGNvbnN0IG8gPSBub25XaXRuZXNzVXR4b1R4Lm91dHNbY2FjaGUuX19UWC5pbnNbaW5wdXRJbmRleF0uaW5kZXhdOwogICAgcmV0dXJuIHsKICAgICAgc2NyaXB0OiBvLnNjcmlwdCwKICAgICAgdmFsdWU6IG8udmFsdWUKICAgIH07CiAgfSBlbHNlIHsKICAgIHRocm93IG5ldyBFcnJvcigiQ2FuJ3QgZmluZCBwdWJrZXkgaW4gaW5wdXQgd2l0aG91dCBVdHhvIGRhdGEiKTsKICB9Cn0KZnVuY3Rpb24gcHVia2V5SW5JbnB1dChwdWJrZXksIGlucHV0LCBpbnB1dEluZGV4LCBjYWNoZSkgewogIGNvbnN0IHNjcmlwdCA9IGdldFNjcmlwdEZyb21VdHhvKGlucHV0SW5kZXgsIGlucHV0LCBjYWNoZSk7CiAgY29uc3QgewogICAgbWVhbmluZ2Z1bFNjcmlwdAogIH0gPSBnZXRNZWFuaW5nZnVsU2NyaXB0KHNjcmlwdCwgaW5wdXRJbmRleCwgJ2lucHV0JywgaW5wdXQucmVkZWVtU2NyaXB0LCBpbnB1dC53aXRuZXNzU2NyaXB0KTsKICByZXR1cm4gKDAsIHBzYnR1dGlsc18xLnB1YmtleUluU2NyaXB0KShwdWJrZXksIG1lYW5pbmdmdWxTY3JpcHQpOwp9CmZ1bmN0aW9uIHB1YmtleUluT3V0cHV0KHB1YmtleSwgb3V0cHV0LCBvdXRwdXRJbmRleCwgY2FjaGUpIHsKICBjb25zdCBzY3JpcHQgPSBjYWNoZS5fX1RYLm91dHNbb3V0cHV0SW5kZXhdLnNjcmlwdDsKICBjb25zdCB7CiAgICBtZWFuaW5nZnVsU2NyaXB0CiAgfSA9IGdldE1lYW5pbmdmdWxTY3JpcHQoc2NyaXB0LCBvdXRwdXRJbmRleCwgJ291dHB1dCcsIG91dHB1dC5yZWRlZW1TY3JpcHQsIG91dHB1dC53aXRuZXNzU2NyaXB0KTsKICByZXR1cm4gKDAsIHBzYnR1dGlsc18xLnB1YmtleUluU2NyaXB0KShwdWJrZXksIG1lYW5pbmdmdWxTY3JpcHQpOwp9CmZ1bmN0aW9uIHJlZGVlbUZyb21GaW5hbFNjcmlwdFNpZyhmaW5hbFNjcmlwdCkgewogIGlmICghZmluYWxTY3JpcHQpIHJldHVybjsKICBjb25zdCBkZWNvbXAgPSBic2NyaXB0LmRlY29tcGlsZShmaW5hbFNjcmlwdCk7CiAgaWYgKCFkZWNvbXApIHJldHVybjsKICBjb25zdCBsYXN0SXRlbSA9IGRlY29tcFtkZWNvbXAubGVuZ3RoIC0gMV07CiAgaWYgKCFCdWZmZXIuaXNCdWZmZXIobGFzdEl0ZW0pIHx8IGlzUHVia2V5TGlrZShsYXN0SXRlbSkgfHwgaXNTaWdMaWtlKGxhc3RJdGVtKSkgcmV0dXJuOwogIGNvbnN0IHNEZWNvbXAgPSBic2NyaXB0LmRlY29tcGlsZShsYXN0SXRlbSk7CiAgaWYgKCFzRGVjb21wKSByZXR1cm47CiAgcmV0dXJuIGxhc3RJdGVtOwp9CmZ1bmN0aW9uIHJlZGVlbUZyb21GaW5hbFdpdG5lc3NTY3JpcHQoZmluYWxTY3JpcHQpIHsKICBpZiAoIWZpbmFsU2NyaXB0KSByZXR1cm47CiAgY29uc3QgZGVjb21wID0gc2NyaXB0V2l0bmVzc1RvV2l0bmVzc1N0YWNrKGZpbmFsU2NyaXB0KTsKICBjb25zdCBsYXN0SXRlbSA9IGRlY29tcFtkZWNvbXAubGVuZ3RoIC0gMV07CiAgaWYgKGlzUHVia2V5TGlrZShsYXN0SXRlbSkpIHJldHVybjsKICBjb25zdCBzRGVjb21wID0gYnNjcmlwdC5kZWNvbXBpbGUobGFzdEl0ZW0pOwogIGlmICghc0RlY29tcCkgcmV0dXJuOwogIHJldHVybiBsYXN0SXRlbTsKfQpmdW5jdGlvbiBjb21wcmVzc1B1YmtleShwdWJrZXkpIHsKICBpZiAocHVia2V5Lmxlbmd0aCA9PT0gNjUpIHsKICAgIGNvbnN0IHBhcml0eSA9IHB1YmtleVs2NF0gJiAxOwogICAgY29uc3QgbmV3S2V5ID0gcHVia2V5LnNsaWNlKDAsIDMzKTsKICAgIG5ld0tleVswXSA9IDIgfCBwYXJpdHk7CiAgICByZXR1cm4gbmV3S2V5OwogIH0KICByZXR1cm4gcHVia2V5LnNsaWNlKCk7Cn0KZnVuY3Rpb24gaXNQdWJrZXlMaWtlKGJ1ZikgewogIHJldHVybiBidWYubGVuZ3RoID09PSAzMyAmJiBic2NyaXB0LmlzQ2Fub25pY2FsUHViS2V5KGJ1Zik7Cn0KZnVuY3Rpb24gaXNTaWdMaWtlKGJ1ZikgewogIHJldHVybiBic2NyaXB0LmlzQ2Fub25pY2FsU2NyaXB0U2lnbmF0dXJlKGJ1Zik7Cn0KZnVuY3Rpb24gZ2V0TWVhbmluZ2Z1bFNjcmlwdChzY3JpcHQsIGluZGV4LCBpb1R5cGUsIHJlZGVlbVNjcmlwdCwgd2l0bmVzc1NjcmlwdCkgewogIGNvbnN0IGlzUDJTSCA9ICgwLCBwc2J0dXRpbHNfMS5pc1AyU0hTY3JpcHQpKHNjcmlwdCk7CiAgY29uc3QgaXNQMlNIUDJXU0ggPSBpc1AyU0ggJiYgcmVkZWVtU2NyaXB0ICYmICgwLCBwc2J0dXRpbHNfMS5pc1AyV1NIU2NyaXB0KShyZWRlZW1TY3JpcHQpOwogIGNvbnN0IGlzUDJXU0ggPSAoMCwgcHNidHV0aWxzXzEuaXNQMldTSFNjcmlwdCkoc2NyaXB0KTsKICBpZiAoaXNQMlNIICYmIHJlZGVlbVNjcmlwdCA9PT0gdW5kZWZpbmVkKSB0aHJvdyBuZXcgRXJyb3IoJ3NjcmlwdFB1YmtleSBpcyBQMlNIIGJ1dCByZWRlZW1TY3JpcHQgbWlzc2luZycpOwogIGlmICgoaXNQMldTSCB8fCBpc1AyU0hQMldTSCkgJiYgd2l0bmVzc1NjcmlwdCA9PT0gdW5kZWZpbmVkKSB0aHJvdyBuZXcgRXJyb3IoJ3NjcmlwdFB1YmtleSBvciByZWRlZW1TY3JpcHQgaXMgUDJXU0ggYnV0IHdpdG5lc3NTY3JpcHQgbWlzc2luZycpOwogIGxldCBtZWFuaW5nZnVsU2NyaXB0OwogIGlmIChpc1AyU0hQMldTSCkgewogICAgbWVhbmluZ2Z1bFNjcmlwdCA9IHdpdG5lc3NTY3JpcHQ7CiAgICBjaGVja1JlZGVlbVNjcmlwdChpbmRleCwgc2NyaXB0LCByZWRlZW1TY3JpcHQsIGlvVHlwZSk7CiAgICBjaGVja1dpdG5lc3NTY3JpcHQoaW5kZXgsIHJlZGVlbVNjcmlwdCwgd2l0bmVzc1NjcmlwdCwgaW9UeXBlKTsKICAgIGNoZWNrSW52YWxpZFAyV1NIKG1lYW5pbmdmdWxTY3JpcHQpOwogIH0gZWxzZSBpZiAoaXNQMldTSCkgewogICAgbWVhbmluZ2Z1bFNjcmlwdCA9IHdpdG5lc3NTY3JpcHQ7CiAgICBjaGVja1dpdG5lc3NTY3JpcHQoaW5kZXgsIHNjcmlwdCwgd2l0bmVzc1NjcmlwdCwgaW9UeXBlKTsKICAgIGNoZWNrSW52YWxpZFAyV1NIKG1lYW5pbmdmdWxTY3JpcHQpOwogIH0gZWxzZSBpZiAoaXNQMlNIKSB7CiAgICBtZWFuaW5nZnVsU2NyaXB0ID0gcmVkZWVtU2NyaXB0OwogICAgY2hlY2tSZWRlZW1TY3JpcHQoaW5kZXgsIHNjcmlwdCwgcmVkZWVtU2NyaXB0LCBpb1R5cGUpOwogIH0gZWxzZSB7CiAgICBtZWFuaW5nZnVsU2NyaXB0ID0gc2NyaXB0OwogIH0KICByZXR1cm4gewogICAgbWVhbmluZ2Z1bFNjcmlwdCwKICAgIHR5cGU6IGlzUDJTSFAyV1NIID8gJ3Ayc2gtcDJ3c2gnIDogaXNQMlNIID8gJ3Ayc2gnIDogaXNQMldTSCA/ICdwMndzaCcgOiAncmF3JwogIH07Cn0KZnVuY3Rpb24gY2hlY2tJbnZhbGlkUDJXU0goc2NyaXB0KSB7CiAgaWYgKCgwLCBwc2J0dXRpbHNfMS5pc1AyV1BLSCkoc2NyaXB0KSB8fCAoMCwgcHNidHV0aWxzXzEuaXNQMlNIU2NyaXB0KShzY3JpcHQpKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ1AyV1BLSCBvciBQMlNIIGNhbiBub3QgYmUgY29udGFpbmVkIHdpdGhpbiBQMldTSCcpOwogIH0KfQpmdW5jdGlvbiBjbGFzc2lmeVNjcmlwdChzY3JpcHQpIHsKICBpZiAoKDAsIHBzYnR1dGlsc18xLmlzUDJXUEtIKShzY3JpcHQpKSByZXR1cm4gJ3dpdG5lc3NwdWJrZXloYXNoJzsKICBpZiAoKDAsIHBzYnR1dGlsc18xLmlzUDJQS0gpKHNjcmlwdCkpIHJldHVybiAncHVia2V5aGFzaCc7CiAgaWYgKCgwLCBwc2J0dXRpbHNfMS5pc1AyTVMpKHNjcmlwdCkpIHJldHVybiAnbXVsdGlzaWcnOwogIGlmICgoMCwgcHNidHV0aWxzXzEuaXNQMlBLKShzY3JpcHQpKSByZXR1cm4gJ3B1YmtleSc7CiAgcmV0dXJuICdub25zdGFuZGFyZCc7Cn0KZnVuY3Rpb24gcmFuZ2UobikgewogIHJldHVybiBbLi4uQXJyYXkobikua2V5cygpXTsKfQ=="},{"version":3,"names":["psbt_1","require","varuint","__importStar","utils_1","address_1","bufferutils_1","networks_1","payments","bip341_1","bscript","transaction_1","bip371_1","psbtutils_1","crypto_lib_1","script_1","taproot_1","schnorr","signUtil","secp256k1","DEFAULT_OPTS","network","bitcoin","maximumFeeRate","Psbt","fromBase64","data","opts","arguments","length","undefined","buffer","Buffer","from","fromBuffer","fromHex","psbtBase","transactionFromBuffer","psbt","checkTxForDupeIns","__CACHE","__TX","constructor","PsbtTransaction","Object","assign","__NON_WITNESS_UTXO_TX_CACHE","__NON_WITNESS_UTXO_BUF_CACHE","__TX_IN_CACHE","globalMap","unsignedTx","tx","__UNSAFE_SIGN_NONSEGWIT","inputs","setVersion","dpew","obj","attr","enumerable","writable","defineProperty","inputCount","version","locktime","setLocktime","txInputs","ins","map","input","hash","cloneBuffer","index","sequence","txOutputs","outs","output","address","fromOutputScript","script","_","value","combine","_len","those","Array","_key","o","clone","res","toBuffer","JSON","parse","stringify","setMaximumFeeRate","satoshiPerByte","check32Bit","checkInputsForPartialSig","c","__EXTRACTED_TX","setInputSequence","inputIndex","Error","addInputs","inputDatas","forEach","inputData","addInput","checkTaprootInputFields","witnessScript","checkInvalidP2WSH","txIn","checkTxInputCache","nonWitnessUtxo","addNonWitnessTxCache","__FEE","__FEE_RATE","addOutputs","outputDatas","outputData","addOutput","toOutputScript","checkTaprootOutputFields","extractTransaction","disableFeeCheck","every","isFinalized","checkFees","inputFinalizeGetAmts","getFeeRate","getTxCacheValue","getFee","finalizeAllInputs","checkForInput","range","idx","finalizeInput","finalScriptsFunc","isTaprootInput","_finalizeTaprootInput","_finalizeInput","finalizeTaprootInput","tapLeafHashToFinalize","tapScriptFinalizer","getFinalScripts","isP2SH","isP2WSH","isSegwit","getScriptFromInput","checkPartialSigSighashes","finalScriptSig","finalScriptWitness","updateInput","clearFinalizedInput","witnessUtxo","tapKeySig","payment","p2tr","signature","witnessStackToScriptWitness","witness","getInputType","getScriptFromUtxo","result","getMeaningfulScript","redeemScript","redeemFromFinalScriptSig","redeemFromFinalWitnessScript","type","mainType","classifyScript","meaningfulScript","inputHasPubkey","pubkey","pubkeyInInput","inputHasHDKey","root","derivationIsMine","bip32DerivationIsMine","bip32Derivation","some","outputHasPubkey","outputIndex","checkForOutput","outputs","pubkeyInOutput","outputHasHDKey","validateSignaturesOfAllInputs","validator","results","validateSignaturesOfInput","reduce","final","validateSignaturesOfTaprootInput","_validateSignaturesOfInput","partialSig","mySigs","filter","sig","equals","hashCache","scriptCache","sighashCache","pSig","decode","hashType","getHashForSig","sighashType","checkScriptForPubkey","push","tapScriptSig","toXOnly","allHashses","getTaprootHashesForSig","getAllTaprootHashesForSig","tapKeyHash","find","h","leafHash","isValidTapkeySig","tapSig","tapSigHash","isValidTapScriptSig","signAllInputsHD","hdKeyPair","sighashTypes","Transaction","SIGHASH_ALL","publicKey","fingerprint","i","signInputHD","err","v","signAllInputsHDAsync","Promise","resolve","reject","promises","signInputHDAsync","then","all","signers","getSignersFromHD","signer","signInput","signInputAsync","catch","signAllInputs","keyPair","signAllInputsAsync","entries","_signTaprootInput","_signInput","signTaprootInput","tapLeafHashToSign","getHashAndSighashType","encode","sign","allowedSighashTypes","SIGHASH_DEFAULT","hashesForSig","checkTaprootHashesForSig","serializeTaprootSignature","signSchnorr","_signTaprootInputAsync","_signInputAsync","signTaprootInputAsync","tapLeafHash","signaturePromises","tapKeySigPromise","tapScriptHashes","tapScriptSigPromises","tsh","toString","checkCache","toHex","toBase64","updateGlobal","updateData","updateOutput","addUnknownKeyValToGlobal","keyVal","addUnknownKeyValToInput","addUnknownKeyValToOutput","verify","pubBuf","SIGHASH_SINGLE","SIGHASH_ANYONECANPAY","tweakKey","taprootTweakPubkey","slice","bufferReader","BufferReader","vector","readVector","alloc","messageToSign","base","witnessPubKey","verifyWithNoRecovery","exports","checkTxEmpty","getInputOutputCounts","outputCount","isBuffer","reverseBuffer","canFinalize","scriptType","hasSigs","p2ms","m","pubkeys","cache","neededSigs","sigs","pkey","compressPubkey","d","masterFingerprint","derivePath","path","num","Math","floor","feeRate","vsize","virtualSize","satoshis","toFixed","action","throws","checkTaprootInputForSigs","checkInputForSig","pubkeyInScript","isEmpty","key","scriptCheckerFactory","paymentScriptName","scriptPubKey","ioType","redeemScriptOutput","redeem","checkRedeemScript","p2sh","checkWitnessScript","p2wsh","name","mustFinalize","prepareFinalScripts","getPayment","forValidate","checkSighashTypeAllowed","prevout","nonWitnessUtxoTx","nonWitnessUtxoTxFromCache","prevoutHash","utxoHash","getHash","prevoutIndex","indexOf","hashForWitnessV0","isP2WPKH","signingScript","p2pkh","console","warn","hashForSignature","allPublicKeys","tapInternalKey","outputKey","tweakInternalPubKey","tapScriptPubkeys","tss","allHashes","pubicKey","flat","prevOuts","getScriptAndAmountFromUtxo","signingScripts","values","hashes","hashForWitnessV1","tapLeafHashes","tapLeafScript","tapLeaf","tapleafHash","leafVersion","tapScriptHash","concat","str","sighashTypeToString","getSortedSigs","signatures","p2pk","p2wpkh","myDerivations","bipDv","node","pk","ps","scriptWitnessToWitnessStack","offset","readSlice","n","readVarInt","vi","bytes","readVarSlice","count","text","sigMod","SIGHASH_NONE","self","selfIndex","get","buf","txCache","newBuf","set","inputAmount","nwTx","vout","out","outputAmount","total","fee","finalScript","decomp","decompile","lastItem","isPubkeyLike","isSigLike","sDecomp","parity","newKey","isCanonicalPubKey","isCanonicalScriptSignature","isP2SHScript","isP2SHP2WSH","isP2WSHScript","isP2PKH","isP2MS","isP2PK","keys"],"sources":["../../src/bitcoinjs-lib/psbt.ts"],"sourcesContent":[null],"mappings":"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"}]}